/**
  @license
  Apache License 2.0 https://github.com/ReactiveX/RxJS/blob/master/LICENSE.txt
 **/
(function(t,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(t.Rx=t.Rx||{})})(this,function(t){function h(b,a){function c(){this.constructor=b}mb(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}function M(b){return"function"===typeof b}function nb(){try{return la.apply(this,arguments)}catch(b){return m.e=b,m}}function r(b){la=b;return nb}function ma(b){return b.reduce(function(a,c){return a.concat(c instanceof
N?c.errors:c)},[])}function na(b){var a=b.subject;a.next(b.value);a.complete()}function ob(b){b.subject.error(b.err)}function pb(b){var a=this,c=b.source,e=b.subscriber;b=b.context;var d=c.callbackFunc,f=c.args,k=c.scheduler,g=c.subject;if(!g){var g=c.subject=new K,h=function qb(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];var e=qb.source,b=e.selector,e=e.subject,d=c.shift();d?a.add(k.schedule(ca,0,{err:d,subject:e})):b?(c=r(b).apply(this,c),c===m?a.add(k.schedule(ca,0,{err:m.e,subject:e})):
a.add(k.schedule(oa,0,{value:c,subject:e}))):a.add(k.schedule(oa,0,{value:1>=c.length?c[0]:c,subject:e}))};h.source=c;r(d).apply(b,f.concat(h))===m&&a.add(k.schedule(ca,0,{err:m.e,subject:g}))}a.add(g.subscribe(e))}function oa(b){var a=b.subject;a.next(b.value);a.complete()}function ca(b){b.subject.error(b.err)}function z(b){return b&&"function"===typeof b.schedule}function pa(b){return b&&"function"!==typeof b.subscribe&&"function"===typeof b.then}function p(b,a,c,e){var d=new qa(b,c,e);if(d.closed)return null;
if(a instanceof g)if(a._isScalar)d.next(a.value),d.complete();else return a.subscribe(d);else if(a&&"number"===typeof a.length){b=0;for(c=a.length;b<c&&!d.closed;b++)d.next(a[b]);d.closed||d.complete()}else{if(pa(a))return a.then(function(c){d.closed||(d.next(c),d.complete())},function(c){return d.error(c)}).then(null,function(c){n.setTimeout(function(){throw c;})}),d;if(a&&"function"===typeof a[A]){a=a[A]();do{b=a.next();if(b.done){d.complete();break}d.next(b.value);if(d.closed)break}while(1)}else if(a&&
"function"===typeof a[H])if(a=a[H](),"function"!==typeof a.subscribe)d.error(new TypeError("Provided object does not correctly implement Symbol.observable"));else return a.subscribe(new qa(b,c,e));else d.error(new TypeError("You provided "+(null!=a&&"object"===typeof a?"an invalid object":"'"+a+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))}return null}function O(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];a=null;z(b[b.length-1])&&
(a=b.pop());return null===a&&1===b.length&&b[0]instanceof g?b[0]:(new E(b,a)).lift(new W(1))}function ra(b){var a=b.value;b=b.subscriber;b.closed||(b.next(a),b.complete())}function sb(b){var a=b.err;b=b.subscriber;b.closed||b.error(a)}function P(b){return!D(b)&&0<=b-parseFloat(b)+1}function sa(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var a=Number.POSITIVE_INFINITY,c=null,e=b[b.length-1];z(e)?(c=b.pop(),1<b.length&&"number"===typeof b[b.length-1]&&(a=b.pop())):"number"===typeof e&&
(a=b.pop());return null===c&&1===b.length&&b[0]instanceof g?b[0]:(new E(b,c)).lift(new W(a))}function ta(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];if(1===b.length)if(D(b[0]))b=b[0];else return b[0];return(new E(b)).lift(new tb)}function ub(b){var a=b.obj,c=b.keys,e=b.index,d=b.subscriber;e===b.length?d.complete():(c=c[e],d.next([c,a[c]]),b.index=e+1,this.schedule(b))}function X(b){return b instanceof Date&&!isNaN(+b)}function ua(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=
arguments[a];a=b[b.length-1];"function"===typeof a&&b.pop();return(new E(b)).lift(new va(a))}function wa(b,a){if("function"!==typeof b)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return this.lift(new xa(b,a))}function vb(b,a){void 0===a&&(a=null);return new I({method:"GET",url:b,headers:a})}function wb(b,a,c){return new I({method:"POST",url:b,body:a,headers:c})}function xb(b,a){return new I({method:"DELETE",url:b,headers:a})}function yb(b,a,c){return new I({method:"PUT",
url:b,body:a,headers:c})}function zb(b,a,c){return new I({method:"PATCH",url:b,body:a,headers:c})}function Ab(b,a){return(new I({method:"GET",url:b,responseType:"json",headers:a})).lift(new xa(function(c,a){return c.response},null))}function Bb(b){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];for(var c=a.length,e=0;e<c;e++){var d=a[e],f;for(f in d)d.hasOwnProperty(f)&&(b[f]=d[f])}return b}function ya(b){var a=b.subscriber,c=b.context;c&&a.closeContext(c);a.closed||(b.context=a.openContext(),
b.context.closeAction=this.schedule(b,b.bufferTimeSpan))}function Cb(b){var a=b.bufferCreationInterval,c=b.bufferTimeSpan,e=b.subscriber,d=b.scheduler,f=e.openContext();e.closed||(e.add(f.closeAction=d.schedule(za,c,{subscriber:e,context:f})),this.schedule(b,a))}function za(b){b.subscriber.closeContext(b.context)}function Aa(b){b=new Db(b);var a=this.lift(b);return b.caught=a}function Ba(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);"number"===typeof a&&(c=a,a=null);return this.lift(new Ca(b,a,
c))}function Da(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);"number"===typeof a&&(c=a,a=null);return this.lift(new Ea(b,a,c))}function Eb(b){b.debouncedNext()}function Fb(){return function(){function b(){this._values=[]}b.prototype.add=function(a){this.has(a)||this._values.push(a)};b.prototype.has=function(a){return-1!==this._values.indexOf(a)};Object.defineProperty(b.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this._values.length=
0};return b}()}function Fa(b,a){return this.lift(new Gb(b,a))}function Ga(b,a,c){return this.lift(new Hb(b,a,c))}function da(b,a){return this.lift(new Ib(b,a))}function Ha(b){return this.lift(new Jb(b))}function Kb(b){b.clearThrottle()}function Ia(b){return b(this)}function J(b,a){var c;c="function"===typeof b?b:function(){return b};if("function"===typeof a)return this.lift(new Lb(c,a));a=Object.create(this,Mb);a.source=this;a.subjectFactory=c;return a}function Nb(b,a){function c(){return!c.pred.apply(c.thisArg,
arguments)}c.pred=b;c.thisArg=a;return c}function Ob(b,a){return function(c){var e=c;for(c=0;c<a;c++)if(e=e[b[c]],"undefined"===typeof e)return;return e}}function Pb(b){var a=b.period;b.subscriber.notifyNext();this.schedule(b,a)}function Qb(){return new v}function Ja(){return this.lift(new Rb)}function Sb(b){b.subscriber.clearThrottle()}function Tb(b){var a=b.subscriber,c=b.windowTimeSpan,e=b.window;e&&a.closeWindow(e);b.window=a.openWindow();this.schedule(b,c)}function Ub(b){var a=b.windowTimeSpan,
c=b.subscriber,e=b.scheduler,d=b.windowCreationInterval,f=c.openWindow(),k={action:this,subscription:null};k.subscription=e.schedule(Ka,a,{subscriber:c,window:f,context:k});this.add(k.subscription);this.schedule(b,d)}function Ka(b){var a=b.subscriber,c=b.window;(b=b.context)&&b.action&&b.subscription&&b.action.remove(b.subscription);a.closeWindow(c)}function La(b,a){for(var c=0,e=a.length;c<e;c++)for(var d=a[c],f=Object.getOwnPropertyNames(d.prototype),k=0,g=f.length;k<g;k++){var h=f[k];b.prototype[h]=
d.prototype[h]}}var mb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},n="object"==typeof window&&window.window===window&&window||"object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if(!n)throw Error("RxJS could not find any global context (window, self, global)");var D=Array.isArray||function(b){return b&&"number"===typeof b.length},m={e:{}},la,N=
function(b){function a(c){b.call(this);this.errors=c;c=Error.call(this,c?c.length+" errors occurred during unsubscription:\n  "+c.map(function(c,a){return a+1+") "+c.toString()}).join("\n  "):"");this.name=c.name="UnsubscriptionError";this.stack=c.stack;this.message=c.message}h(a,b);return a}(Error),u=function(){function b(a){this.closed=!1;this._subscriptions=this._parents=this._parent=null;a&&(this._unsubscribe=a)}b.prototype.unsubscribe=function(){var a=!1,c;if(!this.closed){var b=this._parent,
d=this._parents,f=this._unsubscribe,k=this._subscriptions;this.closed=!0;this._subscriptions=this._parents=this._parent=null;for(var g=-1,h=d?d.length:0;b;)b.remove(this),b=++g<h&&d[g]||null;M(f)&&(b=r(f).call(this),b===m&&(a=!0,c=c||(m.e instanceof N?ma(m.e.errors):[m.e])));if(D(k))for(g=-1,h=k.length;++g<h;)b=k[g],null!=b&&"object"===typeof b&&(b=r(b.unsubscribe).call(b),b===m&&(a=!0,c=c||[],b=m.e,b instanceof N?c=c.concat(ma(b.errors)):c.push(b)));if(a)throw new N(c);}};b.prototype.add=function(a){if(!a||
a===b.EMPTY)return b.EMPTY;if(a===this)return this;var c=a;switch(typeof a){case "function":c=new b(a);case "object":if(c.closed||"function"!==typeof c.unsubscribe)return c;if(this.closed)return c.unsubscribe(),c;"function"!==typeof c._addParent&&(a=c,c=new b,c._subscriptions=[a]);break;default:throw Error("unrecognized teardown "+a+" added to Subscription.");}(this._subscriptions||(this._subscriptions=[])).push(c);c._addParent(this);return c};b.prototype.remove=function(a){var c=this._subscriptions;
c&&(a=c.indexOf(a),-1!==a&&c.splice(a,1))};b.prototype._addParent=function(a){var c=this._parent,b=this._parents;c&&c!==a?b?-1===b.indexOf(a)&&b.push(a):this._parents=[a]:this._parent=a};b.EMPTY=function(a){a.closed=!0;return a}(new b);return b}(),ea={closed:!0,next:function(b){},error:function(b){throw b;},complete:function(){}},fa=n.Symbol,Q="function"===typeof fa&&"function"===typeof fa.for?fa.for("rxSubscriber"):"@@rxSubscriber",l=function(b){function a(c,e,d){b.call(this);this.syncErrorValue=
null;this.isStopped=this.syncErrorThrowable=this.syncErrorThrown=!1;switch(arguments.length){case 0:this.destination=ea;break;case 1:if(!c){this.destination=ea;break}if("object"===typeof c){c instanceof a?(this.destination=c,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new Ma(this,c));break}default:this.syncErrorThrowable=!0,this.destination=new Ma(this,c,e,d)}}h(a,b);a.prototype[Q]=function(){return this};a.create=function(c,b,d){c=new a(c,b,d);c.syncErrorThrowable=!1;
return c};a.prototype.next=function(c){this.isStopped||this._next(c)};a.prototype.error=function(c){this.isStopped||(this.isStopped=!0,this._error(c))};a.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())};a.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,b.prototype.unsubscribe.call(this))};a.prototype._next=function(c){this.destination.next(c)};a.prototype._error=function(c){this.destination.error(c);this.unsubscribe()};a.prototype._complete=function(){this.destination.complete();
this.unsubscribe()};a.prototype._unsubscribeAndRecycle=function(){var c=this._parent,a=this._parents;this._parents=this._parent=null;this.unsubscribe();this.isStopped=this.closed=!1;this._parent=c;this._parents=a;return this};return a}(u),Ma=function(b){function a(c,a,d,f){b.call(this);this._parentSubscriber=c;var e;c=this;M(a)?e=a:a&&(c=a,e=a.next,d=a.error,f=a.complete,M(c.unsubscribe)&&this.add(c.unsubscribe.bind(c)),c.unsubscribe=this.unsubscribe.bind(this));this._context=c;this._next=e;this._error=
d;this._complete=f}h(a,b);a.prototype.next=function(c){if(!this.isStopped&&this._next){var a=this._parentSubscriber;a.syncErrorThrowable?this.__tryOrSetError(a,this._next,c)&&this.unsubscribe():this.__tryOrUnsub(this._next,c)}};a.prototype.error=function(c){if(!this.isStopped){var a=this._parentSubscriber;if(this._error)a.syncErrorThrowable?this.__tryOrSetError(a,this._error,c):this.__tryOrUnsub(this._error,c),this.unsubscribe();else if(a.syncErrorThrowable)a.syncErrorValue=c,a.syncErrorThrown=!0,
this.unsubscribe();else throw this.unsubscribe(),c;}};a.prototype.complete=function(){if(!this.isStopped){var c=this._parentSubscriber;this._complete&&(c.syncErrorThrowable?this.__tryOrSetError(c,this._complete):this.__tryOrUnsub(this._complete));this.unsubscribe()}};a.prototype.__tryOrUnsub=function(c,a){try{c.call(this._context,a)}catch(d){throw this.unsubscribe(),d;}};a.prototype.__tryOrSetError=function(c,a,b){try{a.call(this._context,b)}catch(f){return c.syncErrorValue=f,c.syncErrorThrown=!0}return!1};
a.prototype._unsubscribe=function(){var c=this._parentSubscriber;this._parentSubscriber=this._context=null;c.unsubscribe()};return a}(l),H=function(b){var a=b.Symbol;"function"===typeof a?a.observable?b=a.observable:(b=a("observable"),a.observable=b):b="@@observable";return b}(n),g=function(){function b(a){this._isScalar=!1;a&&(this._subscribe=a)}b.prototype.lift=function(a){var c=new b;c.source=this;c.operator=a;return c};b.prototype.subscribe=function(a,c,b){var e=this.operator;a:{if(a){if(a instanceof
l)break a;if(a[Q]){a=a[Q]();break a}}a=a||c||b?new l(a,c,b):new l(ea)}e?e.call(a,this.source):a.add(this._trySubscribe(a));if(a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a};b.prototype._trySubscribe=function(a){try{return this._subscribe(a)}catch(c){a.syncErrorThrown=!0,a.syncErrorValue=c,a.error(c)}};b.prototype.forEach=function(a,c){var b=this;c||(n.Rx&&n.Rx.config&&n.Rx.config.Promise?c=n.Rx.config.Promise:n.Promise&&(c=n.Promise));if(!c)throw Error("no Promise impl found");
return new c(function(c,e){var d=b.subscribe(function(c){if(d)try{a(c)}catch(C){e(C),d.unsubscribe()}else a(c)},e,c)})};b.prototype._subscribe=function(a){return this.source.subscribe(a)};b.prototype[H]=function(){return this};b.create=function(a){return new b(a)};return b}(),G=function(b){function a(){var c=b.call(this,"object unsubscribed");this.name=c.name="ObjectUnsubscribedError";this.stack=c.stack;this.message=c.message}h(a,b);return a}(Error),Na=function(b){function a(c,a){b.call(this);this.subject=
c;this.subscriber=a;this.closed=!1}h(a,b);a.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var c=this.subject,a=c.observers;this.subject=null;!a||0===a.length||c.isStopped||c.closed||(c=a.indexOf(this.subscriber),-1!==c&&a.splice(c,1))}};return a}(u),Oa=function(b){function a(c){b.call(this,c);this.destination=c}h(a,b);return a}(l),v=function(b){function a(){b.call(this);this.observers=[];this.hasError=this.isStopped=this.closed=!1;this.thrownError=null}h(a,b);a.prototype[Q]=function(){return new Oa(this)};
a.prototype.lift=function(c){var a=new Y(this,this);a.operator=c;return a};a.prototype.next=function(c){if(this.closed)throw new G;if(!this.isStopped)for(var a=this.observers,b=a.length,a=a.slice(),f=0;f<b;f++)a[f].next(c)};a.prototype.error=function(c){if(this.closed)throw new G;this.hasError=!0;this.thrownError=c;this.isStopped=!0;for(var a=this.observers,b=a.length,a=a.slice(),f=0;f<b;f++)a[f].error(c);this.observers.length=0};a.prototype.complete=function(){if(this.closed)throw new G;this.isStopped=
!0;for(var c=this.observers,a=c.length,c=c.slice(),b=0;b<a;b++)c[b].complete();this.observers.length=0};a.prototype.unsubscribe=function(){this.closed=this.isStopped=!0;this.observers=null};a.prototype._trySubscribe=function(c){if(this.closed)throw new G;return b.prototype._trySubscribe.call(this,c)};a.prototype._subscribe=function(c){if(this.closed)throw new G;if(this.hasError)return c.error(this.thrownError),u.EMPTY;if(this.isStopped)return c.complete(),u.EMPTY;this.observers.push(c);return new Na(this,
c)};a.prototype.asObservable=function(){var c=new g;c.source=this;return c};a.create=function(c,a){return new Y(c,a)};return a}(g),Y=function(b){function a(c,a){b.call(this);this.destination=c;this.source=a}h(a,b);a.prototype.next=function(c){var a=this.destination;a&&a.next&&a.next(c)};a.prototype.error=function(c){var a=this.destination;a&&a.error&&this.destination.error(c)};a.prototype.complete=function(){var c=this.destination;c&&c.complete&&this.destination.complete()};a.prototype._subscribe=
function(c){return this.source?this.source.subscribe(c):u.EMPTY};return a}(v),K=function(b){function a(){b.apply(this,arguments);this.value=null;this.hasCompleted=this.hasNext=!1}h(a,b);a.prototype._subscribe=function(c){return this.hasError?(c.error(this.thrownError),u.EMPTY):this.hasCompleted&&this.hasNext?(c.next(this.value),c.complete(),u.EMPTY):b.prototype._subscribe.call(this,c)};a.prototype.next=function(c){this.hasCompleted||(this.value=c,this.hasNext=!0)};a.prototype.error=function(c){this.hasCompleted||
b.prototype.error.call(this,c)};a.prototype.complete=function(){this.hasCompleted=!0;this.hasNext&&b.prototype.next.call(this,this.value);b.prototype.complete.call(this)};return a}(v),Vb=function(b){function a(c,a,d,f,k){b.call(this);this.callbackFunc=c;this.selector=a;this.args=d;this.context=f;this.scheduler=k}h(a,b);a.create=function(c,b,d){void 0===b&&(b=void 0);return function(){for(var e=[],k=0;k<arguments.length;k++)e[k-0]=arguments[k];return new a(c,b,e,this,d)}};a.prototype._subscribe=function(c){var b=
this.callbackFunc,d=this.args,f=this.scheduler,k=this.subject;if(f)return f.schedule(a.dispatch,0,{source:this,subscriber:c,context:this.context});k||(k=this.subject=new K,f=function C(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];var b=C.source,a=b.selector,b=b.subject;a?(c=r(a).apply(this,c),c===m?b.error(m.e):(b.next(c),b.complete())):(b.next(1>=c.length?c[0]:c),b.complete())},f.source=this,r(b).apply(this.context,d.concat(f))===m&&k.error(m.e));return k.subscribe(c)};a.dispatch=
function(c){var a=this,b=c.source,f=c.subscriber;c=c.context;var k=b.callbackFunc,g=b.args,h=b.scheduler,B=b.subject;if(!B){var B=b.subject=new K,l=function rb(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];var e=rb.source,b=e.selector,e=e.subject;b?(c=r(b).apply(this,c),c===m?a.add(h.schedule(ob,0,{err:m.e,subject:e})):a.add(h.schedule(na,0,{value:c,subject:e}))):a.add(h.schedule(na,0,{value:1>=c.length?c[0]:c,subject:e}))};l.source=b;r(k).apply(c,g.concat(l))===m&&B.error(m.e)}a.add(B.subscribe(f))};
return a}(g).create;g.bindCallback=Vb;var Wb=function(b){function a(c,a,d,f,k){b.call(this);this.callbackFunc=c;this.selector=a;this.args=d;this.context=f;this.scheduler=k}h(a,b);a.create=function(c,b,d){void 0===b&&(b=void 0);return function(){for(var e=[],k=0;k<arguments.length;k++)e[k-0]=arguments[k];return new a(c,b,e,this,d)}};a.prototype._subscribe=function(c){var a=this.callbackFunc,b=this.args,f=this.scheduler,k=this.subject;if(f)return f.schedule(pb,0,{source:this,subscriber:c,context:this.context});
k||(k=this.subject=new K,f=function C(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];var b=C.source,a=b.selector,b=b.subject,e=c.shift();e?b.error(e):a?(c=r(a).apply(this,c),c===m?b.error(m.e):(b.next(c),b.complete())):(b.next(1>=c.length?c[0]:c),b.complete())},f.source=this,r(a).apply(this.context,b.concat(f))===m&&k.error(m.e));return k.subscribe(c)};return a}(g).create;g.bindNodeCallback=Wb;var ga=function(b){function a(c,a){b.call(this);this.value=c;this.scheduler=a;this._isScalar=
!0;a&&(this._isScalar=!1)}h(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){var a=c.value,b=c.subscriber;c.done?b.complete():(b.next(a),b.closed||(c.done=!0,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.value,d=this.scheduler;if(d)return d.schedule(a.dispatch,0,{done:!1,value:b,subscriber:c});c.next(b);c.closed||c.complete()};return a}(g),F=function(b){function a(c){b.call(this);this.scheduler=c}h(a,b);a.create=function(c){return new a(c)};a.dispatch=function(c){c.subscriber.complete()};
a.prototype._subscribe=function(c){var b=this.scheduler;if(b)return b.schedule(a.dispatch,0,{subscriber:c});c.complete()};return a}(g),E=function(b){function a(c,a){b.call(this);this.array=c;this.scheduler=a;a||1!==c.length||(this._isScalar=!0,this.value=c[0])}h(a,b);a.create=function(c,b){return new a(c,b)};a.of=function(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];b=c[c.length-1];z(b)?c.pop():b=null;var d=c.length;return 1<d?new a(c,b):1===d?new ga(c[0],b):new F(b)};a.dispatch=
function(c){var a=c.array,b=c.index,f=c.subscriber;b>=c.count?f.complete():(f.next(a[b]),f.closed||(c.index=b+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.array,d=b.length,f=this.scheduler;if(f)return f.schedule(a.dispatch,0,{array:b,index:0,count:d,subscriber:c});for(f=0;f<d&&!c.closed;f++)c.next(b[f]);c.complete()};return a}(g),q=function(b){function a(){b.apply(this,arguments)}h(a,b);a.prototype.notifyNext=function(c,a,b,f,k){this.destination.next(a)};a.prototype.notifyError=
function(c,a){this.destination.error(c)};a.prototype.notifyComplete=function(c){this.destination.complete()};return a}(l),A=function(b){var a=b.Symbol;if("function"===typeof a)return a.iterator||(a.iterator=a("iterator polyfill")),a.iterator;if((a=b.Set)&&"function"===typeof(new a)["@@iterator"])return"@@iterator";if(b=b.Map)for(var a=Object.getOwnPropertyNames(b.prototype),c=0;c<a.length;++c){var e=a[c];if("entries"!==e&&"size"!==e&&b.prototype[e]===b.prototype.entries)return e}return"@@iterator"}(n),
qa=function(b){function a(c,a,d){b.call(this);this.parent=c;this.outerValue=a;this.outerIndex=d;this.index=0}h(a,b);a.prototype._next=function(c){this.parent.notifyNext(this.outerValue,c,this.outerIndex,this.index++,this)};a.prototype._error=function(c){this.parent.notifyError(c,this);this.unsubscribe()};a.prototype._complete=function(){this.parent.notifyComplete(this);this.unsubscribe()};return a}(l),Pa={},ha=function(){function b(a){this.project=a}b.prototype.call=function(a,c){return c.subscribe(new Xb(a,
this.project))};return b}(),Xb=function(b){function a(c,a){b.call(this,c);this.project=a;this.active=0;this.values=[];this.observables=[]}h(a,b);a.prototype._next=function(c){this.values.push(Pa);this.observables.push(c)};a.prototype._complete=function(){var c=this.observables,a=c.length;if(0===a)this.destination.complete();else{this.toRespond=this.active=a;for(var b=0;b<a;b++){var f=c[b];this.add(p(this,f,f,b))}}};a.prototype.notifyComplete=function(c){0===--this.active&&this.destination.complete()};
a.prototype.notifyNext=function(c,a,b,f,k){c=this.values;f=c[b];f=this.toRespond?f===Pa?--this.toRespond:this.toRespond:0;c[b]=a;0===f&&(this.project?this._tryProject(c):this.destination.next(c.slice()))};a.prototype._tryProject=function(c){var a;try{a=this.project.apply(this,c)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(q);g.combineLatest=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];var c=a=null;z(b[b.length-1])&&(c=b.pop());"function"===
typeof b[b.length-1]&&(a=b.pop());1===b.length&&D(b[0])&&(b=b[0]);return(new E(b,c)).lift(new ha(a))};var W=function(){function b(a){this.concurrent=a}b.prototype.call=function(a,c){return c.subscribe(new Yb(a,this.concurrent))};return b}(),Yb=function(b){function a(c,a){b.call(this,c);this.concurrent=a;this.hasCompleted=!1;this.buffer=[];this.active=0}h(a,b);a.prototype._next=function(c){this.active<this.concurrent?(this.active++,this.add(p(this,c))):this.buffer.push(c)};a.prototype._complete=function(){this.hasCompleted=
!0;0===this.active&&0===this.buffer.length&&this.destination.complete()};a.prototype.notifyComplete=function(c){var a=this.buffer;this.remove(c);this.active--;0<a.length?this._next(a.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()};return a}(q);g.concat=O;var $b=function(b){function a(c){b.call(this);this.observableFactory=c}h(a,b);a.create=function(c){return new a(c)};a.prototype._subscribe=function(c){return new Zb(c,this.observableFactory)};return a}(g),Zb=function(b){function a(c,
a){b.call(this,c);this.factory=a;this.tryDefer()}h(a,b);a.prototype.tryDefer=function(){try{this._callFactory()}catch(c){this._error(c)}};a.prototype._callFactory=function(){var c=this.factory();c&&this.add(p(this,c))};return a}(q);g.defer=$b.create;g.empty=F.create;var bc=function(b){function a(c,a){b.call(this);this.sources=c;this.resultSelector=a}h(a,b);a.create=function(){for(var c=[],b=0;b<arguments.length;b++)c[b-0]=arguments[b];if(null===c||0===arguments.length)return new F;b=null;"function"===
typeof c[c.length-1]&&(b=c.pop());1===c.length&&D(c[0])&&(c=c[0]);return 0===c.length?new F:new a(c,b)};a.prototype._subscribe=function(c){return new ac(c,this.sources,this.resultSelector)};return a}(g),ac=function(b){function a(c,a,d){b.call(this,c);this.sources=a;this.resultSelector=d;this.haveValues=this.completed=0;this.total=c=a.length;this.values=Array(c);for(d=0;d<c;d++){var e=p(this,a[d],null,d);e&&(e.outerIndex=d,this.add(e))}}h(a,b);a.prototype.notifyNext=function(c,a,b,f,k){this.values[b]=
a;k._hasValue||(k._hasValue=!0,this.haveValues++)};a.prototype.notifyComplete=function(c){var a=this.destination,b=this.haveValues,f=this.resultSelector,k=this.values,g=k.length;c._hasValue?(this.completed++,this.completed===g&&(b===g&&(c=f?f.apply(this,k):k,a.next(c)),a.complete())):a.complete()};return a}(q);g.forkJoin=bc.create;var Qa=function(b){function a(c,a){b.call(this);this.promise=c;this.scheduler=a}h(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=
this,b=this.promise,f=this.scheduler;if(null==f)this._isScalar?c.closed||(c.next(this.value),c.complete()):b.then(function(b){a.value=b;a._isScalar=!0;c.closed||(c.next(b),c.complete())},function(a){c.closed||c.error(a)}).then(null,function(c){n.setTimeout(function(){throw c;})});else if(this._isScalar){if(!c.closed)return f.schedule(ra,0,{value:this.value,subscriber:c})}else b.then(function(b){a.value=b;a._isScalar=!0;c.closed||c.add(f.schedule(ra,0,{value:b,subscriber:c}))},function(a){c.closed||
c.add(f.schedule(sb,0,{err:a,subscriber:c}))}).then(null,function(c){n.setTimeout(function(){throw c;})})};return a}(g),ec=function(b){function a(c,a){b.call(this);this.scheduler=a;if(null==c)throw Error("iterator cannot be null.");if((a=c[A])||"string"!==typeof c)if(a||void 0===c.length){if(!a)throw new TypeError("object is not iterable");c=c[A]()}else c=new cc(c);else c=new dc(c);this.iterator=c}h(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){var a=c.index,b=c.iterator,f=
c.subscriber;if(c.hasError)f.error(c.error);else{var k=b.next();k.done?f.complete():(f.next(k.value),c.index=a+1,f.closed?"function"===typeof b.return&&b.return():this.schedule(c))}};a.prototype._subscribe=function(c){var b=this.iterator,d=this.scheduler;if(d)return d.schedule(a.dispatch,0,{index:0,iterator:b,subscriber:c});do{d=b.next();if(d.done){c.complete();break}else c.next(d.value);if(c.closed){"function"===typeof b.return&&b.return();break}}while(1)};return a}(g),dc=function(){function b(a,
c,b){void 0===c&&(c=0);void 0===b&&(b=a.length);this.str=a;this.idx=c;this.len=b}b.prototype[A]=function(){return this};b.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}};return b}(),cc=function(){function b(a,c,b){void 0===c&&(c=0);if(void 0===b)if(b=+a.length,isNaN(b))b=0;else if(0!==b&&"number"===typeof b&&n.isFinite(b)){var e;e=+b;e=0===e?e:isNaN(e)?e:0>e?-1:1;b=e*Math.floor(Math.abs(b));b=0>=b?0:b>Ra?Ra:b}this.arr=a;this.idx=
c;this.len=b}b.prototype[A]=function(){return this};b.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}};return b}(),Ra=Math.pow(2,53)-1,fc=function(b){function a(c,a){b.call(this);this.arrayLike=c;this.scheduler=a;a||1!==c.length||(this._isScalar=!0,this.value=c[0])}h(a,b);a.create=function(c,b){var e=c.length;return 0===e?new F:1===e?new ga(c[0],b):new a(c,b)};a.dispatch=function(c){var a=c.arrayLike,b=c.index,f=c.subscriber;f.closed||
(b>=c.length?f.complete():(f.next(a[b]),c.index=b+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=this.arrayLike,d=this.scheduler,f=b.length;if(d)return d.schedule(a.dispatch,0,{arrayLike:b,index:0,length:f,subscriber:c});for(d=0;d<f&&!c.closed;d++)c.next(b[d]);c.complete()};return a}(g),w=function(){function b(a,c,b){this.kind=a;this.value=c;this.error=b;this.hasValue="N"===a}b.prototype.observe=function(a){switch(this.kind){case "N":return a.next&&a.next(this.value);case "E":return a.error&&
a.error(this.error);case "C":return a.complete&&a.complete()}};b.prototype.do=function(a,c,b){switch(this.kind){case "N":return a&&a(this.value);case "E":return c&&c(this.error);case "C":return b&&b()}};b.prototype.accept=function(a,c,b){return a&&"function"===typeof a.next?this.observe(a):this.do(a,c,b)};b.prototype.toObservable=function(){switch(this.kind){case "N":return g.of(this.value);case "E":return g.throw(this.error);case "C":return g.empty()}throw Error("unexpected notification kind value");
};b.createNext=function(a){return"undefined"!==typeof a?new b("N",a):this.undefinedValueNotification};b.createError=function(a){return new b("E",void 0,a)};b.createComplete=function(){return this.completeNotification};b.completeNotification=new b("C");b.undefinedValueNotification=new b("N",void 0);return b}(),gc=function(){function b(a,c){void 0===c&&(c=0);this.scheduler=a;this.delay=c}b.prototype.call=function(a,c){return c.subscribe(new ia(a,this.scheduler,this.delay))};return b}(),ia=function(b){function a(c,
a,d){void 0===d&&(d=0);b.call(this,c);this.scheduler=a;this.delay=d}h(a,b);a.dispatch=function(c){c.notification.observe(c.destination);this.unsubscribe()};a.prototype.scheduleMessage=function(c){this.add(this.scheduler.schedule(a.dispatch,this.delay,new hc(c,this.destination)))};a.prototype._next=function(c){this.scheduleMessage(w.createNext(c))};a.prototype._error=function(c){this.scheduleMessage(w.createError(c))};a.prototype._complete=function(){this.scheduleMessage(w.createComplete())};return a}(l),
hc=function(){return function(b,a){this.notification=b;this.destination=a}}(),Sa=function(b){function a(c,a){b.call(this,null);this.ish=c;this.scheduler=a}h(a,b);a.create=function(c,b){if(null!=c){if("function"===typeof c[H])return c instanceof g&&!b?c:new a(c,b);if(D(c))return new E(c,b);if(pa(c))return new Qa(c,b);if("function"===typeof c[A]||"string"===typeof c)return new ec(c,b);if(c&&"number"===typeof c.length)return new fc(c,b)}throw new TypeError((null!==c&&typeof c||c)+" is not observable");
};a.prototype._subscribe=function(c){var a=this.ish,b=this.scheduler;return null==b?a[H]().subscribe(c):a[H]().subscribe(new ia(c,b,0))};return a}(g);g.from=Sa.create;var Ta=Object.prototype.toString,ic=function(b){function a(c,a,d,f){b.call(this);this.sourceObj=c;this.eventName=a;this.selector=d;this.options=f}h(a,b);a.create=function(c,b,d,f){M(d)&&(f=d,d=void 0);return new a(c,b,f,d)};a.setupSubscription=function(c,b,d,f,k){var e;if(c&&"[object NodeList]"===Ta.call(c)||c&&"[object HTMLCollection]"===
Ta.call(c))for(var g=0,h=c.length;g<h;g++)a.setupSubscription(c[g],b,d,f,k);else if(c&&"function"===typeof c.addEventListener&&"function"===typeof c.removeEventListener)c.addEventListener(b,d,k),e=function(){return c.removeEventListener(b,d)};else if(c&&"function"===typeof c.on&&"function"===typeof c.off)c.on(b,d),e=function(){return c.off(b,d)};else if(c&&"function"===typeof c.addListener&&"function"===typeof c.removeListener)c.addListener(b,d),e=function(){return c.removeListener(b,d)};else throw new TypeError("Invalid event target");
f.add(new u(e))};a.prototype._subscribe=function(c){var b=this.selector;a.setupSubscription(this.sourceObj,this.eventName,b?function(){for(var a=[],e=0;e<arguments.length;e++)a[e-0]=arguments[e];a=r(b).apply(void 0,a);a===m?c.error(m.e):c.next(a)}:function(a){return c.next(a)},c,this.options)};return a}(g).create;g.fromEvent=ic;var jc=function(b){function a(c,a,d){b.call(this);this.addHandler=c;this.removeHandler=a;this.selector=d}h(a,b);a.create=function(c,b,d){return new a(c,b,d)};a.prototype._subscribe=
function(c){var a=this,b=this.removeHandler,f=this.selector?function(){for(var b=[],e=0;e<arguments.length;e++)b[e-0]=arguments[e];a._callSelector(c,b)}:function(a){c.next(a)},k=this._callAddHandler(f,c);M(b)&&c.add(new u(function(){b(f,k)}))};a.prototype._callSelector=function(c,a){try{var b=this.selector.apply(this,a);c.next(b)}catch(f){c.error(f)}};a.prototype._callAddHandler=function(c,a){try{return this.addHandler(c)||null}catch(d){a.error(d)}};return a}(g).create;g.fromEventPattern=jc;g.fromPromise=
Qa.create;var Ua=function(b){return b},kc=function(b){function a(c,a,d,f,k){b.call(this);this.initialState=c;this.condition=a;this.iterate=d;this.resultSelector=f;this.scheduler=k}h(a,b);a.create=function(c,b,d,f,k){return 1==arguments.length?new a(c.initialState,c.condition,c.iterate,c.resultSelector||Ua,c.scheduler):void 0===f||z(f)?new a(c,b,d,Ua,f):new a(c,b,d,f,k)};a.prototype._subscribe=function(c){var b=this.initialState;if(this.scheduler)return this.scheduler.schedule(a.dispatch,0,{subscriber:c,
iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:b});var d=this.condition,f=this.resultSelector,k=this.iterate;do{if(d){var g=void 0;try{g=d(b)}catch(C){c.error(C);break}if(!g){c.complete();break}}g=void 0;try{g=f(b)}catch(C){c.error(C);break}c.next(g);if(c.closed)break;try{b=k(b)}catch(C){c.error(C);break}}while(1)};a.dispatch=function(c){var a=c.subscriber,b=c.condition;if(!a.closed){if(c.needIterate)try{c.state=c.iterate(c.state)}catch(y){a.error(y);return}else c.needIterate=
!0;if(b){var f=void 0;try{f=b(c.state)}catch(y){a.error(y);return}if(!f){a.complete();return}if(a.closed)return}var k;try{k=c.resultSelector(c.state)}catch(y){a.error(y);return}if(!a.closed&&(a.next(k),!a.closed))return this.schedule(c)}};return a}(g);g.generate=kc.create;var mc=function(b){function a(c,a,d){b.call(this);this.condition=c;this.thenSource=a;this.elseSource=d}h(a,b);a.create=function(c,b,d){return new a(c,b,d)};a.prototype._subscribe=function(c){return new lc(c,this.condition,this.thenSource,
this.elseSource)};return a}(g),lc=function(b){function a(c,a,d,f){b.call(this,c);this.condition=a;this.thenSource=d;this.elseSource=f;this.tryIf()}h(a,b);a.prototype.tryIf=function(){var c=this.condition,a=this.thenSource,b=this.elseSource,f;try{(c=(f=c())?a:b)?this.add(p(this,c)):this._complete()}catch(k){this._error(k)}};return a}(q);g.if=mc.create;var R=function(b){function a(c,a){b.call(this,c,a);this.scheduler=c;this.work=a;this.pending=!1}h(a,b);a.prototype.schedule=function(c,a){void 0===a&&
(a=0);if(this.closed)return this;this.state=c;this.pending=!0;c=this.id;var b=this.scheduler;null!=c&&(this.id=this.recycleAsyncId(b,c,a));this.delay=a;this.id=this.id||this.requestAsyncId(b,this.id,a);return this};a.prototype.requestAsyncId=function(c,a,b){void 0===b&&(b=0);return n.setInterval(c.flush.bind(c,this),b)};a.prototype.recycleAsyncId=function(c,a,b){void 0===b&&(b=0);return null!==b&&this.delay===b?a:(n.clearInterval(a),void 0)};a.prototype.execute=function(c,a){if(this.closed)return Error("executing a cancelled action");
this.pending=!1;if(c=this._execute(c,a))return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))};a.prototype._execute=function(c,a){a=!1;var b=void 0;try{this.work(c)}catch(f){a=!0,b=!!f&&f||Error(f)}if(a)return this.unsubscribe(),b};a.prototype._unsubscribe=function(){var c=this.id,a=this.scheduler,b=a.actions,f=b.indexOf(this);this.state=this.delay=this.work=null;this.pending=!1;this.scheduler=null;-1!==f&&b.splice(f,1);null!=c&&(this.id=this.recycleAsyncId(a,
c,null))};return a}(function(b){function a(c,a){b.call(this)}h(a,b);a.prototype.schedule=function(c,a){return this};return a}(u)),S=function(b){function a(){b.apply(this,arguments);this.actions=[];this.active=!1;this.scheduled=void 0}h(a,b);a.prototype.flush=function(c){var a=this.actions;if(this.active)a.push(c);else{var b;this.active=!0;do if(b=c.execute(c.state,c.delay))break;while(c=a.shift());this.active=!1;if(b){for(;c=a.shift();)c.unsubscribe();throw b;}}};return a}(function(){function b(a,
c){void 0===c&&(c=b.now);this.SchedulerAction=a;this.now=c}b.prototype.schedule=function(a,c,b){void 0===c&&(c=0);return(new this.SchedulerAction(this,a)).schedule(b,c)};b.now=Date.now?Date.now:function(){return+new Date};return b}()),x=new S(R),nc=function(b){function a(c,a){void 0===c&&(c=0);void 0===a&&(a=x);b.call(this);this.period=c;this.scheduler=a;if(!P(c)||0>c)this.period=0;a&&"function"===typeof a.schedule||(this.scheduler=x)}h(a,b);a.create=function(c,b){void 0===c&&(c=0);void 0===b&&(b=
x);return new a(c,b)};a.dispatch=function(c){var a=c.subscriber,b=c.period;a.next(c.index);a.closed||(c.index+=1,this.schedule(c,b))};a.prototype._subscribe=function(c){var b=this.period;c.add(this.scheduler.schedule(a.dispatch,b,{index:0,subscriber:c,period:b}))};return a}(g).create;g.interval=nc;g.merge=sa;var tb=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new oc(a))};return b}(),oc=function(b){function a(c){b.call(this,c);this.hasFirst=!1;this.observables=[];this.subscriptions=
[]}h(a,b);a.prototype._next=function(c){this.observables.push(c)};a.prototype._complete=function(){var c=this.observables,a=c.length;if(0===a)this.destination.complete();else{for(var b=0;b<a&&!this.hasFirst;b++){var f=c[b],f=p(this,f,f,b);this.subscriptions&&this.subscriptions.push(f);this.add(f)}this.observables=null}};a.prototype.notifyNext=function(c,a,b,f,k){if(!this.hasFirst){this.hasFirst=!0;for(c=0;c<this.subscriptions.length;c++)c!==b&&(f=this.subscriptions[c],f.unsubscribe(),this.remove(f));
this.subscriptions=null}this.destination.next(a)};return a}(q);g.race=ta;var pc=function(b){function a(){b.call(this)}h(a,b);a.create=function(){return new a};a.prototype._subscribe=function(c){};return a}(g).create;g.never=pc;g.of=E.of;var Va=function(){function b(a){this.nextSources=a}b.prototype.call=function(a,c){return c.subscribe(new qc(a,this.nextSources))};return b}(),qc=function(b){function a(c,a){b.call(this,c);this.destination=c;this.nextSources=a}h(a,b);a.prototype.notifyError=function(c,
a){this.subscribeToNextSource()};a.prototype.notifyComplete=function(c){this.subscribeToNextSource()};a.prototype._error=function(c){this.subscribeToNextSource()};a.prototype._complete=function(){this.subscribeToNextSource()};a.prototype.subscribeToNextSource=function(){var c=this.nextSources.shift();c?this.add(p(this,c)):this.destination.complete()};return a}(q);g.onErrorResumeNext=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];1===b.length&&D(b[0])&&(b=b[0]);a=b.shift();
return(new Sa(a,null)).lift(new Va(b))};var rc=function(b){function a(c,a){b.call(this);this.obj=c;this.scheduler=a;this.keys=Object.keys(c)}h(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=this.keys,b=this.scheduler,f=a.length;if(b)return b.schedule(ub,0,{obj:this.obj,keys:a,length:f,index:0,subscriber:c});for(b=0;b<f;b++){var k=a[b];c.next([k,this.obj[k]])}c.complete()};return a}(g).create;g.pairs=rc;var sc=function(b){function a(c,a,d){b.call(this);this.start=
c;this._count=a;this.scheduler=d}h(a,b);a.create=function(c,b,d){void 0===c&&(c=0);void 0===b&&(b=0);return new a(c,b,d)};a.dispatch=function(c){var a=c.start,b=c.index,f=c.subscriber;b>=c.count?f.complete():(f.next(a),f.closed||(c.index=b+1,c.start=a+1,this.schedule(c)))};a.prototype._subscribe=function(c){var b=0,d=this.start,f=this._count,k=this.scheduler;if(k)return k.schedule(a.dispatch,0,{index:b,count:f,start:d,subscriber:c});do{if(b++>=f){c.complete();break}c.next(d++);if(c.closed)break}while(1)};
return a}(g).create;g.range=sc;var uc=function(b){function a(c,a){b.call(this);this.resourceFactory=c;this.observableFactory=a}h(a,b);a.create=function(c,b){return new a(c,b)};a.prototype._subscribe=function(c){var a=this.resourceFactory,b=this.observableFactory,f;try{return f=a(),new tc(c,f,b)}catch(k){c.error(k)}};return a}(g),tc=function(b){function a(c,a,d){b.call(this,c);this.resource=a;this.observableFactory=d;c.add(a);this.tryUse()}h(a,b);a.prototype.tryUse=function(){try{var c=this.observableFactory.call(this,
this.resource);c&&this.add(p(this,c))}catch(e){this._error(e)}};return a}(q);g.using=uc.create;var vc=function(b){function a(c,a){b.call(this);this.error=c;this.scheduler=a}h(a,b);a.create=function(c,b){return new a(c,b)};a.dispatch=function(c){c.subscriber.error(c.error)};a.prototype._subscribe=function(c){var b=this.error,d=this.scheduler;if(d)return d.schedule(a.dispatch,0,{error:b,subscriber:c});c.error(b)};return a}(g).create;g.throw=vc;var wc=function(b){function a(c,a,d){void 0===c&&(c=0);
b.call(this);this.period=-1;this.dueTime=0;P(a)?this.period=1>Number(a)&&1||Number(a):z(a)&&(d=a);z(d)||(d=x);this.scheduler=d;this.dueTime=X(c)?+c-this.scheduler.now():c}h(a,b);a.create=function(c,b,d){void 0===c&&(c=0);return new a(c,b,d)};a.dispatch=function(c){var a=c.index,b=c.period,f=c.subscriber;f.next(a);if(!f.closed){if(-1===b)return f.complete();c.index=a+1;this.schedule(c,b)}};a.prototype._subscribe=function(c){return this.scheduler.schedule(a.dispatch,this.dueTime,{index:0,period:this.period,
subscriber:c})};return a}(g).create;g.timer=wc;var va=function(){function b(a){this.project=a}b.prototype.call=function(a,c){return c.subscribe(new xc(a,this.project))};return b}(),xc=function(b){function a(c,a,d){void 0===d&&(d=Object.create(null));b.call(this,c);this.iterators=[];this.active=0;this.project="function"===typeof a?a:null;this.values=d}h(a,b);a.prototype._next=function(c){var a=this.iterators;D(c)?a.push(new yc(c)):"function"===typeof c[A]?a.push(new zc(c[A]())):a.push(new Ac(this.destination,
this,c))};a.prototype._complete=function(){var c=this.iterators,a=c.length;this.active=a;for(var b=0;b<a;b++){var f=c[b];f.stillUnsubscribed?this.add(f.subscribe(f,b)):this.active--}};a.prototype.notifyInactive=function(){this.active--;0===this.active&&this.destination.complete()};a.prototype.checkIterators=function(){for(var c=this.iterators,a=c.length,b=this.destination,f=0;f<a;f++){var k=c[f];if("function"===typeof k.hasValue&&!k.hasValue())return}for(var g=!1,h=[],f=0;f<a;f++){var k=c[f],l=k.next();
k.hasCompleted()&&(g=!0);if(l.done){b.complete();return}h.push(l.value)}this.project?this._tryProject(h):b.next(h);g&&b.complete()};a.prototype._tryProject=function(c){var a;try{a=this.project.apply(this,c)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(l),zc=function(){function b(a){this.iterator=a;this.nextResult=a.next()}b.prototype.hasValue=function(){return!0};b.prototype.next=function(){var a=this.nextResult;this.nextResult=this.iterator.next();return a};b.prototype.hasCompleted=
function(){var a=this.nextResult;return a&&a.done};return b}(),yc=function(){function b(a){this.array=a;this.length=this.index=0;this.length=a.length}b.prototype[A]=function(){return this};b.prototype.next=function(a){a=this.index++;var c=this.array;return a<this.length?{value:c[a],done:!1}:{value:null,done:!0}};b.prototype.hasValue=function(){return this.array.length>this.index};b.prototype.hasCompleted=function(){return this.array.length===this.index};return b}(),Ac=function(b){function a(c,a,d){b.call(this,
c);this.parent=a;this.observable=d;this.stillUnsubscribed=!0;this.buffer=[];this.isComplete=!1}h(a,b);a.prototype[A]=function(){return this};a.prototype.next=function(){var c=this.buffer;return 0===c.length&&this.isComplete?{value:null,done:!0}:{value:c.shift(),done:!1}};a.prototype.hasValue=function(){return 0<this.buffer.length};a.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete};a.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):
this.destination.complete()};a.prototype.notifyNext=function(c,a,b,f,k){this.buffer.push(a);this.parent.checkIterators()};a.prototype.subscribe=function(c,a){return p(this,this.observable,this,a)};return a}(q);g.zip=ua;var xa=function(){function b(a,c){this.project=a;this.thisArg=c}b.prototype.call=function(a,c){return c.subscribe(new Bc(a,this.project,this.thisArg))};return b}(),Bc=function(b){function a(c,a,d){b.call(this,c);this.project=a;this.count=0;this.thisArg=d||this}h(a,b);a.prototype._next=
function(c){var a;try{a=this.project.call(this.thisArg,c,this.count++)}catch(d){this.destination.error(d);return}this.destination.next(a)};return a}(l),I=function(b){function a(c){b.call(this);var a={async:!0,createXHR:function(){var c;if(this.crossDomain)if(n.XMLHttpRequest)c=new n.XMLHttpRequest;else if(n.XDomainRequest)c=new n.XDomainRequest;else throw Error("CORS is not supported by your browser");else if(n.XMLHttpRequest)c=new n.XMLHttpRequest;else{var a=void 0;try{for(var b=["Msxml2.XMLHTTP",
"Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=0;3>e;e++)try{a=b[e];new n.ActiveXObject(a);break}catch(B){}c=new n.ActiveXObject(a)}catch(B){throw Error("XMLHttpRequest is not supported by your browser");}}return c},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"===typeof c)a.url=c;else for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);this.request=a}h(a,b);a.prototype._subscribe=function(c){return new Cc(c,this.request)};a.create=function(){var c=function(c){return new a(c)};
c.get=vb;c.post=wb;c.delete=xb;c.put=yb;c.patch=zb;c.getJSON=Ab;return c}();return a}(g),Cc=function(b){function a(c,a){b.call(this,c);this.request=a;this.done=!1;c=a.headers=a.headers||{};a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");"Content-Type"in c||n.FormData&&a.body instanceof n.FormData||"undefined"===typeof a.body||(c["Content-Type"]="application/x-www-form-urlencoded; charset\x3dUTF-8");a.body=this.serializeBody(a.body,a.headers["Content-Type"]);this.send()}
h(a,b);a.prototype.next=function(c){this.done=!0;var a=this.destination;c=new Wa(c,this.xhr,this.request);a.next(c)};a.prototype.send=function(){var c=this.request,a=this.request,b=a.user,f=a.method,k=a.url,g=a.async,h=a.password,l=a.headers,a=a.body,n=r(c.createXHR).call(c);if(n===m)this.error(m.e);else{this.xhr=n;this.setupEvents(n,c);b=b?r(n.open).call(n,f,k,g,b,h):r(n.open).call(n,f,k,g);if(b===m)return this.error(m.e),null;n.timeout=c.timeout;n.responseType=c.responseType;"withCredentials"in
n&&(n.withCredentials=!!c.withCredentials);this.setHeaders(n,l);b=a?r(n.send).call(n,a):r(n.send).call(n);if(b===m)return this.error(m.e),null}return n};a.prototype.serializeBody=function(c,a){if(!c||"string"===typeof c||n.FormData&&c instanceof n.FormData)return c;if(a){var b=a.indexOf(";");-1!==b&&(a=a.substring(0,b))}switch(a){case "application/x-www-form-urlencoded":return Object.keys(c).map(function(a){return encodeURI(a)+"\x3d"+encodeURI(c[a])}).join("\x26");case "application/json":return JSON.stringify(c);
default:return c}};a.prototype.setHeaders=function(c,a){for(var b in a)a.hasOwnProperty(b)&&c.setRequestHeader(b,a[b])};a.prototype.setupEvents=function(c,a){function b(c){var a=b.subscriber,e=b.progressSubscriber,d=b.request;e&&e.error(c);a.error(new Xa(this,d))}function e(c){var a=e.subscriber,b=e.progressSubscriber,d=e.request;if(4===this.readyState){var f=1223===this.status?204:this.status,k="text"===this.responseType?this.response||this.responseText:this.response;0===f&&(f=k?200:0);200<=f&&300>
f?(b&&b.complete(),a.next(c),a.complete()):(b&&b.error(c),a.error(new Z("ajax error "+f,this,d)))}}var k=a.progressSubscriber;c.ontimeout=b;b.request=a;b.subscriber=this;b.progressSubscriber=k;if(c.upload&&"withCredentials"in c){if(k){var g;g=function(c){g.progressSubscriber.next(c)};n.XDomainRequest?c.onprogress=g:c.upload.onprogress=g;g.progressSubscriber=k}var h;h=function(c){var a=h.progressSubscriber,b=h.subscriber,e=h.request;a&&a.error(c);b.error(new Z("ajax error",this,e))};c.onerror=h;h.request=
a;h.subscriber=this;h.progressSubscriber=k}c.onreadystatechange=e;e.subscriber=this;e.progressSubscriber=k;e.request=a};a.prototype.unsubscribe=function(){var c=this.xhr;!this.done&&c&&4!==c.readyState&&"function"===typeof c.abort&&c.abort();b.prototype.unsubscribe.call(this)};return a}(l),Wa=function(){return function(b,a,c){this.originalEvent=b;this.xhr=a;this.request=c;this.status=a.status;this.responseType=a.responseType||c.responseType;switch(this.responseType){case "json":this.response="response"in
a?a.responseType?a.response:JSON.parse(a.response||a.responseText||"null"):JSON.parse(a.responseText||"null");break;case "xml":this.response=a.responseXML;break;default:this.response="response"in a?a.response:a.responseText}}}(),Z=function(b){function a(c,a,d){b.call(this,c);this.message=c;this.xhr=a;this.request=d;this.status=a.status}h(a,b);return a}(Error),Xa=function(b){function a(c,a){b.call(this,"ajax timeout",c,a)}h(a,b);return a}(Z);g.ajax=I.create;var Dc=function(b){function a(c,a){b.call(this,
c,a);this.scheduler=c;this.work=a}h(a,b);a.prototype.schedule=function(c,a){void 0===a&&(a=0);if(0<a)return b.prototype.schedule.call(this,c,a);this.delay=a;this.state=c;this.scheduler.flush(this);return this};a.prototype.execute=function(c,a){return 0<a||this.closed?b.prototype.execute.call(this,c,a):this._execute(c,a)};a.prototype.requestAsyncId=function(c,a,d){void 0===d&&(d=0);return null!==d&&0<d||null===d&&0<this.delay?b.prototype.requestAsyncId.call(this,c,a,d):c.flush(this)};return a}(R),
Ya=new (function(b){function a(){b.apply(this,arguments)}h(a,b);return a}(S))(Dc),L=function(b){function a(c,a,d){void 0===c&&(c=Number.POSITIVE_INFINITY);void 0===a&&(a=Number.POSITIVE_INFINITY);b.call(this);this.scheduler=d;this._events=[];this._bufferSize=1>c?1:c;this._windowTime=1>a?1:a}h(a,b);a.prototype.next=function(c){var a=this._getNow();this._events.push(new Ec(a,c));this._trimBufferThenGetEvents();b.prototype.next.call(this,c)};a.prototype._subscribe=function(c){var a=this._trimBufferThenGetEvents(),
b=this.scheduler,f;if(this.closed)throw new G;this.hasError?f=u.EMPTY:this.isStopped?f=u.EMPTY:(this.observers.push(c),f=new Na(this,c));b&&c.add(c=new ia(c,b));for(var b=a.length,k=0;k<b&&!c.closed;k++)c.next(a[k].value);this.hasError?c.error(this.thrownError):this.isStopped&&c.complete();return f};a.prototype._getNow=function(){return(this.scheduler||Ya).now()};a.prototype._trimBufferThenGetEvents=function(){for(var c=this._getNow(),a=this._bufferSize,b=this._windowTime,f=this._events,k=f.length,
g=0;g<k&&!(c-f[g].time<b);)g++;k>a&&(g=Math.max(g,k-a));0<g&&f.splice(0,g);return f};return a}(v),Ec=function(){return function(b,a){this.time=b;this.value=a}}(),Fc=n.Object.assign||Bb,Gc=function(b){function a(c,a){if(c instanceof g)b.call(this,a,c);else{b.call(this);this.WebSocketCtor=n.WebSocket;this._output=new v;"string"===typeof c?this.url=c:Fc(this,c);if(!this.WebSocketCtor)throw Error("no WebSocket constructor can be found");this.destination=new L}}h(a,b);a.prototype.resultSelector=function(c){return JSON.parse(c.data)};
a.create=function(c){return new a(c)};a.prototype.lift=function(c){var b=new a(this,this.destination);b.operator=c;return b};a.prototype._resetState=function(){this.socket=null;this.source||(this.destination=new L);this._output=new v};a.prototype.multiplex=function(c,a,b){var e=this;return new g(function(d){var f=r(c)();f===m?d.error(m.e):e.next(f);var k=e.subscribe(function(c){var a=r(b)(c);a===m?d.error(m.e):a&&d.next(c)},function(c){return d.error(c)},function(){return d.complete()});return function(){var c=
r(a)();c===m?d.error(m.e):e.next(c);k.unsubscribe()}})};a.prototype._connectSocket=function(){var c=this,a=this.WebSocketCtor,b=this._output,f=null;try{this.socket=f=this.protocol?new a(this.url,this.protocol):new a(this.url),this.binaryType&&(this.socket.binaryType=this.binaryType)}catch(y){b.error(y);return}var k=new u(function(){c.socket=null;f&&1===f.readyState&&f.close()});f.onopen=function(a){var e=c.openObserver;e&&e.next(a);a=c.destination;c.destination=l.create(function(c){return 1===f.readyState&&
f.send(c)},function(a){var e=c.closingObserver;e&&e.next(void 0);a&&a.code?f.close(a.code,a.reason):b.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }"));c._resetState()},function(){var a=c.closingObserver;a&&a.next(void 0);f.close();c._resetState()});a&&a instanceof L&&k.add(a.subscribe(c.destination))};f.onerror=function(a){c._resetState();b.error(a)};f.onclose=function(a){c._resetState();var e=
c.closeObserver;e&&e.next(a);a.wasClean?b.complete():b.error(a)};f.onmessage=function(a){a=r(c.resultSelector)(a);a===m?b.error(m.e):b.next(a)}};a.prototype._subscribe=function(c){var a=this,b=this.source;if(b)return b.subscribe(c);this.socket||this._connectSocket();b=new u;b.add(this._output.subscribe(c));b.add(function(){var c=a.socket;0===a._output.observers.length&&(c&&1===c.readyState&&c.close(),a._resetState())});return b};a.prototype.unsubscribe=function(){var c=this.source,a=this.socket;a&&
1===a.readyState&&(a.close(),this._resetState());b.prototype.unsubscribe.call(this);c||(this.destination=new L)};return a}(Y).create;g.webSocket=Gc;var Ic=function(){function b(a){this.closingNotifier=a}b.prototype.call=function(a,c){return c.subscribe(new Hc(a,this.closingNotifier))};return b}(),Hc=function(b){function a(c,a){b.call(this,c);this.buffer=[];this.add(p(this,a))}h(a,b);a.prototype._next=function(c){this.buffer.push(c)};a.prototype.notifyNext=function(c,a,b,f,k){c=this.buffer;this.buffer=
[];this.destination.next(c)};return a}(q);g.prototype.buffer=function(b){return this.lift(new Ic(b))};var Kc=function(){function b(a,c){this.bufferSize=a;this.startBufferEvery=c}b.prototype.call=function(a,c){return c.subscribe(new Jc(a,this.bufferSize,this.startBufferEvery))};return b}(),Jc=function(b){function a(c,a,d){b.call(this,c);this.bufferSize=a;this.startBufferEvery=d;this.buffers=[];this.count=0}h(a,b);a.prototype._next=function(c){var a=this.count++,b=this.destination,f=this.bufferSize,
k=this.startBufferEvery,g=this.buffers;0===a%(null==k?f:k)&&g.push([]);for(a=g.length;a--;)k=g[a],k.push(c),k.length===f&&(g.splice(a,1),b.next(k))};a.prototype._complete=function(){for(var c=this.destination,a=this.buffers;0<a.length;){var d=a.shift();0<d.length&&c.next(d)}b.prototype._complete.call(this)};return a}(l);g.prototype.bufferCount=function(b,a){void 0===a&&(a=null);return this.lift(new Kc(b,a))};var Mc=function(){function b(a,c,b,d){this.bufferTimeSpan=a;this.bufferCreationInterval=c;
this.maxBufferSize=b;this.scheduler=d}b.prototype.call=function(a,c){return c.subscribe(new Lc(a,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))};return b}(),Nc=function(){return function(){this.buffer=[]}}(),Lc=function(b){function a(c,a,d,f,k){b.call(this,c);this.bufferTimeSpan=a;this.bufferCreationInterval=d;this.maxBufferSize=f;this.scheduler=k;this.contexts=[];c=this.openContext();(this.timespanOnly=null==d||0>d)?this.add(c.closeAction=k.schedule(ya,a,{subscriber:this,
context:c,bufferTimeSpan:a})):(f={bufferTimeSpan:a,bufferCreationInterval:d,subscriber:this,scheduler:k},this.add(c.closeAction=k.schedule(za,a,{subscriber:this,context:c})),this.add(k.schedule(Cb,d,f)))}h(a,b);a.prototype._next=function(a){for(var c=this.contexts,b=c.length,f,k=0;k<b;k++){var g=c[k],h=g.buffer;h.push(a);h.length==this.maxBufferSize&&(f=g)}if(f)this.onBufferFull(f)};a.prototype._error=function(a){this.contexts.length=0;b.prototype._error.call(this,a)};a.prototype._complete=function(){for(var a=
this.contexts,e=this.destination;0<a.length;){var d=a.shift();e.next(d.buffer)}b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.contexts=null};a.prototype.onBufferFull=function(a){this.closeContext(a);a=a.closeAction;a.unsubscribe();this.remove(a);if(!this.closed&&this.timespanOnly){a=this.openContext();var c=this.bufferTimeSpan;this.add(a.closeAction=this.scheduler.schedule(ya,c,{subscriber:this,context:a,bufferTimeSpan:c}))}};a.prototype.openContext=function(){var a=new Nc;
this.contexts.push(a);return a};a.prototype.closeContext=function(a){this.destination.next(a.buffer);var c=this.contexts;0<=(c?c.indexOf(a):-1)&&c.splice(c.indexOf(a),1)};return a}(l);g.prototype.bufferTime=function(b){var a=arguments.length,c=x;z(arguments[arguments.length-1])&&(c=arguments[arguments.length-1],a--);var e=null;2<=a&&(e=arguments[1]);var d=Number.POSITIVE_INFINITY;3<=a&&(d=arguments[2]);return this.lift(new Mc(b,e,d,c))};var Pc=function(){function b(a,c){this.openings=a;this.closingSelector=
c}b.prototype.call=function(a,c){return c.subscribe(new Oc(a,this.openings,this.closingSelector))};return b}(),Oc=function(b){function a(a,e,d){b.call(this,a);this.openings=e;this.closingSelector=d;this.contexts=[];this.add(p(this,e))}h(a,b);a.prototype._next=function(a){for(var c=this.contexts,b=c.length,f=0;f<b;f++)c[f].buffer.push(a)};a.prototype._error=function(a){for(var c=this.contexts;0<c.length;){var d=c.shift();d.subscription.unsubscribe();d.buffer=null;d.subscription=null}this.contexts=
null;b.prototype._error.call(this,a)};a.prototype._complete=function(){for(var a=this.contexts;0<a.length;){var e=a.shift();this.destination.next(e.buffer);e.subscription.unsubscribe();e.buffer=null;e.subscription=null}this.contexts=null;b.prototype._complete.call(this)};a.prototype.notifyNext=function(a,b,d,f,k){a?this.closeBuffer(a):this.openBuffer(b)};a.prototype.notifyComplete=function(a){this.closeBuffer(a.context)};a.prototype.openBuffer=function(a){try{var c=this.closingSelector.call(this,
a);c&&this.trySubscribe(c)}catch(d){this._error(d)}};a.prototype.closeBuffer=function(a){var c=this.contexts;if(c&&a){var b=a.subscription;this.destination.next(a.buffer);c.splice(c.indexOf(a),1);this.remove(b);b.unsubscribe()}};a.prototype.trySubscribe=function(a){var c=this.contexts,b=new u,f={buffer:[],subscription:b};c.push(f);a=p(this,a,f);!a||a.closed?this.closeBuffer(f):(a.context=f,this.add(a),b.add(a))};return a}(q);g.prototype.bufferToggle=function(b,a){return this.lift(new Pc(b,a))};var Rc=
function(){function b(a){this.closingSelector=a}b.prototype.call=function(a,c){return c.subscribe(new Qc(a,this.closingSelector))};return b}(),Qc=function(b){function a(a,e){b.call(this,a);this.closingSelector=e;this.subscribing=!1;this.openBuffer()}h(a,b);a.prototype._next=function(a){this.buffer.push(a)};a.prototype._complete=function(){var a=this.buffer;a&&this.destination.next(a);b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.buffer=null;this.subscribing=!1};a.prototype.notifyNext=
function(a,b,d,f,k){this.openBuffer()};a.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()};a.prototype.openBuffer=function(){var a=this.closingSubscription;a&&(this.remove(a),a.unsubscribe());(a=this.buffer)&&this.destination.next(a);this.buffer=[];var b=r(this.closingSelector)();b===m?this.error(m.e):(this.closingSubscription=a=new u,this.add(a),this.subscribing=!0,a.add(p(this,b)),this.subscribing=!1)};return a}(q);g.prototype.bufferWhen=function(b){return this.lift(new Rc(b))};
var Db=function(){function b(a){this.selector=a}b.prototype.call=function(a,c){return c.subscribe(new Sc(a,this.selector,this.caught))};return b}(),Sc=function(b){function a(a,e,d){b.call(this,a);this.selector=e;this.caught=d}h(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=void 0;try{c=this.selector(a,this.caught)}catch(d){b.prototype.error.call(this,d);return}this._unsubscribeAndRecycle();this.add(p(this,c))}};return a}(q);g.prototype.catch=Aa;g.prototype._catch=Aa;g.prototype.combineAll=
function(b){return this.lift(new ha(b))};g.prototype.combineLatest=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];a=null;"function"===typeof b[b.length-1]&&(a=b.pop());1===b.length&&D(b[0])&&(b=b[0].slice());b.unshift(this);return this.lift.call(new E(b),new ha(a))};g.prototype.concat=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return this.lift.call(O.apply(void 0,[this].concat(b)))};g.prototype.concatAll=function(){return this.lift(new W(1))};var Ca=
function(){function b(a,c,b){void 0===b&&(b=Number.POSITIVE_INFINITY);this.project=a;this.resultSelector=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new Tc(a,this.project,this.resultSelector,this.concurrent))};return b}(),Tc=function(b){function a(a,e,d,f){void 0===f&&(f=Number.POSITIVE_INFINITY);b.call(this,a);this.project=e;this.resultSelector=d;this.concurrent=f;this.hasCompleted=!1;this.buffer=[];this.index=this.active=0}h(a,b);a.prototype._next=function(a){this.active<
this.concurrent?this._tryNext(a):this.buffer.push(a)};a.prototype._tryNext=function(a){var c,b=this.index++;try{c=this.project(a,b)}catch(f){this.destination.error(f);return}this.active++;this._innerSub(c,a,b)};a.prototype._innerSub=function(a,b,d){this.add(p(this,a,b,d))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,k){this.resultSelector?this._notifyResultSelector(a,b,d,f):this.destination.next(b)};
a.prototype._notifyResultSelector=function(a,b,d,f){var c;try{c=this.resultSelector(a,b,d,f)}catch(y){this.destination.error(y);return}this.destination.next(c)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;0<c.length?this._next(c.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()};return a}(q);g.prototype.concatMap=function(b,a){return this.lift(new Ca(b,a,1))};var Ea=function(){function b(a,c,b){void 0===b&&(b=Number.POSITIVE_INFINITY);
this.ish=a;this.resultSelector=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new Uc(a,this.ish,this.resultSelector,this.concurrent))};return b}(),Uc=function(b){function a(a,e,d,f){void 0===f&&(f=Number.POSITIVE_INFINITY);b.call(this,a);this.ish=e;this.resultSelector=d;this.concurrent=f;this.hasCompleted=!1;this.buffer=[];this.index=this.active=0}h(a,b);a.prototype._next=function(a){if(this.active<this.concurrent){var c=this.resultSelector,b=this.index++,f=this.ish,k=this.destination;
this.active++;this._innerSub(f,k,c,a,b)}else this.buffer.push(a)};a.prototype._innerSub=function(a,b,d,f,k){this.add(p(this,a,f,k))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,k){k=this.destination;this.resultSelector?this.trySelectResult(a,b,d,f):k.next(b)};a.prototype.trySelectResult=function(a,b,d,f){var c=this.resultSelector,e=this.destination,g;try{g=c(a,b,d,f)}catch(B){e.error(B);
return}e.next(g)};a.prototype.notifyError=function(a){this.destination.error(a)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;0<c.length?this._next(c.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()};return a}(q);g.prototype.concatMapTo=function(b,a){return this.lift(new Ea(b,a,1))};var Wc=function(){function b(a,c){this.predicate=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new Vc(a,this.predicate,this.source))};
return b}(),Vc=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.source=d;this.index=this.count=0}h(a,b);a.prototype._next=function(a){this.predicate?this._tryPredicate(a):this.count++};a.prototype._tryPredicate=function(a){var c;try{c=this.predicate(a,this.index++,this.source)}catch(d){this.destination.error(d);return}c&&this.count++};a.prototype._complete=function(){this.destination.next(this.count);this.destination.complete()};return a}(l);g.prototype.count=function(b){return this.lift(new Wc(b,
this))};var Yc=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Xc(a))};return b}(),Xc=function(b){function a(a){b.call(this,a)}h(a,b);a.prototype._next=function(a){a.observe(this.destination)};return a}(l);g.prototype.dematerialize=function(){return this.lift(new Yc)};var $c=function(){function b(a){this.durationSelector=a}b.prototype.call=function(a,c){return c.subscribe(new Zc(a,this.durationSelector))};return b}(),Zc=function(b){function a(a,e){b.call(this,a);this.durationSelector=
e;this.hasValue=!1;this.durationSubscription=null}h(a,b);a.prototype._next=function(a){try{var c=this.durationSelector.call(this,a);c&&this._tryNext(a,c)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){this.emitValue();this.destination.complete()};a.prototype._tryNext=function(a,b){var c=this.durationSubscription;this.value=a;this.hasValue=!0;c&&(c.unsubscribe(),this.remove(c));c=p(this,b);c.closed||this.add(this.durationSubscription=c)};a.prototype.notifyNext=function(a,b,d,
f,k){this.emitValue()};a.prototype.notifyComplete=function(){this.emitValue()};a.prototype.emitValue=function(){if(this.hasValue){var a=this.value,e=this.durationSubscription;e&&(this.durationSubscription=null,e.unsubscribe(),this.remove(e));this.value=null;this.hasValue=!1;b.prototype._next.call(this,a)}};return a}(q);g.prototype.debounce=function(b){return this.lift(new $c(b))};var bd=function(){function b(a,c){this.dueTime=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new ad(a,
this.dueTime,this.scheduler))};return b}(),ad=function(b){function a(a,e,d){b.call(this,a);this.dueTime=e;this.scheduler=d;this.lastValue=this.debouncedSubscription=null;this.hasValue=!1}h(a,b);a.prototype._next=function(a){this.clearDebounce();this.lastValue=a;this.hasValue=!0;this.add(this.debouncedSubscription=this.scheduler.schedule(Eb,this.dueTime,this))};a.prototype._complete=function(){this.debouncedNext();this.destination.complete()};a.prototype.debouncedNext=function(){this.clearDebounce();
this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)};a.prototype.clearDebounce=function(){var a=this.debouncedSubscription;null!==a&&(this.remove(a),a.unsubscribe(),this.debouncedSubscription=null)};return a}(l);g.prototype.debounceTime=function(b,a){void 0===a&&(a=x);return this.lift(new bd(b,a))};var dd=function(){function b(a){this.defaultValue=a}b.prototype.call=function(a,c){return c.subscribe(new cd(a,this.defaultValue))};return b}(),cd=function(b){function a(a,
e){b.call(this,a);this.defaultValue=e;this.isEmpty=!0}h(a,b);a.prototype._next=function(a){this.isEmpty=!1;this.destination.next(a)};a.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue);this.destination.complete()};return a}(l);g.prototype.defaultIfEmpty=function(b){void 0===b&&(b=null);return this.lift(new dd(b))};var fd=function(){function b(a,c){this.delay=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new ed(a,this.delay,this.scheduler))};
return b}(),ed=function(b){function a(a,e,d){b.call(this,a);this.delay=e;this.scheduler=d;this.queue=[];this.errored=this.active=!1}h(a,b);a.dispatch=function(a){for(var c=a.source,b=c.queue,f=a.scheduler,k=a.destination;0<b.length&&0>=b[0].time-f.now();)b.shift().notification.observe(k);0<b.length?(c=Math.max(0,b[0].time-f.now()),this.schedule(a,c)):c.active=!1};a.prototype._schedule=function(c){this.active=!0;this.add(c.schedule(a.dispatch,this.delay,{source:this,destination:this.destination,scheduler:c}))};
a.prototype.scheduleNotification=function(a){if(!0!==this.errored){var c=this.scheduler;a=new gd(c.now()+this.delay,a);this.queue.push(a);!1===this.active&&this._schedule(c)}};a.prototype._next=function(a){this.scheduleNotification(w.createNext(a))};a.prototype._error=function(a){this.errored=!0;this.queue=[];this.destination.error(a)};a.prototype._complete=function(){this.scheduleNotification(w.createComplete())};return a}(l),gd=function(){return function(b,a){this.time=b;this.notification=a}}();
g.prototype.delay=function(b,a){void 0===a&&(a=x);b=X(b)?+b-a.now():Math.abs(b);return this.lift(new fd(b,a))};var Za=function(){function b(a){this.delayDurationSelector=a}b.prototype.call=function(a,c){return c.subscribe(new hd(a,this.delayDurationSelector))};return b}(),hd=function(b){function a(a,e){b.call(this,a);this.delayDurationSelector=e;this.completed=!1;this.delayNotifierSubscriptions=[];this.values=[]}h(a,b);a.prototype.notifyNext=function(a,b,d,f,k){this.destination.next(a);this.removeSubscription(k);
this.tryComplete()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){(a=this.removeSubscription(a))&&this.destination.next(a);this.tryComplete()};a.prototype._next=function(a){try{var c=this.delayDurationSelector(a);c&&this.tryDelay(c,a)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){this.completed=!0;this.tryComplete()};a.prototype.removeSubscription=function(a){a.unsubscribe();a=this.delayNotifierSubscriptions.indexOf(a);var c=null;
-1!==a&&(c=this.values[a],this.delayNotifierSubscriptions.splice(a,1),this.values.splice(a,1));return c};a.prototype.tryDelay=function(a,b){a=p(this,a,b);this.add(a);this.delayNotifierSubscriptions.push(a);this.values.push(b)};a.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()};return a}(q),jd=function(b){function a(a,e){b.call(this);this.source=a;this.subscriptionDelay=e}h(a,b);a.prototype._subscribe=function(a){this.subscriptionDelay.subscribe(new id(a,
this.source))};return a}(g),id=function(b){function a(a,e){b.call(this);this.parent=a;this.source=e;this.sourceSubscribed=!1}h(a,b);a.prototype._next=function(a){this.subscribeToSource()};a.prototype._error=function(a){this.unsubscribe();this.parent.error(a)};a.prototype._complete=function(){this.subscribeToSource()};a.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))};return a}(l);g.prototype.delayWhen=function(b,
a){return a?(new jd(this,a)).lift(new Za(b)):this.lift(new Za(b))};var kd=n.Set||Fb(),md=function(){function b(a,c){this.keySelector=a;this.flushes=c}b.prototype.call=function(a,c){return c.subscribe(new ld(a,this.keySelector,this.flushes))};return b}(),ld=function(b){function a(a,e,d){b.call(this,a);this.keySelector=e;this.values=new kd;d&&this.add(p(this,d))}h(a,b);a.prototype.notifyNext=function(a,b,d,f,k){this.values.clear()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype._next=
function(a){this.keySelector?this._useKeySelector(a):this._finalizeNext(a,a)};a.prototype._useKeySelector=function(a){var c,b=this.destination;try{c=this.keySelector(a)}catch(f){b.error(f);return}this._finalizeNext(c,a)};a.prototype._finalizeNext=function(a,b){var c=this.values;c.has(a)||(c.add(a),this.destination.next(b))};return a}(q);g.prototype.distinct=function(b,a){return this.lift(new md(b,a))};var Gb=function(){function b(a,c){this.compare=a;this.keySelector=c}b.prototype.call=function(a,
c){return c.subscribe(new nd(a,this.compare,this.keySelector))};return b}(),nd=function(b){function a(a,e,d){b.call(this,a);this.keySelector=d;this.hasKey=!1;"function"===typeof e&&(this.compare=e)}h(a,b);a.prototype.compare=function(a,b){return a===b};a.prototype._next=function(a){var c=a;if(this.keySelector&&(c=r(this.keySelector)(a),c===m))return this.destination.error(m.e);var b=!1;if(this.hasKey){if(b=r(this.compare)(this.key,c),b===m)return this.destination.error(m.e)}else this.hasKey=!0;!1===
!!b&&(this.key=c,this.destination.next(a))};return a}(l);g.prototype.distinctUntilChanged=Fa;g.prototype.distinctUntilKeyChanged=function(b,a){return Fa.call(this,function(c,e){return a?a(c[b],e[b]):c[b]===e[b]})};var Hb=function(){function b(a,c,b){this.nextOrObserver=a;this.error=c;this.complete=b}b.prototype.call=function(a,c){return c.subscribe(new od(a,this.nextOrObserver,this.error,this.complete))};return b}(),od=function(b){function a(a,e,d,f){b.call(this,a);a=new l(e,d,f);a.syncErrorThrowable=
!0;this.add(a);this.safeSubscriber=a}h(a,b);a.prototype._next=function(a){var c=this.safeSubscriber;c.next(a);c.syncErrorThrown?this.destination.error(c.syncErrorValue):this.destination.next(a)};a.prototype._error=function(a){var c=this.safeSubscriber;c.error(a);c.syncErrorThrown?this.destination.error(c.syncErrorValue):this.destination.error(a)};a.prototype._complete=function(){var a=this.safeSubscriber;a.complete();a.syncErrorThrown?this.destination.error(a.syncErrorValue):this.destination.complete()};
return a}(l);g.prototype.do=Ga;g.prototype._do=Ga;var qd=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new pd(a))};return b}(),pd=function(b){function a(a){b.call(this,a);this.hasSubscription=this.hasCompleted=!1}h(a,b);a.prototype._next=function(a){this.hasSubscription||(this.hasSubscription=!0,this.add(p(this,a)))};a.prototype._complete=function(){this.hasCompleted=!0;this.hasSubscription||this.destination.complete()};a.prototype.notifyComplete=function(a){this.remove(a);
this.hasSubscription=!1;this.hasCompleted&&this.destination.complete()};return a}(q);g.prototype.exhaust=function(){return this.lift(new qd)};var sd=function(){function b(a,c){this.project=a;this.resultSelector=c}b.prototype.call=function(a,c){return c.subscribe(new rd(a,this.project,this.resultSelector))};return b}(),rd=function(b){function a(a,e,d){b.call(this,a);this.project=e;this.resultSelector=d;this.hasCompleted=this.hasSubscription=!1;this.index=0}h(a,b);a.prototype._next=function(a){this.hasSubscription||
this.tryNext(a)};a.prototype.tryNext=function(a){var c=this.index++,b=this.destination;try{var f=this.project(a,c);this.hasSubscription=!0;this.add(p(this,f,a,c))}catch(k){b.error(k)}};a.prototype._complete=function(){this.hasCompleted=!0;this.hasSubscription||this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,k){k=this.destination;this.resultSelector?this.trySelectResult(a,b,d,f):k.next(b)};a.prototype.trySelectResult=function(a,b,d,f){var c=this.resultSelector,e=this.destination;
try{var g=c(a,b,d,f);e.next(g)}catch(B){e.error(B)}};a.prototype.notifyError=function(a){this.destination.error(a)};a.prototype.notifyComplete=function(a){this.remove(a);this.hasSubscription=!1;this.hasCompleted&&this.destination.complete()};return a}(q);g.prototype.exhaustMap=function(b,a){return this.lift(new sd(b,a))};var ud=function(){function b(a,c,b){this.project=a;this.concurrent=c;this.scheduler=b}b.prototype.call=function(a,c){return c.subscribe(new td(a,this.project,this.concurrent,this.scheduler))};
return b}(),td=function(b){function a(a,e,d,f){b.call(this,a);this.project=e;this.concurrent=d;this.scheduler=f;this.active=this.index=0;this.hasCompleted=!1;d<Number.POSITIVE_INFINITY&&(this.buffer=[])}h(a,b);a.dispatch=function(a){a.subscriber.subscribeToProjection(a.result,a.value,a.index)};a.prototype._next=function(c){var b=this.destination;if(b.closed)this._complete();else{var d=this.index++;if(this.active<this.concurrent){b.next(c);var f=r(this.project)(c,d);f===m?b.error(m.e):this.scheduler?
this.add(this.scheduler.schedule(a.dispatch,0,{subscriber:this,result:f,value:c,index:d})):this.subscribeToProjection(f,c,d)}else this.buffer.push(c)}};a.prototype.subscribeToProjection=function(a,b,d){this.active++;this.add(p(this,a,b,d))};a.prototype._complete=function(){(this.hasCompleted=!0,0===this.active)&&this.destination.complete()};a.prototype.notifyNext=function(a,b,d,f,k){this._next(b)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;c&&0<c.length&&
this._next(c.shift());this.hasCompleted&&0===this.active&&this.destination.complete()};return a}(q);g.prototype.expand=function(b,a,c){void 0===a&&(a=Number.POSITIVE_INFINITY);void 0===c&&(c=void 0);a=1>(a||0)?Number.POSITIVE_INFINITY:a;return this.lift(new ud(b,a,c))};var T=function(b){function a(){var a=b.call(this,"argument out of range");this.name=a.name="ArgumentOutOfRangeError";this.stack=a.stack;this.message=a.message}h(a,b);return a}(Error),wd=function(){function b(a,c){this.index=a;this.defaultValue=
c;if(0>a)throw new T;}b.prototype.call=function(a,c){return c.subscribe(new vd(a,this.index,this.defaultValue))};return b}(),vd=function(b){function a(a,e,d){b.call(this,a);this.index=e;this.defaultValue=d}h(a,b);a.prototype._next=function(a){0===this.index--&&(this.destination.next(a),this.destination.complete())};a.prototype._complete=function(){var a=this.destination;0<=this.index&&("undefined"!==typeof this.defaultValue?a.next(this.defaultValue):a.error(new T));a.complete()};return a}(l);g.prototype.elementAt=
function(b,a){return this.lift(new wd(b,a))};var Ib=function(){function b(a,c){this.predicate=a;this.thisArg=c}b.prototype.call=function(a,c){return c.subscribe(new xd(a,this.predicate,this.thisArg))};return b}(),xd=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.thisArg=d;this.count=0;this.predicate=e}h(a,b);a.prototype._next=function(a){var c;try{c=this.predicate.call(this.thisArg,a,this.count++)}catch(d){this.destination.error(d);return}c&&this.destination.next(a)};return a}(l);
g.prototype.filter=da;var Jb=function(){function b(a){this.callback=a}b.prototype.call=function(a,c){return c.subscribe(new yd(a,this.callback))};return b}(),yd=function(b){function a(a,e){b.call(this,a);this.add(new u(e))}h(a,b);return a}(l);g.prototype.finally=Ha;g.prototype._finally=Ha;var $a=function(){function b(a,c,b,d){this.predicate=a;this.source=c;this.yieldIndex=b;this.thisArg=d}b.prototype.call=function(a,c){return c.subscribe(new zd(a,this.predicate,this.source,this.yieldIndex,this.thisArg))};
return b}(),zd=function(b){function a(a,e,d,f,k){b.call(this,a);this.predicate=e;this.source=d;this.yieldIndex=f;this.thisArg=k;this.index=0}h(a,b);a.prototype.notifyComplete=function(a){var c=this.destination;c.next(a);c.complete()};a.prototype._next=function(a){var c=this.predicate,b=this.thisArg,f=this.index++;try{c.call(b||this,a,f,this.source)&&this.notifyComplete(this.yieldIndex?f:a)}catch(k){this.destination.error(k)}};a.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:
void 0)};return a}(l);g.prototype.find=function(b,a){if("function"!==typeof b)throw new TypeError("predicate is not a function");return this.lift(new $a(b,this,!1,a))};g.prototype.findIndex=function(b,a){return this.lift(new $a(b,this,!0,a))};var aa=function(b){function a(){var a=b.call(this,"no elements in sequence");this.name=a.name="EmptyError";this.stack=a.stack;this.message=a.message}h(a,b);return a}(Error),Bd=function(){function b(a,c,b,d){this.predicate=a;this.resultSelector=c;this.defaultValue=
b;this.source=d}b.prototype.call=function(a,c){return c.subscribe(new Ad(a,this.predicate,this.resultSelector,this.defaultValue,this.source))};return b}(),Ad=function(b){function a(a,e,d,f,k){b.call(this,a);this.predicate=e;this.resultSelector=d;this.defaultValue=f;this.source=k;this.index=0;this._emitted=this.hasCompleted=!1}h(a,b);a.prototype._next=function(a){var c=this.index++;this.predicate?this._tryPredicate(a,c):this._emit(a,c)};a.prototype._tryPredicate=function(a,b){var c;try{c=this.predicate(a,
b,this.source)}catch(f){this.destination.error(f);return}c&&this._emit(a,b)};a.prototype._emit=function(a,b){this.resultSelector?this._tryResultSelector(a,b):this._emitFinal(a)};a.prototype._tryResultSelector=function(a,b){var c;try{c=this.resultSelector(a,b)}catch(f){this.destination.error(f);return}this._emitFinal(c)};a.prototype._emitFinal=function(a){var c=this.destination;this._emitted||(this._emitted=!0,c.next(a),c.complete(),this.hasCompleted=!0)};a.prototype._complete=function(){var a=this.destination;
this.hasCompleted||"undefined"===typeof this.defaultValue?this.hasCompleted||a.error(new aa):(a.next(this.defaultValue),a.complete())};return a}(l);g.prototype.first=function(b,a,c){return this.lift(new Bd(b,a,c,this))};var Cd=function(){function b(){this.size=0;this._values=[];this._keys=[]}b.prototype.get=function(a){a=this._keys.indexOf(a);return-1===a?void 0:this._values[a]};b.prototype.set=function(a,c){var b=this._keys.indexOf(a);-1===b?(this._keys.push(a),this._values.push(c),this.size++):
this._values[b]=c;return this};b.prototype.delete=function(a){a=this._keys.indexOf(a);if(-1===a)return!1;this._values.splice(a,1);this._keys.splice(a,1);this.size--;return!0};b.prototype.clear=function(){this._keys.length=0;this.size=this._values.length=0};b.prototype.forEach=function(a,c){for(var b=0;b<this.size;b++)a.call(c,this._values[b],this._keys[b])};return b}(),Dd=n.Map||Cd,Ed=function(){function b(){this.values={}}b.prototype.delete=function(a){this.values[a]=null;return!0};b.prototype.set=
function(a,c){this.values[a]=c;return this};b.prototype.get=function(a){return this.values[a]};b.prototype.forEach=function(a,c){var b=this.values,d;for(d in b)b.hasOwnProperty(d)&&null!==b[d]&&a.call(c,b[d],d)};b.prototype.clear=function(){this.values={}};return b}(),Gd=function(){function b(a,c,b,d){this.keySelector=a;this.elementSelector=c;this.durationSelector=b;this.subjectSelector=d}b.prototype.call=function(a,c){return c.subscribe(new Fd(a,this.keySelector,this.elementSelector,this.durationSelector,
this.subjectSelector))};return b}(),Fd=function(b){function a(a,e,d,f,k){b.call(this,a);this.keySelector=e;this.elementSelector=d;this.durationSelector=f;this.subjectSelector=k;this.groups=null;this.attemptedToUnsubscribe=!1;this.count=0}h(a,b);a.prototype._next=function(a){var c;try{c=this.keySelector(a)}catch(d){this.error(d);return}this._group(a,c)};a.prototype._group=function(a,b){var c=this.groups;c||(c=this.groups="string"===typeof b?new Ed:new Dd);var e=c.get(b),k;if(this.elementSelector)try{k=
this.elementSelector(a)}catch(y){this.error(y)}else k=a;if(!e&&(e=this.subjectSelector?this.subjectSelector():new v,c.set(b,e),a=new ab(b,e,this),this.destination.next(a),this.durationSelector)){a=void 0;try{a=this.durationSelector(new ab(b,e))}catch(y){this.error(y);return}this.add(a.subscribe(new Hd(b,e,this)))}e.closed||e.next(k)};a.prototype._error=function(a){var c=this.groups;c&&(c.forEach(function(c,b){c.error(a)}),c.clear());this.destination.error(a)};a.prototype._complete=function(){var a=
this.groups;a&&(a.forEach(function(a,c){a.complete()}),a.clear());this.destination.complete()};a.prototype.removeGroup=function(a){this.groups.delete(a)};a.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&b.prototype.unsubscribe.call(this))};return a}(l),Hd=function(b){function a(a,e,d){b.call(this);this.key=a;this.group=e;this.parent=d}h(a,b);a.prototype._next=function(a){this._complete()};a.prototype._error=function(a){var c=this.group;c.closed||c.error(a);
this.parent.removeGroup(this.key)};a.prototype._complete=function(){var a=this.group;a.closed||a.complete();this.parent.removeGroup(this.key)};return a}(l),ab=function(b){function a(a,e,d){b.call(this);this.key=a;this.groupSubject=e;this.refCountSubscription=d}h(a,b);a.prototype._subscribe=function(a){var c=new u,b=this.refCountSubscription,f=this.groupSubject;b&&!b.closed&&c.add(new Id(b));c.add(f.subscribe(a));return c};return a}(g),Id=function(b){function a(a){b.call(this);this.parent=a;a.count++}
h(a,b);a.prototype.unsubscribe=function(){var a=this.parent;a.closed||this.closed||(b.prototype.unsubscribe.call(this),--a.count,0===a.count&&a.attemptedToUnsubscribe&&a.unsubscribe())};return a}(u);g.prototype.groupBy=function(b,a,c,e){return this.lift(new Gd(b,a,c,e))};var Kd=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Jd(a))};return b}(),Jd=function(b){function a(){b.apply(this,arguments)}h(a,b);a.prototype._next=function(a){};return a}(l);g.prototype.ignoreElements=
function(){return this.lift(new Kd)};var Md=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Ld(a))};return b}(),Ld=function(b){function a(a){b.call(this,a)}h(a,b);a.prototype.notifyComplete=function(a){var c=this.destination;c.next(a);c.complete()};a.prototype._next=function(a){this.notifyComplete(!1)};a.prototype._complete=function(){this.notifyComplete(!0)};return a}(l);g.prototype.isEmpty=function(){return this.lift(new Md)};var Od=function(){function b(a){this.durationSelector=
a}b.prototype.call=function(a,c){return c.subscribe(new Nd(a,this.durationSelector))};return b}(),Nd=function(b){function a(a,e){b.call(this,a);this.durationSelector=e;this.hasValue=!1}h(a,b);a.prototype._next=function(a){this.value=a;this.hasValue=!0;this.throttled||(a=r(this.durationSelector)(a),a===m?this.destination.error(m.e):this.add(this.throttled=p(this,a)))};a.prototype.clearThrottle=function(){var a=this.value,b=this.hasValue,d=this.throttled;d&&(this.remove(d),this.throttled=null,d.unsubscribe());
b&&(this.value=null,this.hasValue=!1,this.destination.next(a))};a.prototype.notifyNext=function(a,b,d,f){this.clearThrottle()};a.prototype.notifyComplete=function(){this.clearThrottle()};return a}(q);g.prototype.audit=function(b){return this.lift(new Od(b))};var Qd=function(){function b(a,c){this.duration=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new Pd(a,this.duration,this.scheduler))};return b}(),Pd=function(b){function a(a,e,d){b.call(this,a);this.duration=e;this.scheduler=
d;this.hasValue=!1}h(a,b);a.prototype._next=function(a){this.value=a;this.hasValue=!0;this.throttled||this.add(this.throttled=this.scheduler.schedule(Kb,this.duration,this))};a.prototype.clearThrottle=function(){var a=this.value,b=this.hasValue,d=this.throttled;d&&(this.remove(d),this.throttled=null,d.unsubscribe());b&&(this.value=null,this.hasValue=!1,this.destination.next(a))};return a}(l);g.prototype.auditTime=function(b,a){void 0===a&&(a=x);return this.lift(new Qd(b,a))};var Sd=function(){function b(a,
c,b,d){this.predicate=a;this.resultSelector=c;this.defaultValue=b;this.source=d}b.prototype.call=function(a,c){return c.subscribe(new Rd(a,this.predicate,this.resultSelector,this.defaultValue,this.source))};return b}(),Rd=function(b){function a(a,e,d,f,k){b.call(this,a);this.predicate=e;this.resultSelector=d;this.defaultValue=f;this.source=k;this.hasValue=!1;this.index=0;"undefined"!==typeof f&&(this.lastValue=f,this.hasValue=!0)}h(a,b);a.prototype._next=function(a){var c=this.index++;this.predicate?
this._tryPredicate(a,c):this.resultSelector?this._tryResultSelector(a,c):(this.lastValue=a,this.hasValue=!0)};a.prototype._tryPredicate=function(a,b){var c;try{c=this.predicate(a,b,this.source)}catch(f){this.destination.error(f);return}c&&(this.resultSelector?this._tryResultSelector(a,b):(this.lastValue=a,this.hasValue=!0))};a.prototype._tryResultSelector=function(a,b){var c;try{c=this.resultSelector(a,b)}catch(f){this.destination.error(f);return}this.lastValue=c;this.hasValue=!0};a.prototype._complete=
function(){var a=this.destination;this.hasValue?(a.next(this.lastValue),a.complete()):a.error(new aa)};return a}(l);g.prototype.last=function(b,a,c){return this.lift(new Sd(b,a,c,this))};g.prototype.let=Ia;g.prototype.letBind=Ia;var Ud=function(){function b(a,c,b){this.predicate=a;this.thisArg=c;this.source=b}b.prototype.call=function(a,c){return c.subscribe(new Td(a,this.predicate,this.thisArg,this.source))};return b}(),Td=function(b){function a(a,e,d,f){b.call(this,a);this.predicate=e;this.thisArg=
d;this.source=f;this.index=0;this.thisArg=d||this}h(a,b);a.prototype.notifyComplete=function(a){this.destination.next(a);this.destination.complete()};a.prototype._next=function(a){var c=!1;try{c=this.predicate.call(this.thisArg,a,this.index++,this.source)}catch(d){this.destination.error(d);return}c||this.notifyComplete(!1)};a.prototype._complete=function(){this.notifyComplete(!0)};return a}(l);g.prototype.every=function(b,a){return this.lift(new Ud(b,a,this))};g.prototype.map=wa;var Wd=function(){function b(a){this.value=
a}b.prototype.call=function(a,c){return c.subscribe(new Vd(a,this.value))};return b}(),Vd=function(b){function a(a,e){b.call(this,a);this.value=e}h(a,b);a.prototype._next=function(a){this.destination.next(this.value)};return a}(l);g.prototype.mapTo=function(b){return this.lift(new Wd(b))};var Yd=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new Xd(a))};return b}(),Xd=function(b){function a(a){b.call(this,a)}h(a,b);a.prototype._next=function(a){this.destination.next(w.createNext(a))};
a.prototype._error=function(a){var c=this.destination;c.next(w.createError(a));c.complete()};a.prototype._complete=function(){var a=this.destination;a.next(w.createComplete());a.complete()};return a}(l);g.prototype.materialize=function(){return this.lift(new Yd)};var ja=function(){function b(a,c,b){void 0===b&&(b=!1);this.accumulator=a;this.seed=c;this.hasSeed=b}b.prototype.call=function(a,c){return c.subscribe(new Zd(a,this.accumulator,this.seed,this.hasSeed))};return b}(),Zd=function(b){function a(a,
e,d,f){b.call(this,a);this.accumulator=e;this.hasSeed=f;this.index=0;this.hasValue=!1;this.acc=d;this.hasSeed||this.index++}h(a,b);a.prototype._next=function(a){this.hasValue||(this.hasValue=this.hasSeed)?this._tryReduce(a):(this.acc=a,this.hasValue=!0)};a.prototype._tryReduce=function(a){var c;try{c=this.accumulator(this.acc,a,this.index++)}catch(d){this.destination.error(d);return}this.acc=c};a.prototype._complete=function(){(this.hasValue||this.hasSeed)&&this.destination.next(this.acc);this.destination.complete()};
return a}(l);g.prototype.max=function(b){return this.lift(new ja("function"===typeof b?function(a,c){return 0<b(a,c)?a:c}:function(a,c){return a>c?a:c}))};g.prototype.merge=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return this.lift.call(sa.apply(void 0,[this].concat(b)))};g.prototype.mergeAll=function(b){void 0===b&&(b=Number.POSITIVE_INFINITY);return this.lift(new W(b))};g.prototype.mergeMap=Ba;g.prototype.flatMap=Ba;g.prototype.flatMapTo=Da;g.prototype.mergeMapTo=Da;
var ae=function(){function b(a,c,b){this.accumulator=a;this.seed=c;this.concurrent=b}b.prototype.call=function(a,c){return c.subscribe(new $d(a,this.accumulator,this.seed,this.concurrent))};return b}(),$d=function(b){function a(a,e,d,f){b.call(this,a);this.accumulator=e;this.acc=d;this.concurrent=f;this.hasCompleted=this.hasValue=!1;this.buffer=[];this.index=this.active=0}h(a,b);a.prototype._next=function(a){if(this.active<this.concurrent){var c=this.index++,b=r(this.accumulator)(this.acc,a),f=this.destination;
b===m?f.error(m.e):(this.active++,this._innerSub(b,a,c))}else this.buffer.push(a)};a.prototype._innerSub=function(a,b,d){this.add(p(this,a,b,d))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())};a.prototype.notifyNext=function(a,b,d,f,k){a=this.destination;this.acc=b;this.hasValue=!0;a.next(b)};a.prototype.notifyComplete=function(a){var c=this.buffer;this.remove(a);this.active--;
0<c.length?this._next(c.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())};return a}(q);g.prototype.mergeScan=function(b,a,c){void 0===c&&(c=Number.POSITIVE_INFINITY);return this.lift(new ae(b,a,c))};g.prototype.min=function(b){return this.lift(new ja("function"===typeof b?function(a,c){return 0>b(a,c)?a:c}:function(a,c){return a<c?a:c}))};var U=function(b){function a(a,e){b.call(this);this.source=a;this.subjectFactory=e;
this._refCount=0}h(a,b);a.prototype._subscribe=function(a){return this.getSubject().subscribe(a)};a.prototype.getSubject=function(){var a=this._subject;if(!a||a.isStopped)this._subject=this.subjectFactory();return this._subject};a.prototype.connect=function(){var a=this._connection;a||(a=this._connection=new u,a.add(this.source.subscribe(new be(this.getSubject(),this))),a.closed?(this._connection=null,a=u.EMPTY):this._connection=a);return a};a.prototype.refCount=function(){return this.lift(new ce(this))};
return a}(g),Mb={operator:{value:null},_refCount:{value:0,writable:!0},_subscribe:{value:U.prototype._subscribe},getSubject:{value:U.prototype.getSubject},connect:{value:U.prototype.connect},refCount:{value:U.prototype.refCount}},be=function(b){function a(a,e){b.call(this,a);this.connectable=e}h(a,b);a.prototype._error=function(a){this._unsubscribe();b.prototype._error.call(this,a)};a.prototype._complete=function(){this._unsubscribe();b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){var a=
this.connectable;if(a){this.connectable=null;var b=a._connection;a._refCount=0;a._subject=null;a._connection=null;b&&b.unsubscribe()}};return a}(Oa),ce=function(){function b(a){this.connectable=a}b.prototype.call=function(a,c){var b=this.connectable;b._refCount++;a=new de(a,b);c=c.subscribe(a);a.closed||(a.connection=b.connect());return c};return b}(),de=function(b){function a(a,e){b.call(this,a);this.connectable=e}h(a,b);a.prototype._unsubscribe=function(){var a=this.connectable;if(a){this.connectable=
null;var b=a._refCount;0>=b?this.connection=null:(a._refCount=b-1,1<b?this.connection=null:(b=this.connection,a=a._connection,this.connection=null,!a||b&&a!==b||a.unsubscribe()))}else this.connection=null};return a}(l),Lb=function(){function b(a,c){this.subjectFactory=a;this.selector=c}b.prototype.call=function(a,c){var b=this.selector,d=this.subjectFactory();a=b(d).subscribe(a);a.add(c.subscribe(d));return a};return b}();g.prototype.multicast=J;g.prototype.observeOn=function(b,a){void 0===a&&(a=
0);return this.lift(new gc(b,a))};g.prototype.onErrorResumeNext=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];1===b.length&&D(b[0])&&(b=b[0]);return this.lift(new Va(b))};var fe=function(){function b(){}b.prototype.call=function(a,c){return c.subscribe(new ee(a))};return b}(),ee=function(b){function a(a){b.call(this,a);this.hasPrev=!1}h(a,b);a.prototype._next=function(a){this.hasPrev?this.destination.next([this.prev,a]):this.hasPrev=!0;this.prev=a};return a}(l);g.prototype.pairwise=
function(){return this.lift(new fe)};g.prototype.partition=function(b,a){return[da.call(this,b,a),da.call(this,Nb(b,a))]};g.prototype.pluck=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];a=b.length;if(0===a)throw Error("list of properties cannot be empty.");return wa.call(this,Ob(b,a))};g.prototype.publish=function(b){return b?J.call(this,function(){return new v},b):J.call(this,new v)};var bb=function(b){function a(a){b.call(this);this._value=a}h(a,b);Object.defineProperty(a.prototype,
"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0});a.prototype._subscribe=function(a){var c=b.prototype._subscribe.call(this,a);c&&!c.closed&&a.next(this._value);return c};a.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new G;return this._value};a.prototype.next=function(a){b.prototype.next.call(this,this._value=a)};return a}(v);g.prototype.publishBehavior=function(b){return J.call(this,new bb(b))};g.prototype.publishReplay=
function(b,a,c){void 0===b&&(b=Number.POSITIVE_INFINITY);void 0===a&&(a=Number.POSITIVE_INFINITY);return J.call(this,new L(b,a,c))};g.prototype.publishLast=function(){return J.call(this,new K)};g.prototype.race=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];1===b.length&&D(b[0])&&(b=b[0]);return this.lift.call(ta.apply(void 0,[this].concat(b)))};g.prototype.reduce=function(b,a){var c=!1;2<=arguments.length&&(c=!0);return this.lift(new ja(b,a,c))};var cb=function(){function b(a,
c){this.count=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new ge(a,this.count,this.source))};return b}(),ge=function(b){function a(a,e,d){b.call(this,a);this.count=e;this.source=d}h(a,b);a.prototype.complete=function(){if(!this.isStopped){var a=this.source,e=this.count;if(0===e)return b.prototype.complete.call(this);-1<e&&(this.count=e-1);a.subscribe(this._unsubscribeAndRecycle())}};return a}(l);g.prototype.repeat=function(b){void 0===b&&(b=-1);return 0===b?new F:0>b?this.lift(new cb(-1,
this)):this.lift(new cb(b-1,this))};var ie=function(){function b(a){this.notifier=a}b.prototype.call=function(a,c){return c.subscribe(new he(a,this.notifier,c))};return b}(),he=function(b){function a(a,e,d){b.call(this,a);this.notifier=e;this.source=d;this.sourceIsBeingSubscribedTo=!0}h(a,b);a.prototype.notifyNext=function(a,b,d,f,k){this.sourceIsBeingSubscribedTo=!0;this.source.subscribe(this)};a.prototype.notifyComplete=function(a){if(!1===this.sourceIsBeingSubscribedTo)return b.prototype.complete.call(this)};
a.prototype.complete=function(){this.sourceIsBeingSubscribedTo=!1;if(!this.isStopped){if(!this.retries)this.subscribeToRetries();else if(this.retriesSubscription.closed)return b.prototype.complete.call(this);this._unsubscribeAndRecycle();this.notifications.next()}};a.prototype._unsubscribe=function(){var a=this.notifications,b=this.retriesSubscription;a&&(a.unsubscribe(),this.notifications=null);b&&(b.unsubscribe(),this.retriesSubscription=null);this.retries=null};a.prototype._unsubscribeAndRecycle=
function(){var a=this.notifications,e=this.retries,d=this.retriesSubscription;this.retriesSubscription=this.retries=this.notifications=null;b.prototype._unsubscribeAndRecycle.call(this);this.notifications=a;this.retries=e;this.retriesSubscription=d;return this};a.prototype.subscribeToRetries=function(){this.notifications=new v;var a=r(this.notifier)(this.notifications);if(a===m)return b.prototype.complete.call(this);this.retries=a;this.retriesSubscription=p(this,a)};return a}(q);g.prototype.repeatWhen=
function(b){return this.lift(new ie(b))};var ke=function(){function b(a,c){this.count=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new je(a,this.count,this.source))};return b}(),je=function(b){function a(a,e,d){b.call(this,a);this.count=e;this.source=d}h(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=this.source,d=this.count;if(0===d)return b.prototype.error.call(this,a);-1<d&&(this.count=d-1);c.subscribe(this._unsubscribeAndRecycle())}};return a}(l);g.prototype.retry=
function(b){void 0===b&&(b=-1);return this.lift(new ke(b,this))};var me=function(){function b(a,c){this.notifier=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new le(a,this.notifier,this.source))};return b}(),le=function(b){function a(a,e,d){b.call(this,a);this.notifier=e;this.source=d}h(a,b);a.prototype.error=function(a){if(!this.isStopped){var c=this.errors,d=this.retries,f=this.retriesSubscription;if(d)this.retriesSubscription=this.errors=null;else{c=new v;d=r(this.notifier)(c);
if(d===m)return b.prototype.error.call(this,m.e);f=p(this,d)}this._unsubscribeAndRecycle();this.errors=c;this.retries=d;this.retriesSubscription=f;c.next(a)}};a.prototype._unsubscribe=function(){var a=this.errors,b=this.retriesSubscription;a&&(a.unsubscribe(),this.errors=null);b&&(b.unsubscribe(),this.retriesSubscription=null);this.retries=null};a.prototype.notifyNext=function(a,b,d,f,k){a=this.errors;b=this.retries;d=this.retriesSubscription;this.retriesSubscription=this.retries=this.errors=null;
this._unsubscribeAndRecycle();this.errors=a;this.retries=b;this.retriesSubscription=d;this.source.subscribe(this)};return a}(q);g.prototype.retryWhen=function(b){return this.lift(new me(b,this))};var oe=function(){function b(a){this.notifier=a}b.prototype.call=function(a,c){a=new ne(a);c=c.subscribe(a);c.add(p(a,this.notifier));return c};return b}(),ne=function(b){function a(){b.apply(this,arguments);this.hasValue=!1}h(a,b);a.prototype._next=function(a){this.value=a;this.hasValue=!0};a.prototype.notifyNext=
function(a,b,d,f,k){this.emitValue()};a.prototype.notifyComplete=function(){this.emitValue()};a.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))};return a}(q);g.prototype.sample=function(b){return this.lift(new oe(b))};var qe=function(){function b(a,c){this.period=a;this.scheduler=c}b.prototype.call=function(a,c){return c.subscribe(new pe(a,this.period,this.scheduler))};return b}(),pe=function(b){function a(a,e,d){b.call(this,a);this.period=e;this.scheduler=
d;this.hasValue=!1;this.add(d.schedule(Pb,e,{subscriber:this,period:e}))}h(a,b);a.prototype._next=function(a){this.lastValue=a;this.hasValue=!0};a.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))};return a}(l);g.prototype.sampleTime=function(b,a){void 0===a&&(a=x);return this.lift(new qe(b,a))};var se=function(){function b(a,c,b){void 0===b&&(b=!1);this.accumulator=a;this.seed=c;this.hasSeed=b}b.prototype.call=function(a,c){return c.subscribe(new re(a,
this.accumulator,this.seed,this.hasSeed))};return b}(),re=function(b){function a(a,e,d,f){b.call(this,a);this.accumulator=e;this._seed=d;this.hasSeed=f;this.index=0}h(a,b);Object.defineProperty(a.prototype,"seed",{get:function(){return this._seed},set:function(a){this.hasSeed=!0;this._seed=a},enumerable:!0,configurable:!0});a.prototype._next=function(a){if(this.hasSeed)return this._tryNext(a);this.seed=a;this.destination.next(a)};a.prototype._tryNext=function(a){var c=this.index++,b;try{b=this.accumulator(this.seed,
a,c)}catch(f){this.destination.error(f)}this.seed=b;this.destination.next(b)};return a}(l);g.prototype.scan=function(b,a){var c=!1;2<=arguments.length&&(c=!0);return this.lift(new se(b,a,c))};var ue=function(){function b(a,c){this.compareTo=a;this.comparor=c}b.prototype.call=function(a,c){return c.subscribe(new te(a,this.compareTo,this.comparor))};return b}(),te=function(b){function a(a,e,d){b.call(this,a);this.compareTo=e;this.comparor=d;this._a=[];this._b=[];this._oneComplete=!1;this.add(e.subscribe(new ve(a,
this)))}h(a,b);a.prototype._next=function(a){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(a),this.checkValues())};a.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0};a.prototype.checkValues=function(){for(var a=this._a,b=this._b,d=this.comparor;0<a.length&&0<b.length;){var f=a.shift(),k=b.shift();d?(f=r(d)(f,k),f===m&&this.destination.error(m.e)):f=f===k;f||this.emit(!1)}};a.prototype.emit=function(a){var c=
this.destination;c.next(a);c.complete()};a.prototype.nextB=function(a){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(a),this.checkValues())};return a}(l),ve=function(b){function a(a,e){b.call(this,a);this.parent=e}h(a,b);a.prototype._next=function(a){this.parent.nextB(a)};a.prototype._error=function(a){this.parent.error(a)};a.prototype._complete=function(){this.parent._complete()};return a}(l);g.prototype.sequenceEqual=function(b,a){return this.lift(new ue(b,a))};g.prototype.share=
function(){return J.call(this,Qb).refCount()};var xe=function(){function b(a,c){this.predicate=a;this.source=c}b.prototype.call=function(a,c){return c.subscribe(new we(a,this.predicate,this.source))};return b}(),we=function(b){function a(a,e,d){b.call(this,a);this.predicate=e;this.source=d;this.seenValue=!1;this.index=0}h(a,b);a.prototype.applySingleValue=function(a){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=a)};a.prototype._next=
function(a){var c=this.index++;this.predicate?this.tryNext(a,c):this.applySingleValue(a)};a.prototype.tryNext=function(a,b){try{this.predicate(a,b,this.source)&&this.applySingleValue(a)}catch(d){this.destination.error(d)}};a.prototype._complete=function(){var a=this.destination;0<this.index?(a.next(this.seenValue?this.singleValue:void 0),a.complete()):a.error(new aa)};return a}(l);g.prototype.single=function(b){return this.lift(new xe(b,this))};var ze=function(){function b(a){this.total=a}b.prototype.call=
function(a,c){return c.subscribe(new ye(a,this.total))};return b}(),ye=function(b){function a(a,e){b.call(this,a);this.total=e;this.count=0}h(a,b);a.prototype._next=function(a){++this.count>this.total&&this.destination.next(a)};return a}(l);g.prototype.skip=function(b){return this.lift(new ze(b))};var Be=function(){function b(a){this.notifier=a}b.prototype.call=function(a,c){return c.subscribe(new Ae(a,this.notifier))};return b}(),Ae=function(b){function a(a,e){b.call(this,a);this.isInnerStopped=
this.hasValue=!1;this.add(p(this,e))}h(a,b);a.prototype._next=function(a){this.hasValue&&b.prototype._next.call(this,a)};a.prototype._complete=function(){this.isInnerStopped?b.prototype._complete.call(this):this.unsubscribe()};a.prototype.notifyNext=function(a,b,d,f,k){this.hasValue=!0};a.prototype.notifyComplete=function(){this.isInnerStopped=!0;this.isStopped&&b.prototype._complete.call(this)};return a}(q);g.prototype.skipUntil=function(b){return this.lift(new Be(b))};var De=function(){function b(a){this.predicate=
a}b.prototype.call=function(a,c){return c.subscribe(new Ce(a,this.predicate))};return b}(),Ce=function(b){function a(a,e){b.call(this,a);this.predicate=e;this.skipping=!0;this.index=0}h(a,b);a.prototype._next=function(a){var c=this.destination;this.skipping&&this.tryCallPredicate(a);this.skipping||c.next(a)};a.prototype.tryCallPredicate=function(a){try{this.skipping=!!this.predicate(a,this.index++)}catch(e){this.destination.error(e)}};return a}(l);g.prototype.skipWhile=function(b){return this.lift(new De(b))};
g.prototype.startWith=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];a=b[b.length-1];z(a)?b.pop():a=null;var c=b.length;return 1===c?O(new ga(b[0],a),this):1<c?O(new E(b,a),this):O(new F(a),this)};var db=new (function(){function b(a){this.root=a;a.setImmediate&&"function"===typeof a.setImmediate?(this.setImmediate=a.setImmediate.bind(a),this.clearImmediate=a.clearImmediate.bind(a)):(this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.canUseProcessNextTick()?
this.setImmediate=this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.setImmediate=this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.setImmediate=this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.setImmediate=this.createReadyStateChangeSetImmediate():this.setImmediate=this.createSetTimeoutSetImmediate(),a=function e(a){delete e.instance.tasksByHandle[a]},a.instance=this,this.clearImmediate=a)}b.prototype.identify=function(a){return this.root.Object.prototype.toString.call(a)};
b.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)};b.prototype.canUseMessageChannel=function(){return!!this.root.MessageChannel};b.prototype.canUseReadyStateChange=function(){var a=this.root.document;return!!(a&&"onreadystatechange"in a.createElement("script"))};b.prototype.canUsePostMessage=function(){var a=this.root;if(a.postMessage&&!a.importScripts){var c=!0,b=a.onmessage;a.onmessage=function(){c=!1};a.postMessage("","*");a.onmessage=b;return c}return!1};
b.prototype.partiallyApplied=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];b=function f(){var a=f.handler,b=f.args;"function"===typeof a?a.apply(void 0,b):(new Function(""+a))()};b.handler=a;b.args=c;return b};b.prototype.addFromSetImmediateArguments=function(a){this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,a);return this.nextHandle++};b.prototype.createProcessNextTickSetImmediate=function(){var a=function e(){var a=e.instance,b=a.addFromSetImmediateArguments(arguments);
a.root.process.nextTick(a.partiallyApplied(a.runIfPresent,b));return b};a.instance=this;return a};b.prototype.createPostMessageSetImmediate=function(){var a=this.root,b="setImmediate$"+a.Math.random()+"$",e=function f(c){var e=f.instance;c.source===a&&"string"===typeof c.data&&0===c.data.indexOf(b)&&e.runIfPresent(+c.data.slice(b.length))};e.instance=this;a.addEventListener("message",e,!1);e=function k(){var a=k,b=a.messagePrefix,a=a.instance,c=a.addFromSetImmediateArguments(arguments);a.root.postMessage(b+
c,"*");return c};e.instance=this;e.messagePrefix=b;return e};b.prototype.runIfPresent=function(a){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,a),0);else{var b=this.tasksByHandle[a];if(b){this.currentlyRunningATask=!0;try{b()}finally{this.clearImmediate(a),this.currentlyRunningATask=!1}}}};b.prototype.createMessageChannelSetImmediate=function(){var a=this,b=new this.root.MessageChannel;b.port1.onmessage=function(b){a.runIfPresent(b.data)};var e=function f(){var a=
f,b=a.channel,a=a.instance.addFromSetImmediateArguments(arguments);b.port2.postMessage(a);return a};e.channel=b;e.instance=this;return e};b.prototype.createReadyStateChangeSetImmediate=function(){var a=function e(){var a=e.instance,b=a.root.document,k=b.documentElement,g=a.addFromSetImmediateArguments(arguments),h=b.createElement("script");h.onreadystatechange=function(){a.runIfPresent(g);h.onreadystatechange=null;k.removeChild(h);h=null};k.appendChild(h);return g};a.instance=this;return a};b.prototype.createSetTimeoutSetImmediate=
function(){var a=function e(){var a=e.instance,b=a.addFromSetImmediateArguments(arguments);a.root.setTimeout(a.partiallyApplied(a.runIfPresent,b),0);return b};a.instance=this;return a};return b}())(n),Ee=function(b){function a(a,e){b.call(this,a,e);this.scheduler=a;this.work=e}h(a,b);a.prototype.requestAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d)return b.prototype.requestAsyncId.call(this,a,e,d);a.actions.push(this);return a.scheduled||(a.scheduled=db.setImmediate(a.flush.bind(a,null)))};
a.prototype.recycleAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d||null===d&&0<this.delay)return b.prototype.recycleAsyncId.call(this,a,e,d);0===a.actions.length&&(db.clearImmediate(e),a.scheduled=void 0)};return a}(R),ba=new (function(b){function a(){b.apply(this,arguments)}h(a,b);a.prototype.flush=function(a){this.active=!0;this.scheduled=void 0;var b=this.actions,c,f=-1,k=b.length;a=a||b.shift();do if(c=a.execute(a.state,a.delay))break;while(++f<k&&(a=b.shift()));this.active=!1;if(c){for(;++f<
k&&(a=b.shift());)a.unsubscribe();throw c;}};return a}(S))(Ee),Fe=function(b){function a(a,e,d){void 0===e&&(e=0);void 0===d&&(d=ba);b.call(this);this.source=a;this.delayTime=e;this.scheduler=d;if(!P(e)||0>e)this.delayTime=0;d&&"function"===typeof d.schedule||(this.scheduler=ba)}h(a,b);a.create=function(b,e,d){void 0===e&&(e=0);void 0===d&&(d=ba);return new a(b,e,d)};a.dispatch=function(a){return this.add(a.source.subscribe(a.subscriber))};a.prototype._subscribe=function(b){return this.scheduler.schedule(a.dispatch,
this.delayTime,{source:this.source,subscriber:b})};return a}(g),Ge=function(){function b(a,b){this.scheduler=a;this.delay=b}b.prototype.call=function(a,b){return(new Fe(b,this.delay,this.scheduler)).subscribe(a)};return b}();g.prototype.subscribeOn=function(b,a){void 0===a&&(a=0);return this.lift(new Ge(b,a))};var Rb=function(){function b(){}b.prototype.call=function(a,b){return b.subscribe(new He(a))};return b}(),He=function(b){function a(a){b.call(this,a);this.active=0;this.hasCompleted=!1}h(a,
b);a.prototype._next=function(a){this.unsubscribeInner();this.active++;this.add(this.innerSubscription=p(this,a))};a.prototype._complete=function(){this.hasCompleted=!0;0===this.active&&this.destination.complete()};a.prototype.unsubscribeInner=function(){this.active=0<this.active?this.active-1:0;var a=this.innerSubscription;a&&(a.unsubscribe(),this.remove(a))};a.prototype.notifyNext=function(a,b,d,f,k){this.destination.next(b)};a.prototype.notifyError=function(a){this.destination.error(a)};a.prototype.notifyComplete=
function(){this.unsubscribeInner();this.hasCompleted&&0===this.active&&this.destination.complete()};return a}(q);g.prototype.switch=Ja;g.prototype._switch=Ja;var Je=function(){function b(a,b){this.project=a;this.resultSelector=b}b.prototype.call=function(a,b){return b.subscribe(new Ie(a,this.project,this.resultSelector))};return b}(),Ie=function(b){function a(a,e,d){b.call(this,a);this.project=e;this.resultSelector=d;this.index=0}h(a,b);a.prototype._next=function(a){var b,c=this.index++;try{b=this.project(a,
c)}catch(f){this.destination.error(f);return}this._innerSub(b,a,c)};a.prototype._innerSub=function(a,b,d){var c=this.innerSubscription;c&&c.unsubscribe();this.add(this.innerSubscription=p(this,a,b,d))};a.prototype._complete=function(){var a=this.innerSubscription;a&&!a.closed||b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.innerSubscription=null};a.prototype.notifyComplete=function(a){this.remove(a);this.innerSubscription=null;this.isStopped&&b.prototype._complete.call(this)};
a.prototype.notifyNext=function(a,b,d,f,k){this.resultSelector?this._tryNotifyNext(a,b,d,f):this.destination.next(b)};a.prototype._tryNotifyNext=function(a,b,d,f){var c;try{c=this.resultSelector(a,b,d,f)}catch(y){this.destination.error(y);return}this.destination.next(c)};return a}(q);g.prototype.switchMap=function(b,a){return this.lift(new Je(b,a))};var Le=function(){function b(a,b){this.observable=a;this.resultSelector=b}b.prototype.call=function(a,b){return b.subscribe(new Ke(a,this.observable,
this.resultSelector))};return b}(),Ke=function(b){function a(a,e,d){b.call(this,a);this.inner=e;this.resultSelector=d;this.index=0}h(a,b);a.prototype._next=function(a){var b=this.innerSubscription;b&&b.unsubscribe();this.add(this.innerSubscription=p(this,this.inner,a,this.index++))};a.prototype._complete=function(){var a=this.innerSubscription;a&&!a.closed||b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){this.innerSubscription=null};a.prototype.notifyComplete=function(a){this.remove(a);
this.innerSubscription=null;this.isStopped&&b.prototype._complete.call(this)};a.prototype.notifyNext=function(a,b,d,f,k){k=this.destination;this.resultSelector?this.tryResultSelector(a,b,d,f):k.next(b)};a.prototype.tryResultSelector=function(a,b,d,f){var c=this.resultSelector,e=this.destination,g;try{g=c(a,b,d,f)}catch(B){e.error(B);return}e.next(g)};return a}(q);g.prototype.switchMapTo=function(b,a){return this.lift(new Le(b,a))};var Ne=function(){function b(a){this.total=a;if(0>this.total)throw new T;
}b.prototype.call=function(a,b){return b.subscribe(new Me(a,this.total))};return b}(),Me=function(b){function a(a,e){b.call(this,a);this.total=e;this.count=0}h(a,b);a.prototype._next=function(a){var b=this.total,c=++this.count;c<=b&&(this.destination.next(a),c===b&&(this.destination.complete(),this.unsubscribe()))};return a}(l);g.prototype.take=function(b){return 0===b?new F:this.lift(new Ne(b))};var Pe=function(){function b(a){this.total=a;if(0>this.total)throw new T;}b.prototype.call=function(a,
b){return b.subscribe(new Oe(a,this.total))};return b}(),Oe=function(b){function a(a,e){b.call(this,a);this.total=e;this.ring=[];this.count=0}h(a,b);a.prototype._next=function(a){var b=this.ring,c=this.total,f=this.count++;b.length<c?b.push(a):b[f%c]=a};a.prototype._complete=function(){var a=this.destination,b=this.count;if(0<b)for(var d=this.count>=this.total?this.total:this.count,f=this.ring,k=0;k<d;k++){var g=b++%d;a.next(f[g])}a.complete()};return a}(l);g.prototype.takeLast=function(b){return 0===
b?new F:this.lift(new Pe(b))};var Re=function(){function b(a){this.notifier=a}b.prototype.call=function(a,b){return b.subscribe(new Qe(a,this.notifier))};return b}(),Qe=function(b){function a(a,e){b.call(this,a);this.notifier=e;this.add(p(this,e))}h(a,b);a.prototype.notifyNext=function(a,b,d,f,g){this.complete()};a.prototype.notifyComplete=function(){};return a}(q);g.prototype.takeUntil=function(b){return this.lift(new Re(b))};var Te=function(){function b(a){this.predicate=a}b.prototype.call=function(a,
b){return b.subscribe(new Se(a,this.predicate))};return b}(),Se=function(b){function a(a,e){b.call(this,a);this.predicate=e;this.index=0}h(a,b);a.prototype._next=function(a){var b=this.destination,c;try{c=this.predicate(a,this.index++)}catch(f){b.error(f);return}this.nextOrComplete(a,c)};a.prototype.nextOrComplete=function(a,b){var c=this.destination;b?c.next(a):c.complete()};return a}(l);g.prototype.takeWhile=function(b){return this.lift(new Te(b))};var Ve=function(){function b(a){this.durationSelector=
a}b.prototype.call=function(a,b){return b.subscribe(new Ue(a,this.durationSelector))};return b}(),Ue=function(b){function a(a,e){b.call(this,a);this.destination=a;this.durationSelector=e}h(a,b);a.prototype._next=function(a){this.throttled||this.tryDurationSelector(a)};a.prototype.tryDurationSelector=function(a){var b=null;try{b=this.durationSelector(a)}catch(d){this.destination.error(d);return}this.emitAndThrottle(a,b)};a.prototype.emitAndThrottle=function(a,b){this.add(this.throttled=p(this,b));
this.destination.next(a)};a.prototype._unsubscribe=function(){var a=this.throttled;a&&(this.remove(a),this.throttled=null,a.unsubscribe())};a.prototype.notifyNext=function(a,b,d,f,g){this._unsubscribe()};a.prototype.notifyComplete=function(){this._unsubscribe()};return a}(q);g.prototype.throttle=function(b){return this.lift(new Ve(b))};var Xe=function(){function b(a,b){this.duration=a;this.scheduler=b}b.prototype.call=function(a,b){return b.subscribe(new We(a,this.duration,this.scheduler))};return b}(),
We=function(b){function a(a,e,d){b.call(this,a);this.duration=e;this.scheduler=d}h(a,b);a.prototype._next=function(a){this.throttled||(this.add(this.throttled=this.scheduler.schedule(Sb,this.duration,{subscriber:this})),this.destination.next(a))};a.prototype.clearThrottle=function(){var a=this.throttled;a&&(a.unsubscribe(),this.remove(a),this.throttled=null)};return a}(l);g.prototype.throttleTime=function(b,a){void 0===a&&(a=x);return this.lift(new Xe(b,a))};var eb=function(){return function(b,a){this.value=
b;this.interval=a}}(),Ze=function(){function b(a){this.scheduler=a}b.prototype.call=function(a,b){return b.subscribe(new Ye(a,this.scheduler))};return b}(),Ye=function(b){function a(a,e){b.call(this,a);this.scheduler=e;this.lastTime=0;this.lastTime=e.now()}h(a,b);a.prototype._next=function(a){var b=this.scheduler.now(),c=b-this.lastTime;this.lastTime=b;this.destination.next(new eb(a,c))};return a}(l);g.prototype.timeInterval=function(b){void 0===b&&(b=x);return this.lift(new Ze(b))};var fb=function(b){function a(){var a=
b.call(this,"Timeout has occurred");this.name=a.name="TimeoutError";this.stack=a.stack;this.message=a.message}h(a,b);return a}(Error),af=function(){function b(a,b,e,d){this.waitFor=a;this.absoluteTimeout=b;this.scheduler=e;this.errorInstance=d}b.prototype.call=function(a,b){return b.subscribe(new $e(a,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))};return b}(),$e=function(b){function a(a,e,d,f,g){b.call(this,a);this.absoluteTimeout=e;this.waitFor=d;this.scheduler=f;this.errorInstance=
g;this._previousIndex=this.index=0;this._hasCompleted=!1;this.scheduleTimeout()}h(a,b);Object.defineProperty(a.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0});a.dispatchTimeout=function(a){var b=a.subscriber;a=a.index;b.hasCompleted||b.previousIndex!==a||b.notifyTimeout()};a.prototype.scheduleTimeout=function(){var b=this.index;
this.scheduler.schedule(a.dispatchTimeout,this.waitFor,{subscriber:this,index:b});this.index++;this._previousIndex=b};a.prototype._next=function(a){this.destination.next(a);this.absoluteTimeout||this.scheduleTimeout()};a.prototype._error=function(a){this.destination.error(a);this._hasCompleted=!0};a.prototype._complete=function(){this.destination.complete();this._hasCompleted=!0};a.prototype.notifyTimeout=function(){this.error(this.errorInstance)};return a}(l);g.prototype.timeout=function(b,a){void 0===
a&&(a=x);var c=X(b);b=c?+b-a.now():Math.abs(b);return this.lift(new af(b,c,a,new fb))};var cf=function(){function b(a,b,e,d){this.waitFor=a;this.absoluteTimeout=b;this.withObservable=e;this.scheduler=d}b.prototype.call=function(a,b){return b.subscribe(new bf(a,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))};return b}(),bf=function(b){function a(a,e,d,f,g){b.call(this);this.destination=a;this.absoluteTimeout=e;this.waitFor=d;this.withObservable=f;this.scheduler=g;this.timeoutSubscription=
void 0;this._previousIndex=this.index=0;this._hasCompleted=!1;a.add(this);this.scheduleTimeout()}h(a,b);Object.defineProperty(a.prototype,"previousIndex",{get:function(){return this._previousIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasCompleted",{get:function(){return this._hasCompleted},enumerable:!0,configurable:!0});a.dispatchTimeout=function(a){var b=a.subscriber;a=a.index;b.hasCompleted||b.previousIndex!==a||b.handleTimeout()};a.prototype.scheduleTimeout=function(){var b=
this.index;this.scheduler.schedule(a.dispatchTimeout,this.waitFor,{subscriber:this,index:b});this.index++;this._previousIndex=b};a.prototype._next=function(a){this.destination.next(a);this.absoluteTimeout||this.scheduleTimeout()};a.prototype._error=function(a){this.destination.error(a);this._hasCompleted=!0};a.prototype._complete=function(){this.destination.complete();this._hasCompleted=!0};a.prototype.handleTimeout=function(){if(!this.closed){var a=this.withObservable;this.unsubscribe();this.destination.add(this.timeoutSubscription=
p(this,a))}};return a}(q);g.prototype.timeoutWith=function(b,a,c){void 0===c&&(c=x);var e=X(b);b=e?+b-c.now():Math.abs(b);return this.lift(new cf(b,e,a,c))};var gb=function(){return function(b,a){this.value=b;this.timestamp=a}}(),ef=function(){function b(a){this.scheduler=a}b.prototype.call=function(a,b){return b.subscribe(new df(a,this.scheduler))};return b}(),df=function(b){function a(a,e){b.call(this,a);this.scheduler=e}h(a,b);a.prototype._next=function(a){var b=this.scheduler.now();this.destination.next(new gb(a,
b))};return a}(l);g.prototype.timestamp=function(b){void 0===b&&(b=x);return this.lift(new ef(b))};var gf=function(){function b(){}b.prototype.call=function(a,b){return b.subscribe(new ff(a))};return b}(),ff=function(b){function a(a){b.call(this,a);this.array=[]}h(a,b);a.prototype._next=function(a){this.array.push(a)};a.prototype._complete=function(){this.destination.next(this.array);this.destination.complete()};return a}(l);g.prototype.toArray=function(){return this.lift(new gf)};g.prototype.toPromise=
function(b){var a=this;b||(n.Rx&&n.Rx.config&&n.Rx.config.Promise?b=n.Rx.config.Promise:n.Promise&&(b=n.Promise));if(!b)throw Error("no Promise impl found");return new b(function(b,e){var c;a.subscribe(function(a){return c=a},function(a){return e(a)},function(){return b(c)})})};var jf=function(){function b(a){this.windowBoundaries=a}b.prototype.call=function(a,b){a=new hf(a);b=b.subscribe(a);b.closed||a.add(p(a,this.windowBoundaries));return b};return b}(),hf=function(b){function a(a){b.call(this,
a);this.window=new v;a.next(this.window)}h(a,b);a.prototype.notifyNext=function(a,b,d,f,g){this.openWindow()};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){this._complete()};a.prototype._next=function(a){this.window.next(a)};a.prototype._error=function(a){this.window.error(a);this.destination.error(a)};a.prototype._complete=function(){this.window.complete();this.destination.complete()};a.prototype._unsubscribe=function(){this.window=null};a.prototype.openWindow=
function(){var a=this.window;a&&a.complete();var a=this.destination,b=this.window=new v;a.next(b)};return a}(q);g.prototype.window=function(b){return this.lift(new jf(b))};var lf=function(){function b(a,b){this.windowSize=a;this.startWindowEvery=b}b.prototype.call=function(a,b){return b.subscribe(new kf(a,this.windowSize,this.startWindowEvery))};return b}(),kf=function(b){function a(a,e,d){b.call(this,a);this.destination=a;this.windowSize=e;this.startWindowEvery=d;this.windows=[new v];this.count=
0;a.next(this.windows[0])}h(a,b);a.prototype._next=function(a){for(var b=0<this.startWindowEvery?this.startWindowEvery:this.windowSize,c=this.destination,f=this.windowSize,g=this.windows,h=g.length,l=0;l<h&&!this.closed;l++)g[l].next(a);a=this.count-f+1;0<=a&&0===a%b&&!this.closed&&g.shift().complete();0!==++this.count%b||this.closed||(b=new v,g.push(b),c.next(b))};a.prototype._error=function(a){var b=this.windows;if(b)for(;0<b.length&&!this.closed;)b.shift().error(a);this.destination.error(a)};a.prototype._complete=
function(){var a=this.windows;if(a)for(;0<a.length&&!this.closed;)a.shift().complete();this.destination.complete()};a.prototype._unsubscribe=function(){this.count=0;this.windows=null};return a}(l);g.prototype.windowCount=function(b,a){void 0===a&&(a=0);return this.lift(new lf(b,a))};var nf=function(){function b(a,b,e,d){this.windowTimeSpan=a;this.windowCreationInterval=b;this.maxWindowSize=e;this.scheduler=d}b.prototype.call=function(a,b){return b.subscribe(new mf(a,this.windowTimeSpan,this.windowCreationInterval,
this.maxWindowSize,this.scheduler))};return b}(),of=function(b){function a(){b.apply(this,arguments);this._numberOfNextedValues=0}h(a,b);a.prototype.next=function(a){this._numberOfNextedValues++;b.prototype.next.call(this,a)};Object.defineProperty(a.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0});return a}(v),mf=function(b){function a(a,e,d,f,g){b.call(this,a);this.destination=a;this.windowTimeSpan=e;this.windowCreationInterval=d;
this.maxWindowSize=f;this.scheduler=g;this.windows=[];a=this.openWindow();null!==d&&0<=d?(f={windowTimeSpan:e,windowCreationInterval:d,subscriber:this,scheduler:g},this.add(g.schedule(Ka,e,{subscriber:this,window:a,context:null})),this.add(g.schedule(Ub,d,f))):this.add(g.schedule(Tb,e,{subscriber:this,window:a,windowTimeSpan:e}))}h(a,b);a.prototype._next=function(a){for(var b=this.windows,c=b.length,f=0;f<c;f++){var g=b[f];g.closed||(g.next(a),g.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(g))}};
a.prototype._error=function(a){for(var b=this.windows;0<b.length;)b.shift().error(a);this.destination.error(a)};a.prototype._complete=function(){for(var a=this.windows;0<a.length;){var b=a.shift();b.closed||b.complete()}this.destination.complete()};a.prototype.openWindow=function(){var a=new of;this.windows.push(a);this.destination.next(a);return a};a.prototype.closeWindow=function(a){a.complete();var b=this.windows;b.splice(b.indexOf(a),1)};return a}(l);g.prototype.windowTime=function(b,a,c,e){var d=
x,f=null,g=Number.POSITIVE_INFINITY;z(e)&&(d=e);z(c)?d=c:P(c)&&(g=c);z(a)?d=a:P(a)&&(f=a);return this.lift(new nf(b,f,g,d))};var qf=function(){function b(a,b){this.openings=a;this.closingSelector=b}b.prototype.call=function(a,b){return b.subscribe(new pf(a,this.openings,this.closingSelector))};return b}(),pf=function(b){function a(a,e,d){b.call(this,a);this.openings=e;this.closingSelector=d;this.contexts=[];this.add(this.openSubscription=p(this,e,e))}h(a,b);a.prototype._next=function(a){var b=this.contexts;
if(b)for(var c=b.length,f=0;f<c;f++)b[f].window.next(a)};a.prototype._error=function(a){var c=this.contexts;this.contexts=null;if(c)for(var d=c.length,f=-1;++f<d;){var g=c[f];g.window.error(a);g.subscription.unsubscribe()}b.prototype._error.call(this,a)};a.prototype._complete=function(){var a=this.contexts;this.contexts=null;if(a)for(var e=a.length,d=-1;++d<e;){var f=a[d];f.window.complete();f.subscription.unsubscribe()}b.prototype._complete.call(this)};a.prototype._unsubscribe=function(){var a=this.contexts;
this.contexts=null;if(a)for(var b=a.length,d=-1;++d<b;){var f=a[d];f.window.unsubscribe();f.subscription.unsubscribe()}};a.prototype.notifyNext=function(a,b,d,f,g){if(a===this.openings){f=r(this.closingSelector)(b);if(f===m)return this.error(m.e);a=new v;b=new u;d={window:a,subscription:b};this.contexts.push(d);f=p(this,f,d);f.closed?this.closeWindow(this.contexts.length-1):(f.context=d,b.add(f));this.destination.next(a)}else this.closeWindow(this.contexts.indexOf(a))};a.prototype.notifyError=function(a){this.error(a)};
a.prototype.notifyComplete=function(a){a!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(a.context))};a.prototype.closeWindow=function(a){if(-1!==a){var b=this.contexts,c=b[a],f=c.window,c=c.subscription;b.splice(a,1);f.complete();c.unsubscribe()}};return a}(q);g.prototype.windowToggle=function(b,a){return this.lift(new qf(b,a))};var sf=function(){function b(a){this.closingSelector=a}b.prototype.call=function(a,b){return b.subscribe(new rf(a,this.closingSelector))};return b}(),rf=
function(b){function a(a,e){b.call(this,a);this.destination=a;this.closingSelector=e;this.openWindow()}h(a,b);a.prototype.notifyNext=function(a,b,d,f,g){this.openWindow(g)};a.prototype.notifyError=function(a,b){this._error(a)};a.prototype.notifyComplete=function(a){this.openWindow(a)};a.prototype._next=function(a){this.window.next(a)};a.prototype._error=function(a){this.window.error(a);this.destination.error(a);this.unsubscribeClosingNotification()};a.prototype._complete=function(){this.window.complete();
this.destination.complete();this.unsubscribeClosingNotification()};a.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()};a.prototype.openWindow=function(a){void 0===a&&(a=null);a&&(this.remove(a),a.unsubscribe());(a=this.window)&&a.complete();a=this.window=new v;this.destination.next(a);a=r(this.closingSelector)();a===m?(a=m.e,this.destination.error(a),this.window.error(a)):this.add(this.closingNotification=p(this,a))};return a}(q);
g.prototype.windowWhen=function(b){return this.lift(new sf(b))};var uf=function(){function b(a,b){this.observables=a;this.project=b}b.prototype.call=function(a,b){return b.subscribe(new tf(a,this.observables,this.project))};return b}(),tf=function(b){function a(a,e,d){b.call(this,a);this.observables=e;this.project=d;this.toRespond=[];a=e.length;this.values=Array(a);for(d=0;d<a;d++)this.toRespond.push(d);for(d=0;d<a;d++){var c=e[d];this.add(p(this,c,c,d))}}h(a,b);a.prototype.notifyNext=function(a,
b,d,f,g){this.values[d]=b;a=this.toRespond;0<a.length&&(d=a.indexOf(d),-1!==d&&a.splice(d,1))};a.prototype.notifyComplete=function(){};a.prototype._next=function(a){0===this.toRespond.length&&(a=[a].concat(this.values),this.project?this._tryProject(a):this.destination.next(a))};a.prototype._tryProject=function(a){var b;try{b=this.project.apply(this,a)}catch(d){this.destination.error(d);return}this.destination.next(b)};return a}(q);g.prototype.withLatestFrom=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-
0]=arguments[a];var c;"function"===typeof b[b.length-1]&&(c=b.pop());return this.lift(new uf(b,c))};g.prototype.zip=function(){for(var b=[],a=0;a<arguments.length;a++)b[a-0]=arguments[a];return this.lift.call(ua.apply(void 0,[this].concat(b)))};g.prototype.zipAll=function(b){return this.lift(new va(b))};var V=function(){return function(b,a){void 0===a&&(a=Number.POSITIVE_INFINITY);this.subscribedFrame=b;this.unsubscribedFrame=a}}(),hb=function(){function b(){this.subscriptions=[]}b.prototype.logSubscribedFrame=
function(){this.subscriptions.push(new V(this.scheduler.now()));return this.subscriptions.length-1};b.prototype.logUnsubscribedFrame=function(a){var b=this.subscriptions;b[a]=new V(b[a].subscribedFrame,this.scheduler.now())};return b}(),ka=function(b){function a(a,e){b.call(this,function(a){var b=this,c=b.logSubscribedFrame();a.add(new u(function(){b.logUnsubscribedFrame(c)}));b.scheduleMessages(a);return a});this.messages=a;this.subscriptions=[];this.scheduler=e}h(a,b);a.prototype.scheduleMessages=
function(a){for(var b=this.messages.length,c=0;c<b;c++){var f=this.messages[c];a.add(this.scheduler.schedule(function(a){a.message.notification.observe(a.subscriber)},f.frame,{message:f,subscriber:a}))}};return a}(g);La(ka,[hb]);var ib=function(b){function a(a,e){b.call(this);this.messages=a;this.subscriptions=[];this.scheduler=e}h(a,b);a.prototype._subscribe=function(a){var c=this,d=c.logSubscribedFrame();a.add(new u(function(){c.logUnsubscribedFrame(d)}));return b.prototype._subscribe.call(this,
a)};a.prototype.setup=function(){for(var a=this,b=a.messages.length,d=0;d<b;d++)(function(){var b=a.messages[d];a.scheduler.schedule(function(){b.notification.observe(a)},b.frame)})()};return a}(v);La(ib,[hb]);var kb=function(b){function a(a,e){var c=this;void 0===a&&(a=jb);void 0===e&&(e=Number.POSITIVE_INFINITY);b.call(this,a,function(){return c.frame});this.maxFrames=e;this.frame=0;this.index=-1}h(a,b);a.prototype.flush=function(){for(var a=this.actions,b=this.maxFrames,d,f;(f=a.shift())&&(this.frame=
f.delay)<=b&&!(d=f.execute(f.state,f.delay)););if(d){for(;f=a.shift();)f.unsubscribe();throw d;}};a.frameTimeFactor=10;return a}(S),jb=function(b){function a(a,e,d){void 0===d&&(d=a.index+=1);b.call(this,a,e);this.scheduler=a;this.work=e;this.index=d;this.index=a.index=d}h(a,b);a.prototype.schedule=function(c,e){void 0===e&&(e=0);if(!this.id)return b.prototype.schedule.call(this,c,e);var d=new a(this.scheduler,this.work);this.add(d);return d.schedule(c,e)};a.prototype.requestAsyncId=function(b,e,
d){void 0===d&&(d=0);this.delay=b.frame+d;b=b.actions;b.push(this);b.sort(a.sortActions);return!0};a.prototype.recycleAsyncId=function(a,b,d){};a.sortActions=function(a,b){return a.delay===b.delay?a.index===b.index?0:a.index>b.index?1:-1:a.delay>b.delay?1:-1};return a}(R),vf=function(b){function a(a){b.call(this,jb,750);this.assertDeepEqual=a;this.hotObservables=[];this.coldObservables=[];this.flushTests=[]}h(a,b);a.prototype.createTime=function(b){b=b.indexOf("|");if(-1===b)throw Error('marble diagram for time should have a completion marker "|"');
return b*a.frameTimeFactor};a.prototype.createColdObservable=function(b,e,d){if(-1!==b.indexOf("^"))throw Error('cold observable cannot have subscription offset "^"');if(-1!==b.indexOf("!"))throw Error('cold observable cannot have unsubscription marker "!"');b=a.parseMarbles(b,e,d);b=new ka(b,this);this.coldObservables.push(b);return b};a.prototype.createHotObservable=function(b,e,d){if(-1!==b.indexOf("!"))throw Error('hot observable cannot have unsubscription marker "!"');b=a.parseMarbles(b,e,d);
b=new ib(b,this);this.hotObservables.push(b);return b};a.prototype.materializeInnerObservable=function(a,b){var c=this,e=[];a.subscribe(function(a){e.push({frame:c.frame-b,notification:w.createNext(a)})},function(a){e.push({frame:c.frame-b,notification:w.createError(a)})},function(){e.push({frame:c.frame-b,notification:w.createComplete()})});return e};a.prototype.expectObservable=function(b,e){var c=this;void 0===e&&(e=null);var f=[],k={actual:f,ready:!1};e=a.parseMarblesAsSubscriptions(e).unsubscribedFrame;
var h;this.schedule(function(){h=b.subscribe(function(a){var b=a;a instanceof g&&(b=c.materializeInnerObservable(b,c.frame));f.push({frame:c.frame,notification:w.createNext(b)})},function(a){f.push({frame:c.frame,notification:w.createError(a)})},function(){f.push({frame:c.frame,notification:w.createComplete()})})},0);e!==Number.POSITIVE_INFINITY&&this.schedule(function(){return h.unsubscribe()},e);this.flushTests.push(k);return{toBe:function(b,c,d){k.ready=!0;k.expected=a.parseMarbles(b,c,d,!0)}}};
a.prototype.expectSubscriptions=function(b){var c={actual:b,ready:!1};this.flushTests.push(c);return{toBe:function(b){b="string"===typeof b?[b]:b;c.ready=!0;c.expected=b.map(function(b){return a.parseMarblesAsSubscriptions(b)})}}};a.prototype.flush=function(){for(var a=this.hotObservables;0<a.length;)a.shift().setup();b.prototype.flush.call(this);for(a=this.flushTests.filter(function(a){return a.ready});0<a.length;){var e=a.shift();this.assertDeepEqual(e.actual,e.expected)}};a.parseMarblesAsSubscriptions=
function(a){if("string"!==typeof a)return new V(Number.POSITIVE_INFINITY);for(var b=a.length,c=-1,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=0;h<b;h++){var l=h*this.frameTimeFactor,m=a[h];switch(m){case "-":case " ":break;case "(":c=l;break;case ")":c=-1;break;case "^":if(f!==Number.POSITIVE_INFINITY)throw Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");f=-1<c?c:l;break;case "!":if(g!==Number.POSITIVE_INFINITY)throw Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");
g=-1<c?c:l;break;default:throw Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+m+"'.");}}return 0>g?new V(f):new V(f,g)};a.parseMarbles=function(a,b,d,f){void 0===f&&(f=!1);if(-1!==a.indexOf("!"))throw Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var c=a.length,e=[],g=a.indexOf("^"),g=-1===g?0:g*-this.frameTimeFactor,h="object"!==typeof b?function(a){return a}:function(a){return f&&b[a]instanceof ka?b[a].messages:
b[a]},l=-1,m=0;m<c;m++){var n=m*this.frameTimeFactor+g,p=void 0,q=a[m];switch(q){case "-":case " ":break;case "(":l=n;break;case ")":l=-1;break;case "|":p=w.createComplete();break;case "^":break;case "#":p=w.createError(d||"error");break;default:p=w.createNext(h(q))}p&&e.push({frame:-1<l?l:n,notification:p})}return e};return a}(kb),lb=new (function(){return function(b){b.requestAnimationFrame?(this.cancelAnimationFrame=b.cancelAnimationFrame.bind(b),this.requestAnimationFrame=b.requestAnimationFrame.bind(b)):
b.mozRequestAnimationFrame?(this.cancelAnimationFrame=b.mozCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.mozRequestAnimationFrame.bind(b)):b.webkitRequestAnimationFrame?(this.cancelAnimationFrame=b.webkitCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.webkitRequestAnimationFrame.bind(b)):b.msRequestAnimationFrame?(this.cancelAnimationFrame=b.msCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.msRequestAnimationFrame.bind(b)):b.oRequestAnimationFrame?(this.cancelAnimationFrame=
b.oCancelAnimationFrame.bind(b),this.requestAnimationFrame=b.oRequestAnimationFrame.bind(b)):(this.cancelAnimationFrame=b.clearTimeout.bind(b),this.requestAnimationFrame=function(a){return b.setTimeout(a,1E3/60)})}}())(n),wf=function(b){function a(a,e){b.call(this,a,e);this.scheduler=a;this.work=e}h(a,b);a.prototype.requestAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d)return b.prototype.requestAsyncId.call(this,a,e,d);a.actions.push(this);return a.scheduled||(a.scheduled=lb.requestAnimationFrame(a.flush.bind(a,
null)))};a.prototype.recycleAsyncId=function(a,e,d){void 0===d&&(d=0);if(null!==d&&0<d||null===d&&0<this.delay)return b.prototype.recycleAsyncId.call(this,a,e,d);0===a.actions.length&&(lb.cancelAnimationFrame(e),a.scheduled=void 0)};return a}(R),xf=new (function(b){function a(){b.apply(this,arguments)}h(a,b);a.prototype.flush=function(a){this.active=!0;this.scheduled=void 0;var b=this.actions,c,f=-1,g=b.length;a=a||b.shift();do if(c=a.execute(a.state,a.delay))break;while(++f<g&&(a=b.shift()));this.active=
!1;if(c){for(;++f<g&&(a=b.shift());)a.unsubscribe();throw c;}};return a}(S))(wf),yf={rxSubscriber:Q,observable:H,iterator:A};t.Scheduler={asap:ba,queue:Ya,animationFrame:xf,async:x};t.Symbol=yf;t.Subject=v;t.AnonymousSubject=Y;t.Observable=g;t.Subscription=u;t.Subscriber=l;t.AsyncSubject=K;t.ReplaySubject=L;t.BehaviorSubject=bb;t.ConnectableObservable=U;t.Notification=w;t.EmptyError=aa;t.ArgumentOutOfRangeError=T;t.ObjectUnsubscribedError=G;t.TimeoutError=fb;t.UnsubscriptionError=N;t.TimeInterval=
eb;t.Timestamp=gb;t.TestScheduler=vf;t.VirtualTimeScheduler=kb;t.AjaxResponse=Wa;t.AjaxError=Z;t.AjaxTimeoutError=Xa;Object.defineProperty(t,"__esModule",{value:!0})});

/**!
 2016-2017 Convergence Labs, Inc.; All Rights Reserved.
@version 1.0.0-alpha.24
@license http://convergencelabs.com/terms/services/
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/Rx"),require("rxjs/BehaviorSubject")):"function"==typeof define&&define.amd?define(["exports","rxjs/Rx","rxjs/BehaviorSubject"],t):t(e.Convergence=e.Convergence||{},e.Rx,e.Rx)}(this,function(e,t,n){"use strict";function r(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){if(void 0!==e)switch(t){case rt.Types.INDEX:case rt.Types.PROPERTY:case rt.Types.ELEMENT:return e;case rt.Types.RANGE:for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];n.push({start:o[0],end:o[1]})}return n;default:throw new Error("Invalid reference type")}}function o(e,t){if(void 0!==e)switch(t){case rt.Types.INDEX:case rt.Types.PROPERTY:case rt.Types.ELEMENT:return e;case rt.Types.RANGE:for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r];n.push([o.start,o.end])}return n;default:throw new Error("Invalid reference type")}}function s(e){return e?new yt(e.r,e.w,e.d,e.m):null}function a(e){if(null===e)return null;if(void 0!==e)return{r:e.read,w:e.write,d:e.remove,m:e.manage}}function u(e){return e.map(function(e){return c(e)})}function c(e){var t=ot.value(e.c),n=i(e.v,t),r={sessionId:e.s,id:e.d,key:e.k,referenceType:t,values:n};return r}function E(e){return{autoCreateId:e.a}}function h(e){var t,n=e.collection,r=e.data?_t(e.data):void 0,i=a(e.worldPermissions),o=e.overrideWorld;return e.userPermissions&&(t={},Object.keys(e.userPermissions).forEach(function(n){t[n]=a(e.userPermissions[n])})),{c:n,d:r,v:o,w:i,u:t}}function f(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=t(e[r]),n},{})}function p(e){var t=typeof e;if(null===e||void 0===e||"string"===t||"number"===t||"boolean"===t)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(function(e){return p(e)});if(e instanceof Map){var n=new Map;return e.forEach(function(e,t){n.set(t,p(e))}),n}if(e instanceof Set){var r=new Set;return e.forEach(function(e){return r.add(p(e))}),r}if(e.constructor===Object){var i={};return Object.keys(e).forEach(function(t){i[t]=p(e[t])}),i}var o=e.constructor.name||e.constructor.toString();throw new Error("Can not clone unknown type: "+o)}function d(e){var t={channelId:e.i,channelType:e.p,channelMembership:e.cm,name:e.n,topic:e.o,createdTime:e.c,lastEventTime:e.l,lastEventNumber:e.ec,maxSeenEvent:e.ls,members:e.m};return t}function l(e){return{i:e.channelId}}function v(e){var t={channel:d(e.c)};return t}function S(e){var t={channelId:e.i,eventNumber:e.n,timestamp:new Date(e.p),username:e.u};return t}function _(e){return{i:e.channelId,u:e.username}}function R(e){return{i:e.channelId,m:e.message}}function y(e){var t={channelId:e.i,eventNumber:e.e,timestamp:new Date(e.p),username:it.parseUsername(e.s),sessionId:e.s,message:e.m};return t}function T(e){return{m:e.modelId}}function O(e){return{version:e.v,createdTime:e.c,modifiedTime:e.m,data:Rt(e.d),collectionId:e.i}}function A(e){return{i:e.id,e:e.channelType,p:e.membership,n:e.name,c:e.topic,m:e.members}}function N(e){var t={channelId:e.i};return t}function I(e){return{i:e.channelId}}function m(e){return{i:e.channelIds}}function C(e){var t=e.c,n=t.map(function(e){return d(e)}),r={channels:n};return r}function g(e){return{u:e.channelUsernames}}function w(e){return{i:e.channelIds}}function b(e){var t={exists:e.e};return t}function M(e){return{i:e.channelId}}function D(e){var t={channelId:e.i,eventNumber:e.n,username:e.u,timestamp:new Date(e.p)};return t}function L(e){return{i:e.channelId,u:e.username}}function P(e){return{i:e.channelId,c:e.topic}}function U(e){return{i:e.channelId,n:e.name}}function x(e){return{i:e.channelId,e:e.eventNumber}}function H(e){var t={channelId:e.i,eventNumber:e.e};return t}function B(e){return{i:e.channelId,s:e.startEvent,l:e.limit,f:e.forward,e:e.eventFilter.map(function(e){return G(e)})}}function z(e){var t=e.e,n=t.map(function(e){return V(e)}),r={entries:n};return r}function V(e){var t=e.e,n=e.n,r=new Date(e.p),i=e.u;switch(t){case Ai.CREATED:return new li(n,r,i,e.a,e.o,e.m);case Ai.MESSAGE:var o=e.m;return new vi(n,r,i,o);case Ai.USER_JOINED:return new Si(n,r,i);case Ai.USER_LEFT:return new _i(n,r,i);case Ai.USER_ADDED:var s=e.b;return new Ri(n,r,i,s);case Ai.USER_REMOVED:var a=e.b;return new yi(n,r,i,a);case Ai.NAME_CHANGED:var u=e.a;return new Ti(n,r,i,u);case Ai.TOPIC_CHANGED:var c=e.o;return new Oi(n,r,i,c);default:throw new Error("Unexpected chat entry type: "+t)}}function G(e){switch(e){case li.TYPE:return Ai.CREATED;case vi.TYPE:return Ai.MESSAGE;case Si.TYPE:return Ai.USER_JOINED;case _i.TYPE:return Ai.USER_LEFT;case Ri.TYPE:return Ai.USER_ADDED;case yi.TYPE:return Ai.USER_REMOVED;case Ti.TYPE:return Ai.NAME_CHANGED;case Oi.TYPE:return Ai.TOPIC_CHANGED;default:throw new Error("Unexpected chat event type: "+e)}}function j(e){return{i:e.ids}}function k(e){var t={groups:e.g.map(function(e){return Y(e)})};return t}function Y(e){return new Ni(e.i,e.d,e.m)}function Q(e){return{u:e.usernames}}function F(e){var t={groupsByUser:e.g};return t}function J(e){return{p:e.idType,i:e.id}}function q(e){var t={permissions:e.p};return t}function W(e){var t;e.users&&(t={},e.users.forEach(function(e,n){return t[n]=e}));var n;return e.groups&&(n={},e.groups.forEach(function(e,t){return n[t]=e})),{p:e.idType,i:e.id,w:e.world,u:t,g:n}}function K(e){var t;e.users&&(t={},e.users.forEach(function(e,n){return t[n]=e}));var n;return e.groups&&(n={},e.groups.forEach(function(e,t){return n[t]=e})),{p:e.idType,i:e.id,w:e.world,u:t,g:n}}function X(e){var t;e.users&&(t={},e.users.forEach(function(e,n){return t[n]=e}));var n;return e.groups&&(n={},e.groups.forEach(function(e,t){return n[t]=e})),{p:e.idType,i:e.id,w:e.world,u:t,g:n}}function $(e){return{p:e.idType,i:e.id}}function Z(e){var t={permissions:e.p};return t}function ee(e){return{p:e.idType,i:e.id}}function te(e){return{p:e.idType,i:e.id,u:e.username}}function ne(e){return{permissions:e.p}}function re(e){return{p:e.idType,i:e.id}}function ie(e){var t=new Map;return Object.keys(e.u).forEach(function(n){t.set(n,e.u[n])}),{groups:t}}function oe(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:case Li.Start:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Li.Within:case Li.End:return new Pi(e.copy({index:e.index-1}),t.copy({toIndex:t.toIndex+1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function se(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:case Li.Start:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Li.Within:case Li.End:return new Pi(e.copy({index:e.index+1}),t.copy({fromIndex:t.fromIndex+1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function ae(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.After:return new Pi(e,t);default:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}))}}function ue(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Li.Start:return new Pi(e.copy({index:t.toIndex}),t.copy({noOp:!0}));case Li.Within:case Li.End:return new Pi(e.copy({index:e.index-1}),t.copy({toIndex:t.toIndex-1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function ce(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Li.Start:case Li.Within:return new Pi(e.copy({index:e.index+1}),t.copy({fromIndex:t.fromIndex-1}));case Li.End:return new Pi(e.copy({index:t.toIndex}),t.copy({noOp:!0}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function Ee(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Li.Start:case Li.Within:case Li.End:return new Pi(e,t.copy({noOp:!0}));default:return new Pi(e,t)}}function he(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:return new Pi(e.copy({index:t.toIndex}),t);case Li.Within:case Li.End:return new Pi(e.copy({index:e.index-1}),t);default:throw new Error("Invalid range-index relationship")}}function fe(e,t){switch(ji.getRangeIndexRelationship(t,e.index)){case Li.Before:case Li.After:return new Pi(e,t);case Li.End:return new Pi(e.copy({index:t.toIndex}),t);case Li.Within:case Li.Start:return new Pi(e.copy({index:e.index+1}),t);default:throw new Error("Invalid range-index relationship")}}function pe(e,t){return new Pi(e,t)}function de(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:case Li.Start:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Li.Within:case Li.End:return new Pi(e.copy({toIndex:e.toIndex+1}),t.copy({index:t.index-1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function le(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:case Li.Start:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Li.Within:case Li.End:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({index:t.index+1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function ve(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.After:return new Pi(e,t);default:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t)}}function Se(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Li.Start:return new Pi(e.copy({noOp:!0}),t.copy({index:e.toIndex}));case Li.Within:case Li.End:return new Pi(e.copy({toIndex:e.toIndex-1}),t.copy({index:t.index-1}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function _e(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Li.Start:case Li.Within:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({index:t.index+1}));case Li.End:return new Pi(e.copy({noOp:!0}),t.copy({index:e.toIndex}));case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function Re(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Li.Start:case Li.Within:case Li.End:return new Pi(e.copy({noOp:!0}),t);case Li.After:return new Pi(e,t);default:throw new Error("Invalid range-index relationship")}}function ye(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:return new Pi(e,t.copy({index:e.toIndex}));case Li.Within:case Li.End:return new Pi(e,t.copy({index:t.index-1}));default:throw new Error("Invalid range-index relationship")}}function Te(e,t){switch(ji.getRangeIndexRelationship(e,t.index)){case Li.Before:case Li.After:return new Pi(e,t);case Li.End:return new Pi(e,t.copy({index:e.toIndex}));case Li.Start:case Li.Within:return new Pi(e,t.copy({index:t.index+1}));default:throw new Error("Invalid range-index relationship")}}function Oe(e,t){return new Pi(e,t)}function Ae(e,t){switch(ji.getRangeRelationship(e,t)){case Vi.Precedes:return new Pi(e,t);case Vi.PrecededBy:return new Pi(e,t);case Vi.Meets:return new Pi(e.copy({toIndex:e.toIndex-1}),t.copy({fromIndex:t.fromIndex-1}));case Vi.MetBy:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({toIndex:t.toIndex-1}));case Vi.Overlaps:return new Pi(e.copy({toIndex:e.toIndex-1}),t.copy({fromIndex:t.fromIndex-1}));case Vi.OverlappedBy:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({toIndex:t.toIndex-1}));case Vi.Starts:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.StartedBy:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.Contains:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Vi.ContainedBy:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Vi.Finishes:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({toIndex:t.toIndex-1}));case Vi.FinishedBy:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Vi.EqualTo:return new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}));default:throw new Error("Invalid range-range relationship")}}function Ne(e,t){switch(ji.getRangeRelationship(e,t)){case Vi.Precedes:return new Pi(e,t);case Vi.PrecededBy:return new Pi(e,t);case Vi.Meets:return new Pi(e.copy({toIndex:e.toIndex+1}),t.copy({toIndex:t.toIndex-1}));case Vi.MetBy:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.Overlaps:return new Pi(e.copy({toIndex:e.toIndex+1}),t.copy({toIndex:t.toIndex-1}));case Vi.OverlappedBy:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({fromIndex:t.fromIndex-1}));case Vi.Starts:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Vi.StartedBy:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({fromIndex:t.fromIndex-1}));case Vi.Contains:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Vi.ContainedBy:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Vi.Finishes:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({fromIndex:t.fromIndex-1}));case Vi.FinishedBy:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));case Vi.EqualTo:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({fromIndex:t.fromIndex-1}));default:throw new Error("Invalid range-range relationship")}}function Ie(e,t){switch(ji.getRangeIndexRelationship(e,t.fromIndex)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:return new Pi(e,t.copy({fromIndex:e.toIndex,toIndex:e.toIndex}));case Li.Within:case Li.End:return new Pi(e,t.copy({fromIndex:t.fromIndex-1,toIndex:t.toIndex-1}));default:throw new Error("Invalid range-index relationship")}}function me(e,t){switch(ji.getRangeRelationship(e,t)){case Vi.Precedes:return new Pi(e,t);case Vi.PrecededBy:return new Pi(e,t);case Vi.Meets:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.MetBy:return new Pi(e.copy({toIndex:e.toIndex-1}),t.copy({toIndex:t.toIndex+1}));case Vi.Overlaps:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({fromIndex:t.fromIndex+1}));case Vi.OverlappedBy:return new Pi(e.copy({toIndex:e.toIndex-1}),t.copy({toIndex:t.toIndex+1}));case Vi.Starts:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({fromIndex:t.fromIndex+1}));case Vi.StartedBy:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Vi.Contains:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Vi.ContainedBy:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Vi.Finishes:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);case Vi.FinishedBy:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({fromIndex:t.fromIndex+1}));case Vi.EqualTo:return new Pi(e.copy({fromIndex:e.fromIndex-1}),t.copy({fromIndex:t.fromIndex+1}));default:throw new Error("Invalid range-range relationship")}}function Ce(e,t){switch(ji.getRangeRelationship(e,t)){case Vi.Precedes:return new Pi(e,t);case Vi.PrecededBy:return new Pi(e,t);case Vi.Meets:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({toIndex:t.toIndex+1}));case Vi.MetBy:return new Pi(e.copy({toIndex:e.toIndex+1}),t.copy({fromIndex:t.fromIndex+1}));case Vi.Overlaps:return new Pi(e.copy({fromIndex:e.fromIndex+1}),t.copy({toIndex:t.toIndex+1}));case Vi.OverlappedBy:return new Pi(e.copy({toIndex:e.toIndex+1}),t.copy({fromIndex:t.fromIndex+1}));case Vi.Starts:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Vi.StartedBy:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Vi.Contains:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Vi.ContainedBy:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Vi.Finishes:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.FinishedBy:return new Pi(e.copy({fromIndex:t.toIndex}),t.copy({noOp:!0}));case Vi.EqualTo:return new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}));default:throw new Error("Invalid range-range relationship")}}function ge(e,t){switch(ji.getRangeIndexRelationship(e,t.fromIndex)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:case Li.Within:return new Pi(e,t.copy({fromIndex:t.fromIndex+1,toIndex:t.toIndex+1}));case Li.End:return new Pi(e,t.copy({fromIndex:e.toIndex,toIndex:e.toIndex}));default:throw new Error("Invalid range-index relationship")}}function we(e,t){switch(ji.getRangeIndexRelationship(t,e.fromIndex)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:return new Pi(e.copy({fromIndex:t.toIndex,toIndex:t.toIndex}),t);case Li.Within:case Li.End:return new Pi(e.copy({fromIndex:e.fromIndex-1,toIndex:e.toIndex-1}),t);default:throw new Error("Invalid range-index relationship")}}function be(e,t){switch(ji.getRangeIndexRelationship(t,e.fromIndex)){case Li.Before:case Li.After:return new Pi(e,t);case Li.Start:case Li.Within:return new Pi(e.copy({fromIndex:e.fromIndex+1,toIndex:e.toIndex+1}),t);case Li.End:return new Pi(e.copy({fromIndex:t.toIndex,toIndex:t.toIndex}),t);default:throw new Error("Invalid range-index relationship")}}function Me(e,t){return new Pi(e,t)}function De(e){switch(e.type){case je.USER_JOINED_CHAT_CHANNEL:var t=e;return new Su(t.channelId,t.eventNumber,t.timestamp,t.username);case je.USER_LEFT_CHAT_CHANNEL:var n=e;return new _u(n.channelId,n.eventNumber,n.timestamp,n.username);case je.USER_ADDED_TO_CHAT_CHANNEL:var r=e;return new Ru(r.channelId,r.eventNumber,r.timestamp,r.username,r.addedBy);case je.USER_REMOVED_FROM_CHAT_CHANNEL:var i=e;return new yu(i.channelId,i.eventNumber,i.timestamp,i.username,i.removedBy);case je.CHAT_CHANNEL_REMOVED:var o=e;return new Iu(o.channelId);case je.CHAT_CHANNEL_NAME_CHANGED:var s=e;return new Tu(s.channelId,s.eventNumber,s.timestamp,s.name,s.changedBy);case je.CHAT_CHANNEL_TOPIC_CHANGED:var a=e;return new Ou(a.channelId,a.eventNumber,a.timestamp,a.topic,a.changedBy);case je.REMOTE_CHAT_MESSAGE:var u=e;return new vu(u.channelId,u.eventNumber,u.timestamp,u.username,u.sessionId,u.message)}}function Le(e,t,n,r){return ku.connect(e,t,n,r)}function Pe(e,t,n){return ku.connectAnonymously(e,t,n)}function Ue(e,t,n){return ku.connectWithJwt(e,t,n)}var xe=function(){function e(e,t,n){this.h=e,this.j=t,this.x=n,this.y={},this.z=!1}return e.prototype.setPingInterval=function(e){this.j=e},e.prototype.getPingInterval=function(){return this.j},e.prototype.setPongTimeout=function(e){this.x=e},e.prototype.getPongTimeout=function(){return this.x},e.prototype.messageReceived=function(){this.z&&(this.cancelPongTimeout(),this.restartPingTimeout())},e.prototype.start=function(){if(null==this.h)throw"Can't start the HeartbeatManager unless the callback is set.";this.y.heartbeatHelper&&console.log("HeartbeatHelper started with Ping Interval "+this.j+" and Pong Timeout "+this.x),this.z=!0,this.messageReceived()},e.prototype.stop=function(){this.z=!1,this.stopPingTimer(),this.cancelPongTimeout(),this.y.heartbeatHelper&&console.log("HeartbeatHelper stopped.")},Object.defineProperty(e.prototype,"started",{get:function(){return this.z},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stopped",{get:function(){return!this.z},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.stop()},e.prototype.sendPing=function(){this.h.sendPing(),this.schedulePongTimeout()},e.prototype.schedulePongTimeout=function(){var e=this;this.A=setTimeout(function(){e.h.onTimeout()},1e3*this.x)},e.prototype.cancelPongTimeout=function(){null!=this.A&&(clearTimeout(this.A),this.A=null)},e.prototype.stopPingTimer=function(){null!=this.B&&(clearTimeout(this.B),this.B=null)},e.prototype.restartPingTimeout=function(){this.stopPingTimer();var e=this;this.B=setTimeout(function(){e.sendPing()},1e3*this.j)},e}(),He={SOCKET_MESSAGES:!1,SOCKET_CONNECTION:!1,PROTOCOL_EVENTS:!1,PROTOCOL_MESSAGES:!1,PROTOCOL_PINGS:!1,CONNECTION:!1};"object"==typeof CONVERGENCE_DEBUG&&Object.assign(He,CONVERGENCE_DEBUG);var Be=He,ze=function(){function e(){this.C={},this.D=e.defaultMaxListeners}return e.prototype.addListener=function(e,t){if("function"!=typeof t)throw new TypeError("Listeners must be functions");e=this.F(e);var n=this.C[e];if(void 0===n&&(n=[],this.C[e]=n),!(n.indexOf(t)>=0)){if(n.length>=this.D)throw new Error("Max listeners exceeded for event: "+e);return n.push(t),this}},e.prototype.on=function(e,t){return this.addListener(e,t)},e.prototype.once=function(e,t){var n=this,r=function(){n.removeListener(e,r),t()};return this.addListener(e,r)},e.prototype.removeAllListenersForAllEvents=function(){return this.C={},this},e.prototype.removeAllListeners=function(e){return e=this.F(e),delete this.C[e],this},e.prototype.removeListener=function(e,t){e=this.F(e);var n=this.listeners(e),r=n.indexOf(t);return r!==-1&&n.splice(r,1),this},e.prototype.off=function(e,t){return this.removeListener(e,t)},e.prototype.listeners=function(e){return e=this.F(e),this.C[e]||[]},e.prototype.listenerCount=function(e){return e=this.F(e),this.listeners(e).length},e.prototype.getMaxListeners=function(){return this.D},e.prototype.setMaxListeners=function(e){this.D=e},e.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];e=this.F(e);var i=this.listeners(e);return i.slice(0).forEach(function(e){e.apply(t,n||[])}),this},e.prototype.F=function(e){if("string"==typeof e)return e.toLowerCase();if(e>=0)return e;throw new Error("Event numbers must be >= 0")},e}();ze.defaultMaxListeners=100;var Ve=function(){function e(){var e=this;this.G=new Promise(function(t,n){e.H=t,e.I=n})}return e.prototype.resolve=function(e){this.H(e)},e.prototype.reject=function(e){this.I(e)},e.prototype.promise=function(){return this.G},e}(),Ge=function(e){function t(t){var n=e.call(this)||this,r=t;return r=r.replace(/https:/i,"wss:"),r=r.replace(/http:/i,"ws:"),n.J=r,n}return r(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this.J},enumerable:!0,configurable:!0}),t.prototype.open=function(){if(this.K=new Ve,this.L&&this.L.readyState===WebSocket.CONNECTING)throw new Error("Connection already in the process of opening.");if(this.L&&this.L.readyState===WebSocket.OPEN)throw new Error("Can not call connect on a client that is already connected.");if(this.L&&this.L.readyState===WebSocket.CLOSING)throw new Error("Can not call connect on a client that is in the process of closing.");return this.L=new WebSocket(this.J),this.attachToSocket(this.L),this.K.promise()},t.prototype.close=function(){return this.doClose(!0)},t.prototype.terminate=function(e){return this.doClose(!1,e)},t.prototype.doClose=function(e,t){var n=new Ve;if(this.L&&this.L.readyState!==WebSocket.CLOSED)if(this.L.readyState===WebSocket.CLOSING)Be.SOCKET_CONNECTION&&console.log("Attempted to close a WebSocket that was already closing."),n.reject(new Error("Connection is already closing."));else if(this.L.readyState===WebSocket.CONNECTING){if(Be.SOCKET_CONNECTION&&console.log("Closing a connecting Web Socket."),this.detachFromSocket(this.L),this.L.close(),this.L=null,null!==this.K){var r=this.K;this.K=null,r.reject(new Error("Web Socket connection aborted while opening"))}n.resolve(null)}else{this.M=n;try{e?(Be.SOCKET_CONNECTION&&console.log("Closing Web Socket normally."),this.L.close(1e3)):(Be.SOCKET_CONNECTION&&console.log("Closing Web Socket abnormally."),this.L.close(4006,t))}catch(e){console.error("Error closing Web Socket connection.",e),this.M.reject(e)}finally{this.detachFromSocket(this.L),this.L=null}}else Be.SOCKET_CONNECTION&&console.log("Can't close a closed Web Socket."),n.reject(new Error("Can not call disconnect on a client that is not connected."));return n.promise()},t.prototype.isOpen=function(){return null!=this.L&&this.L.readyState===WebSocket.OPEN},t.prototype.send=function(e){if(!this.isOpen())throw new Error("Can't send protocol while socket is not open.");var t=JSON.stringify(e);Be.SOCKET_MESSAGES&&console.log("S: "+t),this.L.send(t)},t.prototype.detachFromSocket=function(e){e.onmessage=void 0,e.onopen=void 0,e.onerror=void 0},t.prototype.attachToSocket=function(e){var n=this;e.onmessage=function(e){try{var r=JSON.parse(e.data);Be.SOCKET_MESSAGES&&console.log("R: "+e.data),n.emit(t.Events.MESSAGE,r)}catch(e){console.error("Error processing Web Socket Message.",e)}},e.onopen=function(e){if(n.K){Be.SOCKET_CONNECTION&&console.log("Web Socket connection opened");try{n.K.resolve()}catch(e){console.log("Error resolving WebSocket Open Promise.")}n.K=null}else n.emit(t.Events.ERROR,"Received onOpen event while in state: "+n.L.readyState)},e.onerror=function(e){if(void 0===n.L||n.L.readyState===WebSocket.CONNECTING){Be.SOCKET_CONNECTION&&console.log("Web Socket error.",e);try{n.emit(t.Events.ERROR,e.data)}catch(e){console.log("Error handling WebSocket error.",e)}}},e.onclose=function(r){n.detachFromSocket(e),e.onclose=null,n.L=null;try{n.K?(Be.SOCKET_CONNECTION&&console.log("Web Socket connection failed: ",r),n.K.reject(new Error("unable to connect")),n.K=null):n.M?(Be.SOCKET_CONNECTION&&console.log("Web Socket onClose received while closing: ",r),n.M.resolve(),n.M=null):(Be.SOCKET_CONNECTION&&console.log("Web Socket connection unexpectedly closed: ",r),n.emit(t.Events.CLOSE,"unexpected Web Socket closure."))}catch(e){console.log("Error handling web socket close event.",e)}}},t}(ze);Ge.Events={MESSAGE:"message",ERROR:"error",CLOSE:"close"};var je;!function(e){e[e.ERROR=0]="ERROR",e[e.PING=1]="PING",e[e.PONG=2]="PONG",e[e.HANDSHAKE_REQUEST=3]="HANDSHAKE_REQUEST",e[e.HANDSHAKE_RESPONSE=4]="HANDSHAKE_RESPONSE",e[e.PASSWORD_AUTH_REQUEST=5]="PASSWORD_AUTH_REQUEST",e[e.TOKEN_AUTH_REQUEST=6]="TOKEN_AUTH_REQUEST",e[e.ANONYMOUS_AUTH_REQUEST=7]="ANONYMOUS_AUTH_REQUEST",e[e.AUTHENTICATE_RESPONSE=10]="AUTHENTICATE_RESPONSE",e[e.OPEN_REAL_TIME_MODEL_REQUEST=100]="OPEN_REAL_TIME_MODEL_REQUEST",e[e.OPEN_REAL_TIME_MODEL_RESPONSE=101]="OPEN_REAL_TIME_MODEL_RESPONSE",e[e.CLOSES_REAL_TIME_MODEL_REQUEST=102]="CLOSES_REAL_TIME_MODEL_REQUEST",e[e.CLOSE_REAL_TIME_MODEL_RESPONSE=103]="CLOSE_REAL_TIME_MODEL_RESPONSE",e[e.CREATE_REAL_TIME_MODEL_REQUEST=104]="CREATE_REAL_TIME_MODEL_REQUEST",e[e.CREATE_REAL_TIME_MODEL_RESPONSE=105]="CREATE_REAL_TIME_MODEL_RESPONSE",e[e.DELETE_REAL_TIME_MODEL_REQUEST=106]="DELETE_REAL_TIME_MODEL_REQUEST",e[e.DELETE_REAL_TIME_MODEL_RESPONSE=107]="DELETE_REAL_TIME_MODEL_RESPONSE",e[e.FORCE_CLOSE_REAL_TIME_MODEL=108]="FORCE_CLOSE_REAL_TIME_MODEL",e[e.REMOTE_CLIENT_OPENED=109]="REMOTE_CLIENT_OPENED",e[e.REMOTE_CLIENT_CLOSED=110]="REMOTE_CLIENT_CLOSED",e[e.MODEL_AUTO_CREATE_CONFIG_REQUEST=111]="MODEL_AUTO_CREATE_CONFIG_REQUEST",e[e.MODEL_AUTO_CREATE_CONFIG_RESPONSE=112]="MODEL_AUTO_CREATE_CONFIG_RESPONSE",e[e.REMOTE_OPERATION=113]="REMOTE_OPERATION",e[e.OPERATION_SUBMISSION=114]="OPERATION_SUBMISSION",e[e.OPERATION_ACKNOWLEDGEMENT=115]="OPERATION_ACKNOWLEDGEMENT",e[e.PUBLISH_REFERENCE=116]="PUBLISH_REFERENCE",e[e.SET_REFERENCE=117]="SET_REFERENCE",e[e.CLEAR_REFERENCE=118]="CLEAR_REFERENCE",e[e.UNPUBLISH_REFERENCE=119]="UNPUBLISH_REFERENCE",e[e.REFERENCE_PUBLISHED=120]="REFERENCE_PUBLISHED",e[e.REFERENCE_SET=121]="REFERENCE_SET",e[e.REFERENCE_CLEARED=122]="REFERENCE_CLEARED",e[e.REFERENCE_UNPUBLISHED=123]="REFERENCE_UNPUBLISHED",e[e.MODELS_QUERY_REQUEST=124]="MODELS_QUERY_REQUEST",e[e.MODELS_QUERY_RESPONSE=125]="MODELS_QUERY_RESPONSE",e[e.HISTORICAL_DATA_REQUEST=126]="HISTORICAL_DATA_REQUEST",e[e.HISTORICAL_DATA_RESPONSE=127]="HISTORICAL_DATA_RESPONSE",e[e.HISTORICAL_OPERATIONS_REQUEST=128]="HISTORICAL_OPERATIONS_REQUEST",e[e.HISTORICAL_OPERATIONS_RESPONSE=129]="HISTORICAL_OPERATIONS_RESPONSE",e[e.GET_MODEL_PERMISSIONS_REQUEST=130]="GET_MODEL_PERMISSIONS_REQUEST",e[e.GET_MODEL_PERMISSIONS_RESPONSE=131]="GET_MODEL_PERMISSIONS_RESPONSE",e[e.SET_MODEL_PERMISSIONS_REQUEST=132]="SET_MODEL_PERMISSIONS_REQUEST",e[e.SET_MODEL_PERMISSIONS_RESPONSE=133]="SET_MODEL_PERMISSIONS_RESPONSE",e[e.MODEL_PERMISSIONS_CHANGED=134]="MODEL_PERMISSIONS_CHANGED",e[e.USER_LOOKUP_REQUEST=200]="USER_LOOKUP_REQUEST",e[e.USER_SEARCH_REQUEST=201]="USER_SEARCH_REQUEST",e[e.USER_LIST_RESPONSE=202]="USER_LIST_RESPONSE",e[e.USER_GROUPS_REQUEST=203]="USER_GROUPS_REQUEST",e[e.USER_GROUPS_RESPONSE=204]="USER_GROUPS_RESPONSE",e[e.USER_GROUPS_FOR_USERS_REQUEST=205]="USER_GROUPS_FOR_USERS_REQUEST",e[e.USER_GROUPS_FOR_USERS_RESPONSE=206]="USER_GROUPS_FOR_USERS_RESPONSE",e[e.ACTIVITY_PARTICIPANTS_REQUEST=300]="ACTIVITY_PARTICIPANTS_REQUEST",e[e.ACTIVITY_PARTICIPANTS_RESPONSE=301]="ACTIVITY_PARTICIPANTS_RESPONSE",e[e.ACTIVITY_JOIN_REQUEST=302]="ACTIVITY_JOIN_REQUEST",e[e.ACTIVITY_JOIN_RESPONSE=303]="ACTIVITY_JOIN_RESPONSE",e[e.ACTIVITY_LEAVE_REQUEST=304]="ACTIVITY_LEAVE_REQUEST",e[e.ACTIVITY_LEAVE_RESPONSE=305]="ACTIVITY_LEAVE_RESPONSE",e[e.ACTIVITY_SESSION_JOINED=306]="ACTIVITY_SESSION_JOINED",e[e.ACTIVITY_SESSION_LEFT=307]="ACTIVITY_SESSION_LEFT",e[e.ACTIVITY_LOCAL_STATE_SET=308]="ACTIVITY_LOCAL_STATE_SET",e[e.ACTIVITY_LOCAL_STATE_REMOVED=309]="ACTIVITY_LOCAL_STATE_REMOVED",e[e.ACTIVITY_LOCAL_STATE_CLEARED=310]="ACTIVITY_LOCAL_STATE_CLEARED",e[e.ACTIVITY_REMOTE_STATE_SET=311]="ACTIVITY_REMOTE_STATE_SET",e[e.ACTIVITY_REMOTE_STATE_REMOVED=312]="ACTIVITY_REMOTE_STATE_REMOVED",e[e.ACTIVITY_REMOTE_STATE_CLEARED=313]="ACTIVITY_REMOTE_STATE_CLEARED",e[e.PRESENCE_SET_STATE=400]="PRESENCE_SET_STATE",e[e.PRESENCE_REMOVE_STATE=401]="PRESENCE_REMOVE_STATE",e[e.PRESENCE_CLEAR_STATE=402]="PRESENCE_CLEAR_STATE",e[e.PRESENCE_STATE_SET=403]="PRESENCE_STATE_SET",e[e.PRESENCE_STATE_CLEARED=404]="PRESENCE_STATE_CLEARED",e[e.PRESENCE_STATE_REMOVED=405]="PRESENCE_STATE_REMOVED",e[e.PRESENCE_AVAILABILITY_CHANGED=406]="PRESENCE_AVAILABILITY_CHANGED",e[e.PRESENCE_REQUEST=407]="PRESENCE_REQUEST",e[e.PRESENCE_RESPONSE=408]="PRESENCE_RESPONSE",e[e.PRESENCE_SUBSCRIBE_REQUEST=409]="PRESENCE_SUBSCRIBE_REQUEST",e[e.PRESENCE_SUBSCRIBE_RESPONSE=410]="PRESENCE_SUBSCRIBE_RESPONSE",e[e.PRESENCE_UNSUBSCRIBE=411]="PRESENCE_UNSUBSCRIBE",e[e.CREATE_CHAT_CHANNEL_REQUEST=500]="CREATE_CHAT_CHANNEL_REQUEST",e[e.CREATE_CHAT_CHANNEL_RESPONSE=501]="CREATE_CHAT_CHANNEL_RESPONSE",e[e.REMOVE_CHAT_CHANNEL_REQUEST=502]="REMOVE_CHAT_CHANNEL_REQUEST",e[e.REMOVE_CHAT_CHANNEL_RESPONSE=503]="REMOVE_CHAT_CHANNEL_RESPONSE",e[e.CHAT_CHANNEL_REMOVED=504]="CHAT_CHANNEL_REMOVED",e[e.GET_CHAT_CHANNELS_REQUEST=505]="GET_CHAT_CHANNELS_REQUEST",e[e.GET_CHAT_CHANNELS_RESPONSE=506]="GET_CHAT_CHANNELS_RESPONSE",e[e.CHAT_CHANNEL_EXISTS_REQUEST=507]="CHAT_CHANNEL_EXISTS_REQUEST",e[e.CHAT_CHANNEL_EXISTS_RESPONSE=508]="CHAT_CHANNEL_EXISTS_RESPONSE",e[e.GET_DIRECT_CHAT_CHANNELS_REQUEST=509]="GET_DIRECT_CHAT_CHANNELS_REQUEST",e[e.GET_DIRECT_CHAT_CHANNELS_RESPONSE=510]="GET_DIRECT_CHAT_CHANNELS_RESPONSE",e[e.GET_JOINED_CHAT_CHANNELS_REQUEST=511]="GET_JOINED_CHAT_CHANNELS_REQUEST",e[e.GET_JOINED_CHAT_CHANNELS_RESPONSE=512]="GET_JOINED_CHAT_CHANNELS_RESPONSE",e[e.SEARCH_CHAT_CHANNELS_REQUEST=513]="SEARCH_CHAT_CHANNELS_REQUEST",e[e.SEARCH_CHAT_CHANNELS_RESPONSE=514]="SEARCH_CHAT_CHANNELS_RESPONSE",e[e.JOIN_CHAT_CHANNEL_REQUEST=515]="JOIN_CHAT_CHANNEL_REQUEST",e[e.JOIN_CHAT_CHANNEL_RESPONSE=516]="JOIN_CHAT_CHANNEL_RESPONSE",e[e.USER_JOINED_CHAT_CHANNEL=517]="USER_JOINED_CHAT_CHANNEL",e[e.LEAVE_CHAT_CHANNEL_REQUEST=518]="LEAVE_CHAT_CHANNEL_REQUEST",e[e.LEAVE_CHAT_CHANNEL_RESPONSE=519]="LEAVE_CHAT_CHANNEL_RESPONSE",e[e.USER_LEFT_CHAT_CHANNEL=520]="USER_LEFT_CHAT_CHANNEL",e[e.ADD_USER_TO_CHAT_CHANNEL_REQUEST=521]="ADD_USER_TO_CHAT_CHANNEL_REQUEST",e[e.ADD_USER_TO_CHAT_CHANNEL_RESPONSE=522]="ADD_USER_TO_CHAT_CHANNEL_RESPONSE",e[e.USER_ADDED_TO_CHAT_CHANNEL=523]="USER_ADDED_TO_CHAT_CHANNEL",
e[e.REMOVE_USER_FROM_CHAT_CHANNEL_REQUEST=524]="REMOVE_USER_FROM_CHAT_CHANNEL_REQUEST",e[e.REMOVE_USER_FROM_CHAT_CHANNEL_RESPONSE=525]="REMOVE_USER_FROM_CHAT_CHANNEL_RESPONSE",e[e.USER_REMOVED_FROM_CHAT_CHANNEL=526]="USER_REMOVED_FROM_CHAT_CHANNEL",e[e.SET_CHAT_CHANNEL_NAME_REQUEST=527]="SET_CHAT_CHANNEL_NAME_REQUEST",e[e.SET_CHAT_CHANNEL_NAME_RESPONSE=528]="SET_CHAT_CHANNEL_NAME_RESPONSE",e[e.CHAT_CHANNEL_NAME_CHANGED=529]="CHAT_CHANNEL_NAME_CHANGED",e[e.SET_CHAT_CHANNEL_TOPIC_REQUEST=530]="SET_CHAT_CHANNEL_TOPIC_REQUEST",e[e.SET_CHAT_CHANNEL_TOPIC_RESPONSE=531]="SET_CHAT_CHANNEL_TOPIC_RESPONSE",e[e.CHAT_CHANNEL_TOPIC_CHANGED=532]="CHAT_CHANNEL_TOPIC_CHANGED",e[e.MARK_CHAT_CHANNEL_EVENTS_SEEN_REQUEST=533]="MARK_CHAT_CHANNEL_EVENTS_SEEN_REQUEST",e[e.MARK_CHAT_CHANNEL_EVENTS_SEEN_RESPONSE=534]="MARK_CHAT_CHANNEL_EVENTS_SEEN_RESPONSE",e[e.CHAT_CHANNEL_EVENTS_MARKED_SEEN=535]="CHAT_CHANNEL_EVENTS_MARKED_SEEN",e[e.PUBLISH_CHAT_MESSAGE_REQUEST=536]="PUBLISH_CHAT_MESSAGE_REQUEST",e[e.PUBLISH_CHAT_MESSAGE_RESPONSE=537]="PUBLISH_CHAT_MESSAGE_RESPONSE",e[e.REMOTE_CHAT_MESSAGE=538]="REMOTE_CHAT_MESSAGE",e[e.GET_CHAT_CHANNEL_HISTORY_REQUEST=539]="GET_CHAT_CHANNEL_HISTORY_REQUEST",e[e.GET_CHAT_CHANNEL_HISTORY_RESPONSE=540]="GET_CHAT_CHANNEL_HISTORY_RESPONSE",e[e.GET_CLIENT_PERMISSIONS_REQUEST=601]="GET_CLIENT_PERMISSIONS_REQUEST",e[e.GET_CLIENT_PERMISSIONS_RESPONSE=602]="GET_CLIENT_PERMISSIONS_RESPONSE",e[e.ADD_PERMISSIONS_REQUEST=603]="ADD_PERMISSIONS_REQUEST",e[e.ADD_PERMISSIONS_RESPONSE=604]="ADD_PERMISSIONS_RESPONSE",e[e.REMOVE_PERMISSIONS_REQUEST=605]="REMOVE_PERMISSIONS_REQUEST",e[e.REMOVE_PERMISSIONS_RESPONSE=606]="REMOVE_PERMISSIONS_RESPONSE",e[e.SET_PERMISSIONS_REQUEST=607]="SET_PERMISSIONS_REQUEST",e[e.SET_PERMISSIONS_RESPONSE=608]="SET_PERMISSIONS_RESPONSE",e[e.GET_WORLD_PERMISSIONS_REQUEST=609]="GET_WORLD_PERMISSIONS_REQUEST",e[e.GET_WORLD_PERMISSIONS_RESPONSE=610]="GET_WORLD_PERMISSIONS_RESPONSE",e[e.GET_ALL_USER_PERMISSIONS_REQUEST=611]="GET_ALL_USER_PERMISSIONS_REQUEST",e[e.GET_ALL_USER_PERMISSIONS_RESPONSE=612]="GET_ALL_USER_PERMISSIONS_RESPONSE",e[e.GET_USER_PERMISSIONS_REQUEST=613]="GET_USER_PERMISSIONS_REQUEST",e[e.GET_USER_PERMISSIONS_RESPONSE=614]="GET_USER_PERMISSIONS_RESPONSE",e[e.GET_ALL_GROUP_PERMISSIONS_REQUEST=615]="GET_ALL_GROUP_PERMISSIONS_REQUEST",e[e.GET_ALL_GROUP_PERMISSIONS_RESPONSE=616]="GET_ALL_GROUP_PERMISSIONS_RESPONSE",e[e.GET_GROUP_PERMISSIONS_REQUEST=617]="GET_GROUP_PERMISSIONS_REQUEST",e[e.GET_GROUP_PERMISSIONS_RESPONSE=618]="GET_GROUP_PERMISSIONS_RESPONSE"}(je||(je={}));var ke=function(e){return{r:e.reconnect,k:e.reconnectToken}},Ye=function(e){return{success:e.s,reconnectToken:e.k,protocolConfig:e.c,error:e.e,retryOk:e.r}},Qe=function(e){return{u:e.username,p:e.password}},Fe=function(e){return{k:e.token}},Je=function(e){return{d:e.displayName}},qe=function(e){return{success:e.s,username:e.n,sessionId:e.e,state:e.p}},We=function(e){return{c:e.code,m:e.message,d:e.details}},Ke=function(e){return{code:e.c,message:e.m,details:e.d}},Xe=function(){function e(e){void 0===e&&(e={});var t=this;this.N={},this.O={},Object.getOwnPropertyNames(e).forEach(function(n){t.N[n]=e[n],t.O[t.N[n]]=n})}return e.prototype.put=function(e,t){this.N[t]=e,this.O[e]=t},e.prototype.code=function(e){return this.N[e]},e.prototype.value=function(e){return this.O[e]},e}(),$e=function(){function e(){}return e.deepEquals=function(e,t){var n;if(isNaN(e)&&isNaN(t)&&"number"==typeof e&&"number"==typeof t)return!0;if(e===t)return!0;if("function"==typeof e&&"function"==typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1}for(n in e){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(!this.deepEquals(e[n],t[n]))return!1;break;default:if(e[n]!==t[n])return!1}}return!0},e}(),Ze=function(){function e(){this.P=new t.Subject,this.Q=this.P.asObservable().share(),this.R={}}return e.F=function(e){if("string"==typeof e)return e.toLowerCase();throw new Error("Event names must be strings")},e.prototype.addListener=function(t,n){if("function"!=typeof n)throw new TypeError("Listeners must be functions");t=e.F(t);var r=this.R[t];if(void 0===r)r=[],this.R[t]=r;else if(void 0!==r.find(function(e){return e.listener===n}))return this;var i=this.Q.filter(function(e){return e.name.toLowerCase()===t}).subscribe(function(e){return n(e)});return r.push({listener:n,subscription:i}),this},e.prototype.on=function(e,t){return this.addListener(e,t)},e.prototype.once=function(e,t){var n=this,r=function(i){n.removeListener(e,r),t(i)};return this.addListener(e,r)},e.prototype.removeAllListenersForAllEvents=function(){var e=this;return Object.keys(this.R).forEach(function(t){return e.removeAllListeners(t)}),this},e.prototype.removeAllListeners=function(t){t=e.F(t);var n=this.R[t];return n.forEach(function(e){return e.subscription.unsubscribe()}),delete this.R[t],this},e.prototype.removeListener=function(t,n){t=e.F(t);var r=this.R[t];if(void 0!==r){var i=r.findIndex(function(e){return e.listener===n});if(i!==-1){var o=r[i];r.splice(i,1),o.subscription.unsubscribe()}}return this},e.prototype.off=function(e,t){return this.removeListener(e,t)},e.prototype.events=function(){return this.Q},e.prototype.S=function(e){var t=this;return e.subscribe(function(e){t.P.next(e)},function(e){t.P.error(e)})},e.prototype.T=function(e){this.P.next(e)},e}(),et=function(){function e(t,n,r,i){this.src=t,this.oldValues=n,this.addedValues=r,this.removedValues=i,this.name=e.NAME,n.length>0&&(this.oldValue=n[0]),Object.freeze(this)}return e}();et.NAME="set";var tt=function(){function e(t,n){this.src=t,this.oldValues=n,this.name=e.NAME,n.length>0&&(this.oldValue=n[0]),Object.freeze(this)}return e}();tt.NAME="cleared";var nt=function(){function e(t){this.src=t,this.name=e.NAME,Object.freeze(this)}return e}();nt.NAME="disposed";var rt=function(e){function t(t,n,r,i,o,s,a){var u=e.call(this)||this;return u.U=t,u.V=!1,u.W=[],u.X=n,u.Y=r,u.Z=i,u.$=o,u._=s,u.aa=a,u}return r(t,e),t.prototype.type=function(){return this.X},t.prototype.key=function(){return this.Y},t.prototype.source=function(){return this.Z},t.prototype.isLocal=function(){return this.aa},t.prototype.username=function(){return this.$},t.prototype.sessionId=function(){return this._},t.prototype.isDisposed=function(){return this.V},t.prototype.ba=function(){this.V=!0;var e=new nt(this);this.T(e),this.removeAllListenersForAllEvents(),this.U.ca(this)},t.prototype.value=function(){return this.W[0]},t.prototype.values=function(){return this.W},t.prototype.isSet=function(){return this.W.length>0},t.prototype.da=function(e){var t=this,n=this.W;this.W=e;var r=this.W.filter(function(e){return!n.includes(e)}),i=n.filter(function(e){return!t.W.includes(e)}),o=new et(this,n,r,i);this.T(o)},t.prototype.ea=function(){var e=this.W;this.W=[];var t=new tt(this,e);this.T(t)},t.prototype.fa=function(e){$e.deepEquals(this.W,e)||this.da(e)},t}(Ze);rt.Events={SET:et.NAME,CLEARED:tt.NAME,DISPOSED:nt.NAME},rt.Types={INDEX:"index",RANGE:"range",PROPERTY:"property",ELEMENT:"element"},Object.freeze(rt.Events),Object.freeze(rt.Types);var it=function(){function e(){}return e.serialize=function(e){return e.username+":"+e.sessionId},e.parseUsername=function(t){return e.deserialize(t).username},e.deserialize=function(e){var t=e.lastIndexOf(":");return{username:e.substring(0,t),sessionId:e.substring(t+1,e.length)}},e}(),ot=new Xe;ot.put(0,rt.Types.INDEX),ot.put(1,rt.Types.RANGE),ot.put(2,rt.Types.PROPERTY),ot.put(3,rt.Types.ELEMENT);var st=function(e){var t=ot.value(e.c),n=i(e.v,t),r={resourceId:e.r,sessionId:e.s,username:it.parseUsername(e.s),key:e.k,id:e.d,referenceType:t,values:n};return r},at=function(e){var t=ot.value(e.c),n=i(e.v,t),r={resourceId:e.r,sessionId:e.s,username:it.parseUsername(e.s),key:e.k,id:e.d,referenceType:t,values:n};return r},ut=function(e){var t={sessionId:e.s,username:it.parseUsername(e.s),resourceId:e.r,key:e.k,id:e.d};return t},ct=ut,Et=ut,ht=function(e){return{r:e.resourceId,d:e.id,k:e.key,c:ot.code(e.referenceType),v:o(e.values,e.referenceType),s:e.version}},ft=function(e){return{r:e.resourceId,d:e.id,k:e.key}},pt=function(e){return{r:e.resourceId,d:e.id,k:e.key,c:ot.code(e.referenceType),v:o(e.values,e.referenceType),s:e.version}},dt=function(e){return{r:e.resourceId,d:e.id,k:e.key}},lt={OBJECT:"object",ARRAY:"array",STRING:"string",NUMBER:"number",BOOLEAN:"boolean",NULL:"null",DATE:"date"};Object.freeze(lt);var vt=lt,St=new Xe;St.put(0,vt.OBJECT),St.put(1,vt.ARRAY),St.put(2,vt.STRING),St.put(3,vt.NUMBER),St.put(4,vt.BOOLEAN),St.put(5,vt.NULL),St.put(6,vt.DATE);var _t=function(e){var t={i:e.id,"?":""+St.code(e.type)};switch(e.type){case vt.OBJECT:var n=e,r={};Object.getOwnPropertyNames(n.children).forEach(function(e){r[e]=_t(n.children[e])}),t.c=r;break;case vt.ARRAY:t.c=e.children.map(function(e){return _t(e)});break;case vt.STRING:t.v=e.value;break;case vt.NUMBER:t.v=e.value;break;case vt.BOOLEAN:t.v=e.value;break;case vt.DATE:t.v=e.value.getTime();break;case vt.NULL:break;default:throw new Error("Unknown data value type: "+e.type)}return t},Rt=function(e){var t=e.i,n=St.value(Number(e["?"]));switch(n){case vt.OBJECT:var r={};return Object.getOwnPropertyNames(e.c).forEach(function(t){r[t]=Rt(e.c[t])}),{id:t,type:n,children:r};case vt.ARRAY:var i=e.c.map(function(e){return Rt(e)});return{id:t,type:n,children:i};case vt.DATE:return{id:t,type:n,value:new Date(e.v)};case vt.STRING:case vt.NUMBER:case vt.BOOLEAN:return{id:t,type:n,value:e.v};case vt.NULL:return{id:t,type:n};default:throw new Error("Unknown data value type: "+e.type)}},yt=function(){function e(e,t,n,r){this.read=e,this.write=t,this.remove=n,this.manage=r,Object.freeze(this)}return e}(),Tt=function(e){return{m:e.id,a:e.autoCreateId}},Ot=function(e){return{resourceId:e.r,id:e.mi,collection:e.ci,valueIdPrefix:e.p,version:e.v,createdTime:e.c,modifiedTime:e.m,data:Rt(e.d.d),connectedClients:e.d.s,references:u(e.d.r),permissions:s(e.a)}},At=function(){function e(){}return e.make=function(t){"object"==typeof t&&(Object.freeze(t),Object.keys(t).forEach(function(t,n,r){e.make(t)}))},e.copy=function(e,t){var n={};return Object.keys(e).forEach(function(r,i,o){void 0!==t[r]?n[r]=t[r]:n[r]=e[r]}),Object.freeze(n),n},e.update=function(e,t){return void 0!==t?t:e},e}(),Nt=function(){function e(e){this.type=e}return e}(),It=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.id=n,i.noOp=r,i}return r(t,e),t}(Nt),mt={COMPOUND:"compound",ARRAY_INSERT:"ArrayInsert",ARRAY_REORDER:"ArrayReorder",ARRAY_REMOVE:"ArrayRemove",ARRAY_SET:"ArraySet",ARRAY_VALUE:"ArrayValue",BOOLEAN_VALUE:"BooleanValue",NUMBER_ADD:"NumberAdd",NUMBER_VALUE:"NumberValue",OBJECT_ADD:"ObjectAdd",OBJECT_REMOVE:"ObjectRemove",OBJECT_SET:"ObjectSet",OBJECT_VALUE:"ObjectValue",STRING_INSERT:"StringInsert",STRING_REMOVE:"StringRemove",STRING_VALUE:"StringValue",DATE_VALUE:"DateValue"};Object.freeze(mt);var Ct=mt,gt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_INSERT,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.index,e.index),At.update(this.value,e.value))},t}(It),wt=function(e){function t(t){var n=e.call(this,Ct.COMPOUND)||this;return n.ops=t,Object.freeze(n),n}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.ops,e.ops))},t}(Nt),bt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_REORDER,t,n)||this;return o.fromIndex=r,o.toIndex=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.fromIndex,e.fromIndex),At.update(this.toIndex,e.toIndex))},t}(It),Mt=function(e){function t(t,n,r){var i=e.call(this,Ct.ARRAY_REMOVE,t,n)||this;return i.index=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.index,e.index))},t}(It),Dt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_SET,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.index,e.index),At.update(this.value,e.value))},t}(It),Lt=function(e){function t(t,n,r){var i=e.call(this,Ct.ARRAY_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Pt=function(e){function t(t,n,r){var i=e.call(this,Ct.BOOLEAN_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Ut=function(e){function t(t,n,r){var i=e.call(this,Ct.NUMBER_ADD,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),xt=function(e){function t(t,n,r){var i=e.call(this,Ct.NUMBER_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Ht=function(e){function t(t,n,r,i){var o=e.call(this,Ct.OBJECT_ADD,t,n)||this;return o.prop=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.prop,e.prop),At.update(this.value,e.value))},t}(It),Bt=function(e){function t(t,n,r){var i=e.call(this,Ct.OBJECT_REMOVE,t,n)||this;return i.prop=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.prop,e.prop))},t}(It),zt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.OBJECT_SET,t,n)||this;return o.prop=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.prop,e.prop),At.update(this.value,e.value))},t}(It),Vt=function(e){function t(t,n,r){var i=e.call(this,Ct.OBJECT_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Gt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.STRING_INSERT,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.index,e.index),At.update(this.value,e.value))},t}(It),jt=function(e){function t(t,n,r,i){var o=e.call(this,Ct.STRING_REMOVE,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.index,e.index),At.update(this.value,e.value))},t}(It),kt=function(e){function t(t,n,r){var i=e.call(this,Ct.STRING_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Yt=function(e){function t(t,n,r){var i=e.call(this,Ct.DATE_VALUE,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.copy=function(e){return new t(At.update(this.id,e.id),At.update(this.noOp,e.noOp),At.update(this.value,e.value))},t}(It),Qt=new Xe;Qt.put(0,Ct.COMPOUND),Qt.put(1,Ct.ARRAY_INSERT),Qt.put(2,Ct.ARRAY_REORDER),Qt.put(3,Ct.ARRAY_REMOVE),Qt.put(4,Ct.ARRAY_SET),Qt.put(5,Ct.ARRAY_VALUE),Qt.put(6,Ct.BOOLEAN_VALUE),Qt.put(7,Ct.NUMBER_ADD),Qt.put(8,Ct.NUMBER_VALUE),Qt.put(9,Ct.OBJECT_ADD),Qt.put(10,Ct.OBJECT_REMOVE),Qt.put(11,Ct.OBJECT_SET),Qt.put(12,Ct.OBJECT_VALUE),Qt.put(13,Ct.STRING_INSERT),Qt.put(14,Ct.STRING_REMOVE),Qt.put(15,Ct.STRING_VALUE),Qt.put(16,Ct.DATE_VALUE);var Ft=function(){function e(){}return e.serialize=function(e){return e instanceof wt?Kt.serialize(e):e instanceof It?qt.serialize(e):void 0},e}(),Jt=function(){function e(){}return e.deserialize=function(e){switch(Qt.value(e.t)){case Ct.COMPOUND:return Xt.deserialize(e);default:return Wt.deserialize(e)}},e}(),qt=function(){function e(){}return e.serialize=function(e){return e instanceof gt?$t.serialize(e):e instanceof bt?en.serialize(e):e instanceof Mt?nn.serialize(e):e instanceof Dt?on.serialize(e):e instanceof Lt?an.serialize(e):e instanceof Pt?cn.serialize(e):e instanceof Ut?hn.serialize(e):e instanceof xt?pn.serialize(e):e instanceof Ht?ln.serialize(e):e instanceof Bt?Sn.serialize(e):e instanceof zt?Rn.serialize(e):e instanceof Vt?Tn.serialize(e):e instanceof Gt?An.serialize(e):e instanceof jt?In.serialize(e):e instanceof kt?Cn.serialize(e):e instanceof Yt?wn.serialize(e):void 0},e}(),Wt=function(){function e(){}return e.deserialize=function(e){switch(Qt.value(e.t)){case Ct.ARRAY_INSERT:return Zt.deserialize(e);case Ct.ARRAY_REORDER:return tn.deserialize(e);case Ct.ARRAY_REMOVE:return rn.deserialize(e);case Ct.ARRAY_SET:return sn.deserialize(e);case Ct.ARRAY_VALUE:return un.deserialize(e);case Ct.BOOLEAN_VALUE:return En.deserialize(e);case Ct.NUMBER_ADD:return fn.deserialize(e);case Ct.NUMBER_VALUE:return dn.deserialize(e);case Ct.OBJECT_ADD:return vn.deserialize(e);case Ct.OBJECT_REMOVE:return _n.deserialize(e);case Ct.OBJECT_SET:return yn.deserialize(e);case Ct.OBJECT_VALUE:return On.deserialize(e);case Ct.STRING_INSERT:return Nn.deserialize(e);case Ct.STRING_REMOVE:return mn.deserialize(e);case Ct.STRING_VALUE:return gn.deserialize(e);case Ct.DATE_VALUE:return bn.deserialize(e);default:throw new Error("Can't deserialize unknown operation type: "+e.t)}},e}(),Kt=function(){function e(){}return e.serialize=function(e){for(var t,n=[],r=0,i=e.ops;r<i.length;r++)t=i[r],n.push(qt.serialize(t));return{t:Qt.code(Ct.COMPOUND),o:n}},e}(),Xt=function(){function e(){}return e.deserialize=function(e){for(var t,n=[],r=0,i=e.o;r<i.length;r++)t=i[r],n.push(Wt.deserialize(t));return new wt(n)},e}(),$t=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.ARRAY_INSERT),d:e.id,n:e.noOp,i:e.index,v:_t(e.value)}},e}(),Zt=function(){function e(){}return e.deserialize=function(e){return new gt(e.d,e.n,e.i,Rt(e.v))},e}(),en=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.ARRAY_REORDER),d:e.id,n:e.noOp,f:e.fromIndex,o:e.toIndex}},e}(),tn=function(){function e(){}return e.deserialize=function(e){return new bt(e.d,e.n,e.f,e.o)},e}(),nn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.ARRAY_REMOVE),d:e.id,n:e.noOp,i:e.index}},e}(),rn=function(){function e(){}return e.deserialize=function(e){return new Mt(e.d,e.n,e.i)},e}(),on=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.ARRAY_SET),d:e.id,n:e.noOp,i:e.index,v:_t(e.value)}},e}(),sn=function(){function e(){}return e.deserialize=function(e){return new Dt(e.d,e.n,e.i,Rt(e.v))},e}(),an=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.ARRAY_VALUE),d:e.id,n:e.noOp,v:e.value.map(function(e){return _t(e)})}},e}(),un=function(){function e(){}return e.deserialize=function(e){return new Lt(e.d,e.n,e.v.map(function(e){return Rt(e)}))},e}(),cn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.BOOLEAN_VALUE),d:e.id,n:e.noOp,v:e.value}},e}(),En=function(){function e(){}return e.deserialize=function(e){return new Pt(e.d,e.n,e.v)},e}(),hn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.NUMBER_ADD),d:e.id,n:e.noOp,v:e.value}},e}(),fn=function(){function e(){}return e.deserialize=function(e){return new Ut(e.d,e.n,e.v)},e}(),pn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.NUMBER_VALUE),d:e.id,n:e.noOp,v:e.value}},e}(),dn=function(){function e(){}return e.deserialize=function(e){return new xt(e.d,e.n,e.v)},e}(),ln=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.OBJECT_ADD),d:e.id,n:e.noOp,p:e.prop,v:_t(e.value)}},e}(),vn=function(){function e(){}return e.deserialize=function(e){return new Ht(e.d,e.n,e.p,Rt(e.v))},e}(),Sn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.OBJECT_REMOVE),d:e.id,n:e.noOp,p:e.prop}},e}(),_n=function(){function e(){}return e.deserialize=function(e){return new Bt(e.d,e.n,e.p)},e}(),Rn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.OBJECT_SET),d:e.id,n:e.noOp,p:e.prop,v:_t(e.value)}},e}(),yn=function(){function e(){}return e.deserialize=function(e){return new zt(e.d,e.n,e.p,Rt(e.v))},e}(),Tn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.OBJECT_VALUE),d:e.id,n:e.noOp,v:f(e.value,function(e){return _t(e)})}},e}(),On=function(){function e(){}return e.deserialize=function(e){return new Vt(e.d,e.n,f(e.v,function(e){return Rt(e)}))},e}(),An=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.STRING_INSERT),d:e.id,n:e.noOp,i:e.index,v:e.value}},e}(),Nn=function(){function e(){}return e.deserialize=function(e){return new Gt(e.d,e.n,e.i,e.v)},e}(),In=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.STRING_REMOVE),d:e.id,n:e.noOp,i:e.index,v:e.value}},e}(),mn=function(){function e(){}return e.deserialize=function(e){return new jt(e.d,e.n,e.i,e.v)},e}(),Cn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.STRING_VALUE),d:e.id,n:e.noOp,v:e.value}},e}(),gn=function(){function e(){}return e.deserialize=function(e){return new kt(e.d,e.n,e.v)},e}(),wn=function(){function e(){}return e.serialize=function(e){return{t:Qt.code(Ct.DATE_VALUE),d:e.id,n:e.noOp,v:e.value.getTime()}},e}(),bn=function(){function e(){}return e.deserialize=function(e){return new Yt(e.d,e.n,new Date(e.v))},e}(),Mn=function(e){return{r:e.resourceId,s:e.seqNo,v:e.version,o:Ft.serialize(e.operation)}},Dn=function(e){return{resourceId:e.r,seqNo:e.s,version:e.v,timestamp:e.p}},Ln=function(e){return{resourceId:e.r,sessionId:e.s,version:e.v,timestamp:e.p,operation:Jt.deserialize(e.o)}},Pn=function(e){return{resourceId:e.r,reason:e.s}},Un=function(e){return{m:e.modelId}},xn=function(e){var t,n=e.data?_t(e.data):void 0,r=a(e.worldPermissions),i=e.overrideWorld;return e.userPermissions&&(t={},Object.keys(e.userPermissions).forEach(function(n){t[n]=a(e.userPermissions[n])})),{c:e.collectionId,m:e.modelId,d:n,v:i,w:r,u:t}},Hn=function(e){return{collectionId:e.c,modelId:e.m}},Bn=function(e){return{r:e.resourceId}},zn=function(){function e(e,t,n,r,i,o){this.userType=e,this.username=t,this.firstName=n,this.lastName=r,this.displayName=i,this.email=o,this.anonymous="anonymous"===e,this.admin="admin"===e,Object.freeze(this)}return e}(),Vn=function(e){return new zn(e.t,e.n,e.f,e.l,e.d,e.e)},Gn={username:1,firstName:2,lastName:3,displayName:4,email:5},jn=function(e){return{f:Gn[e.field],v:e.values}},kn=function(e){var t;return void 0!==e.ascending&&(t=e.ascending?0:1),{f:e.fields.map(function(e){return Gn[e]}),v:e.value,o:e.offset,l:e.limit,r:Gn[e.orderBy],s:t}},Yn=function(e){var t=e.u.map(function(e){return Vn(e)});return{users:t}},Qn=function(e){return{resourceId:e.r,username:e.u,sessionId:e.s}},Fn=function(e){return{resourceId:e.r,username:e.u,sessionId:e.s}},Jn=function(){function e(){}return e.objectToMap=function(e){var t=new Map;return Object.keys(e).forEach(function(n){return t.set(n,e[n])}),t},e.mapToObject=function(e){var t={};return e.forEach(function(e,n){return t[n]=e}),t},e.toStringMap=function(t){return t?t instanceof Map?t:e.objectToMap(t):t},e}(),qn=function(e){return{i:e.activityId,s:Jn.mapToObject(e.state)}},Wn=function(e){var t=e.s,n={participants:t};return n},Kn=function(e){return{i:e.activityId}},Xn=function(e){return{i:e.activityId,v:e.state}},$n=function(e){return{i:e.activityId,k:e.keys}},Zn=function(e){return{i:e.activityId}},er=function(e){var t={activityId:e.i,sessionId:e.s,state:e.v};return t},tr=function(e){var t={activityId:e.i,sessionId:e.s,keys:e.k};return t},nr=function(e){var t={activityId:e.i,sessionId:e.s};return t},rr=function(e){for(var t=new Map,n=0,r=Object.keys(e.v);n<r.length;n++){var i=r[n];t.set(i,e.v[i])}var o={activityId:e.i,sessionId:e.s,state:t};return o},ir=function(e){var t={activityId:e.i,sessionId:e.s};return t},or=function(e){var t={username:e.u,available:e.a};return t},sr=function(e){return{s:e.state,a:e.all}},ar=function(e){return{k:e.keys}},ur=function(e){var t={username:e.u,state:e.s};return t},cr=function(e){var t={username:e.u,keys:e.k};return t},Er=function(e){var t={username:e.u};return t},hr=function(e){return{u:e.username}},fr=function(e){return{u:e.usernames}},pr=function(e){var t={userPresences:e.p};return t},dr=function(e){return{u:e.usernames}},lr=function(e){var t={userPresences:e.p};return t},vr=function(e){return{i:e.activityId}},Sr=function(e){var t={participants:e.s};return t},_r=function(){function e(e,t,n,r,i,o){this.data=e,this.collectionId=t,this.modelId=n,this.created=r,this.modified=i,this.version=o,Object.freeze(this)}return e}(),Rr=function(e){var t={q:e.query};return t},yr=function(e){return new _r(e.a,e.l,e.m,new Date(e.c),new Date(e.d),e.v)},Tr=function(e){for(var t=[],n=0,r=e.r;n<r.length;n++){var i=r[n];t.push(yr(i))}return{result:t}},Or=function(){function e(e){this.type=e}return e}(),Ar=function(e){function t(t){var n=e.call(this,Ct.COMPOUND)||this;return n.ops=t,Object.freeze(n),n}return r(t,e),t.prototype.inverse=function(){return new t(this.ops.map(function(e){return e.inverse()}))},t}(Or),Nr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.id=n,i.noOp=r,i}return r(t,e),t}(Or),Ir=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_REMOVE,t,n)||this;return o.index=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new mr(this.id,this.noOp,this.index,this.oldValue)},t}(Nr),mr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_INSERT,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new Ir(this.id,this.noOp,this.index,this.value)},t}(Nr),Cr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_REORDER,t,n)||this;return o.fromIndex=r,o.toIndex=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.toIndex,this.fromIndex)},t}(Nr),gr=function(e){function t(t,n,r,i,o){var s=e.call(this,Ct.ARRAY_SET,t,n)||this;return s.index=r,s.value=i,s.oldValue=o,Object.freeze(s),s}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.index,this.oldValue,this.value)},t}(Nr),wr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.ARRAY_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),br=function(e){function t(t,n,r,i){var o=e.call(this,Ct.BOOLEAN_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),Mr=function(e){function t(t,n,r){var i=e.call(this,Ct.NUMBER_ADD,t,n)||this;return i.value=r,Object.freeze(i),i}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,(-this.value))},t}(Nr),Dr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.NUMBER_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),Lr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.OBJECT_REMOVE,t,n)||this;return o.prop=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new Pr(this.id,this.noOp,this.prop,this.oldValue)},t}(Nr),Pr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.OBJECT_ADD,t,n)||this;return o.prop=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new Lr(this.id,this.noOp,this.prop,this.value)},t}(Nr),Ur=function(e){function t(t,n,r,i,o){var s=e.call(this,Ct.OBJECT_SET,t,n)||this;return s.prop=r,s.value=i,s.oldValue=o,Object.freeze(s),s}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.prop,this.oldValue,this.value)},t}(Nr),xr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.OBJECT_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),Hr=function(e){function t(t,n,r,i,o){var s=e.call(this,Ct.STRING_REMOVE,t,n)||this;return s.index=r,s.length=i,s.value=o,Object.freeze(s),s}return r(t,e),t.prototype.inverse=function(){return new Br(this.id,this.noOp,this.index,this.value)},t}(Nr),Br=function(e){function t(t,n,r,i){var o=e.call(this,Ct.STRING_INSERT,t,n)||this;return o.index=r,o.value=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new Hr(this.id,this.noOp,this.index,this.value.length,this.value)},t}(Nr),zr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.STRING_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),Vr=function(){function e(e,t,n,r,i,o){this.modelId=e,this.version=t,this.timestamp=n,this.username=r,this.sessionId=i,this.operation=o,Object.freeze(this)}return e}(),Gr=function(e){function t(t,n,r,i){var o=e.call(this,Ct.DATE_VALUE,t,n)||this;return o.value=r,o.oldValue=i,Object.freeze(o),o}return r(t,e),t.prototype.inverse=function(){return new t(this.id,this.noOp,this.oldValue,this.value)},t}(Nr),jr=new Xe;jr.put(0,Ct.COMPOUND),jr.put(1,Ct.ARRAY_INSERT),jr.put(2,Ct.ARRAY_REORDER),jr.put(3,Ct.ARRAY_REMOVE),jr.put(4,Ct.ARRAY_SET),jr.put(5,Ct.ARRAY_VALUE),jr.put(6,Ct.BOOLEAN_VALUE),jr.put(7,Ct.NUMBER_ADD),jr.put(8,Ct.NUMBER_VALUE),jr.put(9,Ct.OBJECT_ADD),jr.put(10,Ct.OBJECT_REMOVE),jr.put(11,Ct.OBJECT_SET),jr.put(12,Ct.OBJECT_VALUE),jr.put(13,Ct.STRING_INSERT),jr.put(14,Ct.STRING_REMOVE),jr.put(15,Ct.STRING_VALUE);var kr=function(){function e(){}return e.deserialize=function(e){return new Vr(e.m,e.v,e.p,e.u,e.s,Yr.deserialize(e.o))},e}(),Yr=function(){function e(){}return e.deserialize=function(e){switch(jr.value(e.t)){case Ct.COMPOUND:return Qr.deserialize(e);case Ct.ARRAY_INSERT:return Fr.deserialize(e);case Ct.ARRAY_REORDER:return Jr.deserialize(e);case Ct.ARRAY_REMOVE:return qr.deserialize(e);case Ct.ARRAY_SET:return Wr.deserialize(e);case Ct.ARRAY_VALUE:return Kr.deserialize(e);case Ct.BOOLEAN_VALUE:return Xr.deserialize(e);case Ct.NUMBER_ADD:return $r.deserialize(e);case Ct.NUMBER_VALUE:return Zr.deserialize(e);case Ct.OBJECT_ADD:return ei.deserialize(e);case Ct.OBJECT_REMOVE:return ti.deserialize(e);case Ct.OBJECT_SET:return ni.deserialize(e);case Ct.OBJECT_VALUE:return ri.deserialize(e);case Ct.STRING_INSERT:return ii.deserialize(e);case Ct.STRING_REMOVE:return oi.deserialize(e);case Ct.STRING_VALUE:return si.deserialize(e);case Ct.DATE_VALUE:return ai.deserialize(e);default:throw new Error("Can't deserialize unknown operation type: "+e.t)}},e}(),Qr=function(){function e(){}return e.deserialize=function(e){for(var t,n=[],r=0,i=e.o;r<i.length;r++)t=i[r],n.push(Yr.deserialize(t));return new Ar(n)},e}(),Fr=function(){function e(){}return e.deserialize=function(e){return new mr(e.d,e.n,e.i,Rt(e.v))},e}(),Jr=function(){function e(){}
return e.deserialize=function(e){return new Cr(e.d,e.n,e.f,e.o)},e}(),qr=function(){function e(){}return e.deserialize=function(e){return new Ir(e.d,e.n,e.i,e.o?Rt(e.o):null)},e}(),Wr=function(){function e(){}return e.deserialize=function(e){return new gr(e.d,e.n,e.i,Rt(e.v),e.o?Rt(e.o):null)},e}(),Kr=function(){function e(){}return e.deserialize=function(e){return new wr(e.d,e.n,e.v.map(function(e){return Rt(e)}),e.o?e.o.map(function(e){return Rt(e)}):null)},e}(),Xr=function(){function e(){}return e.deserialize=function(e){return new br(e.d,e.n,e.v,e.o?e.o:null)},e}(),$r=function(){function e(){}return e.deserialize=function(e){return new Mr(e.d,e.n,e.v)},e}(),Zr=function(){function e(){}return e.deserialize=function(e){return new Dr(e.d,e.n,e.v,e.o?e.o:null)},e}(),ei=function(){function e(){}return e.deserialize=function(e){return new Pr(e.d,e.n,e.p,Rt(e.v))},e}(),ti=function(){function e(){}return e.deserialize=function(e){return new Lr(e.d,e.n,e.p,e.o?Rt(e.o):null)},e}(),ni=function(){function e(){}return e.deserialize=function(e){return new Ur(e.d,e.n,e.p,Rt(e.v),e.o?Rt(e.o):null)},e}(),ri=function(){function e(){}return e.deserialize=function(e){return new xr(e.d,e.n,f(e.v,function(e){return Rt(e)}),e.o?f(e.o,function(e){return Rt(e)}):null)},e}(),ii=function(){function e(){}return e.deserialize=function(e){return new Br(e.d,e.n,e.i,e.v)},e}(),oi=function(){function e(){}return e.deserialize=function(e){return new Hr(e.d,e.n,e.i,e.l,e.o)},e}(),si=function(){function e(){}return e.deserialize=function(e){return new zr(e.d,e.n,e.v,e.o?e.o:null)},e}(),ai=function(){function e(){}return e.deserialize=function(e){return new Gr(e.d,e.n,new Date(e.v),e.o?new Date(e.o):null)},e}(),ui=function(e){return{m:e.modelId,f:e.first,l:e.last}},ci=function(e){return{operations:e.o.map(function(e){return kr.deserialize(e)})}},Ei=function(e){return{m:e.modelId}},hi=function(e){var t=e.o,n=s(e.w),r=new Map;return e.u&&Object.keys(e.u).forEach(function(t){var n=s(e.u[t]);if(null===n)throw new Error("Invalid message, permissions for user "+t+" were null");r.set(t,n)}),{overridesCollection:t,world:n,users:r}},fi=function(e){return{resourceId:e.r,permissions:s(e.p)}},pi=function(e){var t;return e.users&&(t={},e.users.forEach(function(e,n){return t[n]=a(e)})),{m:e.modelId,s:e.overridesCollection,w:a(e.world),a:e.allUsers,u:t}},di=function(){function e(e,t,n,r){this.type=e,this.eventNumber=t,this.timestamp=n,this.username=r}return e}();di.TYPES={CREATED:"created",MESSAGE:"message",USER_JOINED:"user_joined",USER_LEFT:"user_left",USER_ADDED:"user_added",USER_REMOVED:"user_removed",NAME_CHANGED:"name_changed",TOPIC_CHANGED:"topic_changed"},Object.freeze(di.TYPES);var li=function(e){function t(n,r,i,o,s,a){var u=e.call(this,t.TYPE,n,r,i)||this;return u.name=o,u.topic=s,u.members=a,Object.freeze(u),u}return r(t,e),t}(di);li.TYPE="created";var vi=function(e){function t(n,r,i,o){var s=e.call(this,t.TYPE,n,r,i)||this;return s.message=o,Object.freeze(s),s}return r(t,e),t}(di);vi.TYPE="message";var Si=function(e){function t(n,r,i){var o=e.call(this,t.TYPE,n,r,i)||this;return Object.freeze(o),o}return r(t,e),t}(di);Si.TYPE="user_joined";var _i=function(e){function t(n,r,i){var o=e.call(this,t.TYPE,n,r,i)||this;return Object.freeze(o),o}return r(t,e),t}(di);_i.TYPE="user_left";var Ri=function(e){function t(n,r,i,o){var s=e.call(this,t.TYPE,n,r,i)||this;return s.addedBy=o,Object.freeze(s),s}return r(t,e),t}(di);Ri.TYPE="user_added";var yi=function(e){function t(n,r,i,o){var s=e.call(this,t.TYPE,n,r,i)||this;return s.removedBy=o,Object.freeze(s),s}return r(t,e),t}(di);yi.TYPE="user_removed";var Ti=function(e){function t(t,n,r,i){var o=e.call(this,yi.TYPE,t,n,r)||this;return o.channelName=i,Object.freeze(o),o}return r(t,e),t}(di);Ti.TYPE="name_changed";var Oi=function(e){function t(t,n,r,i){var o=e.call(this,yi.TYPE,t,n,r)||this;return o.channelTopic=i,Object.freeze(o),o}return r(t,e),t}(di);Oi.TYPE="topic_changed";var Ai={CREATED:0,MESSAGE:1,USER_JOINED:2,USER_LEFT:3,USER_ADDED:4,USER_REMOVED:5,NAME_CHANGED:6,TOPIC_CHANGED:7},Ni=function(){function e(e,t,n){this.id=e,this.description=t,this.members=n,Object.freeze(this)}return e}(),Ii=function(){function e(){}return e.registerMessageBodySerializer=function(e,t){if(void 0!==this.ga[e])throw new Error("No serializer for type "+je[e]);this.ga[e]=t},e.registerDefaultMessageBodySerializer=function(e){this.registerMessageBodySerializer(e,this.ha)},e.registerMessageBodyDeserializer=function(e,t){if(void 0!==this.ia[e])throw new Error("No deserializer for type "+je[e]);this.ia[e]=t},e.registerDefaultMessageBodyDeserializer=function(e){this.registerMessageBodyDeserializer(e,this.ja)},e.serialize=function(e){var t=e.body,n=t.type,r=this.ga[n];if(void 0===r)throw new Error("No serializer set for message type: "+je[n]);var i=r(t);return i.t=n,{b:i,q:e.requestId,p:e.responseId}},e.deserialize=function(e){var t=e.b,n=t.t,r=e.q,i=e.p,o=this.ia[n];if(void 0===o)throw new Error("No deserializer set for message type: "+je[n]);var s=o(t);return s.type=n,{body:s,requestId:r,responseId:i}},e}();Ii.ga={},Ii.ia={},Ii.ja=function(e){return{}},Ii.ha=function(e){return{}},Ii.registerDefaultMessageBodySerializer(je.PING),Ii.registerDefaultMessageBodySerializer(je.PONG),Ii.registerMessageBodySerializer(je.HANDSHAKE_REQUEST,ke),Ii.registerMessageBodyDeserializer(je.HANDSHAKE_RESPONSE,Ye),Ii.registerMessageBodySerializer(je.PASSWORD_AUTH_REQUEST,Qe),Ii.registerMessageBodySerializer(je.TOKEN_AUTH_REQUEST,Fe),Ii.registerMessageBodySerializer(je.ANONYMOUS_AUTH_REQUEST,Je),Ii.registerMessageBodySerializer(je.ERROR,We),Ii.registerMessageBodySerializer(je.OPEN_REAL_TIME_MODEL_REQUEST,Tt),Ii.registerMessageBodySerializer(je.MODEL_AUTO_CREATE_CONFIG_RESPONSE,h),Ii.registerMessageBodySerializer(je.OPERATION_SUBMISSION,Mn),Ii.registerMessageBodySerializer(je.DELETE_REAL_TIME_MODEL_REQUEST,Un),Ii.registerMessageBodySerializer(je.CREATE_REAL_TIME_MODEL_REQUEST,xn),Ii.registerMessageBodySerializer(je.CLOSES_REAL_TIME_MODEL_REQUEST,Bn),Ii.registerMessageBodySerializer(je.GET_MODEL_PERMISSIONS_REQUEST,Ei),Ii.registerMessageBodySerializer(je.SET_MODEL_PERMISSIONS_REQUEST,pi),Ii.registerMessageBodySerializer(je.PUBLISH_REFERENCE,ht),Ii.registerMessageBodySerializer(je.SET_REFERENCE,pt),Ii.registerMessageBodySerializer(je.CLEAR_REFERENCE,dt),Ii.registerMessageBodySerializer(je.UNPUBLISH_REFERENCE,ft),Ii.registerMessageBodySerializer(je.USER_LOOKUP_REQUEST,jn),Ii.registerMessageBodySerializer(je.USER_SEARCH_REQUEST,kn),Ii.registerMessageBodySerializer(je.ACTIVITY_PARTICIPANTS_REQUEST,vr),Ii.registerMessageBodySerializer(je.ACTIVITY_JOIN_REQUEST,qn),Ii.registerMessageBodySerializer(je.ACTIVITY_LEAVE_REQUEST,Kn),Ii.registerMessageBodySerializer(je.ACTIVITY_LOCAL_STATE_SET,Xn),Ii.registerMessageBodySerializer(je.ACTIVITY_LOCAL_STATE_REMOVED,$n),Ii.registerMessageBodySerializer(je.ACTIVITY_LOCAL_STATE_CLEARED,Zn),Ii.registerMessageBodySerializer(je.PRESENCE_SET_STATE,sr),Ii.registerMessageBodySerializer(je.PRESENCE_REMOVE_STATE,ar),Ii.registerDefaultMessageBodySerializer(je.PRESENCE_CLEAR_STATE),Ii.registerMessageBodySerializer(je.PRESENCE_REQUEST,fr),Ii.registerMessageBodySerializer(je.PRESENCE_SUBSCRIBE_REQUEST,dr),Ii.registerMessageBodySerializer(je.PRESENCE_UNSUBSCRIBE,hr),Ii.registerMessageBodySerializer(je.MODELS_QUERY_REQUEST,Rr),Ii.registerMessageBodySerializer(je.HISTORICAL_DATA_REQUEST,T),Ii.registerMessageBodySerializer(je.HISTORICAL_OPERATIONS_REQUEST,ui),Ii.registerMessageBodySerializer(je.GET_CLIENT_PERMISSIONS_REQUEST,J),Ii.registerMessageBodySerializer(je.ADD_PERMISSIONS_REQUEST,W),Ii.registerMessageBodySerializer(je.REMOVE_PERMISSIONS_REQUEST,K),Ii.registerMessageBodySerializer(je.SET_PERMISSIONS_REQUEST,X),Ii.registerMessageBodySerializer(je.GET_WORLD_PERMISSIONS_REQUEST,$),Ii.registerMessageBodySerializer(je.GET_ALL_USER_PERMISSIONS_REQUEST,ee),Ii.registerMessageBodySerializer(je.GET_USER_PERMISSIONS_REQUEST,te),Ii.registerMessageBodySerializer(je.GET_ALL_GROUP_PERMISSIONS_REQUEST,re),Ii.registerMessageBodySerializer(je.GET_GROUP_PERMISSIONS_REQUEST,re),Ii.registerDefaultMessageBodyDeserializer(je.PING),Ii.registerDefaultMessageBodyDeserializer(je.PONG),Ii.registerMessageBodyDeserializer(je.AUTHENTICATE_RESPONSE,qe),Ii.registerMessageBodyDeserializer(je.ERROR,Ke),Ii.registerMessageBodyDeserializer(je.CREATE_REAL_TIME_MODEL_RESPONSE,Hn),Ii.registerMessageBodyDeserializer(je.OPEN_REAL_TIME_MODEL_RESPONSE,Ot),Ii.registerMessageBodyDeserializer(je.MODEL_AUTO_CREATE_CONFIG_REQUEST,E),Ii.registerMessageBodyDeserializer(je.OPERATION_ACKNOWLEDGEMENT,Dn),Ii.registerMessageBodyDeserializer(je.REMOTE_OPERATION,Ln),Ii.registerMessageBodyDeserializer(je.REMOTE_CLIENT_OPENED,Qn),Ii.registerMessageBodyDeserializer(je.REMOTE_CLIENT_CLOSED,Fn),Ii.registerMessageBodyDeserializer(je.FORCE_CLOSE_REAL_TIME_MODEL,Pn),Ii.registerDefaultMessageBodyDeserializer(je.DELETE_REAL_TIME_MODEL_RESPONSE),Ii.registerDefaultMessageBodyDeserializer(je.CLOSE_REAL_TIME_MODEL_RESPONSE),Ii.registerMessageBodyDeserializer(je.REFERENCE_SET,at),Ii.registerMessageBodyDeserializer(je.REFERENCE_PUBLISHED,st),Ii.registerMessageBodyDeserializer(je.REFERENCE_CLEARED,ct),Ii.registerMessageBodyDeserializer(je.REFERENCE_UNPUBLISHED,Et),Ii.registerMessageBodyDeserializer(je.GET_MODEL_PERMISSIONS_RESPONSE,hi),Ii.registerMessageBodyDeserializer(je.MODEL_PERMISSIONS_CHANGED,fi),Ii.registerDefaultMessageBodyDeserializer(je.SET_MODEL_PERMISSIONS_RESPONSE),Ii.registerMessageBodyDeserializer(je.USER_LIST_RESPONSE,Yn),Ii.registerMessageBodyDeserializer(je.ACTIVITY_PARTICIPANTS_RESPONSE,Sr),Ii.registerDefaultMessageBodyDeserializer(je.ACTIVITY_LEAVE_RESPONSE),Ii.registerMessageBodyDeserializer(je.ACTIVITY_JOIN_RESPONSE,Wn),Ii.registerMessageBodyDeserializer(je.ACTIVITY_SESSION_JOINED,rr),Ii.registerMessageBodyDeserializer(je.ACTIVITY_SESSION_LEFT,ir),Ii.registerMessageBodyDeserializer(je.ACTIVITY_REMOTE_STATE_SET,er),Ii.registerMessageBodyDeserializer(je.ACTIVITY_REMOTE_STATE_REMOVED,tr),Ii.registerMessageBodyDeserializer(je.ACTIVITY_REMOTE_STATE_CLEARED,nr),Ii.registerMessageBodyDeserializer(je.PRESENCE_AVAILABILITY_CHANGED,or),Ii.registerMessageBodyDeserializer(je.PRESENCE_STATE_SET,ur),Ii.registerMessageBodyDeserializer(je.PRESENCE_STATE_REMOVED,cr),Ii.registerMessageBodyDeserializer(je.PRESENCE_STATE_CLEARED,Er),Ii.registerMessageBodyDeserializer(je.PRESENCE_RESPONSE,pr),Ii.registerMessageBodyDeserializer(je.PRESENCE_SUBSCRIBE_RESPONSE,lr),Ii.registerMessageBodyDeserializer(je.MODELS_QUERY_RESPONSE,Tr),Ii.registerMessageBodyDeserializer(je.HISTORICAL_DATA_RESPONSE,O),Ii.registerMessageBodyDeserializer(je.HISTORICAL_OPERATIONS_RESPONSE,ci),Ii.registerMessageBodySerializer(je.USER_GROUPS_REQUEST,j),Ii.registerMessageBodyDeserializer(je.USER_GROUPS_RESPONSE,k),Ii.registerMessageBodySerializer(je.USER_GROUPS_FOR_USERS_REQUEST,Q),Ii.registerMessageBodyDeserializer(je.USER_GROUPS_FOR_USERS_RESPONSE,F),Ii.registerMessageBodySerializer(je.CREATE_CHAT_CHANNEL_REQUEST,A),Ii.registerMessageBodyDeserializer(je.CREATE_CHAT_CHANNEL_RESPONSE,N),Ii.registerMessageBodySerializer(je.REMOVE_CHAT_CHANNEL_REQUEST,I),Ii.registerDefaultMessageBodyDeserializer(je.REMOVE_CHAT_CHANNEL_RESPONSE),Ii.registerMessageBodySerializer(je.GET_CHAT_CHANNELS_REQUEST,m),Ii.registerMessageBodyDeserializer(je.GET_CHAT_CHANNELS_RESPONSE,C),Ii.registerMessageBodySerializer(je.GET_DIRECT_CHAT_CHANNELS_REQUEST,g),Ii.registerMessageBodyDeserializer(je.GET_DIRECT_CHAT_CHANNELS_RESPONSE,C),Ii.registerDefaultMessageBodySerializer(je.GET_JOINED_CHAT_CHANNELS_REQUEST),Ii.registerMessageBodyDeserializer(je.GET_JOINED_CHAT_CHANNELS_RESPONSE,C),Ii.registerDefaultMessageBodySerializer(je.SEARCH_CHAT_CHANNELS_REQUEST),Ii.registerMessageBodyDeserializer(je.SEARCH_CHAT_CHANNELS_RESPONSE,C),Ii.registerMessageBodySerializer(je.JOIN_CHAT_CHANNEL_REQUEST,l),Ii.registerMessageBodyDeserializer(je.JOIN_CHAT_CHANNEL_RESPONSE,v),Ii.registerMessageBodyDeserializer(je.USER_JOINED_CHAT_CHANNEL,S),Ii.registerMessageBodySerializer(je.LEAVE_CHAT_CHANNEL_REQUEST,M),Ii.registerDefaultMessageBodyDeserializer(je.LEAVE_CHAT_CHANNEL_RESPONSE),Ii.registerMessageBodyDeserializer(je.USER_LEFT_CHAT_CHANNEL,D),Ii.registerMessageBodySerializer(je.ADD_USER_TO_CHAT_CHANNEL_REQUEST,_),Ii.registerDefaultMessageBodyDeserializer(je.ADD_USER_TO_CHAT_CHANNEL_RESPONSE),Ii.registerMessageBodySerializer(je.REMOVE_USER_FROM_CHAT_CHANNEL_REQUEST,L),Ii.registerDefaultMessageBodyDeserializer(je.REMOVE_USER_FROM_CHAT_CHANNEL_RESPONSE),Ii.registerMessageBodySerializer(je.SET_CHAT_CHANNEL_NAME_REQUEST,U),Ii.registerDefaultMessageBodyDeserializer(je.SET_CHAT_CHANNEL_NAME_RESPONSE),Ii.registerMessageBodySerializer(je.SET_CHAT_CHANNEL_TOPIC_REQUEST,P),Ii.registerDefaultMessageBodyDeserializer(je.SET_CHAT_CHANNEL_TOPIC_RESPONSE),Ii.registerMessageBodySerializer(je.MARK_CHAT_CHANNEL_EVENTS_SEEN_REQUEST,x),Ii.registerDefaultMessageBodyDeserializer(je.MARK_CHAT_CHANNEL_EVENTS_SEEN_RESPONSE),Ii.registerMessageBodyDeserializer(je.CHAT_CHANNEL_EVENTS_MARKED_SEEN,H),Ii.registerMessageBodySerializer(je.PUBLISH_CHAT_MESSAGE_REQUEST,R),Ii.registerDefaultMessageBodyDeserializer(je.PUBLISH_CHAT_MESSAGE_RESPONSE),Ii.registerMessageBodyDeserializer(je.REMOTE_CHAT_MESSAGE,y),Ii.registerMessageBodySerializer(je.GET_CHAT_CHANNEL_HISTORY_REQUEST,B),Ii.registerMessageBodyDeserializer(je.GET_CHAT_CHANNEL_HISTORY_RESPONSE,z),Ii.registerMessageBodySerializer(je.CHAT_CHANNEL_EXISTS_REQUEST,w),Ii.registerMessageBodyDeserializer(je.CHAT_CHANNEL_EXISTS_RESPONSE,b),Ii.registerMessageBodyDeserializer(je.GET_CLIENT_PERMISSIONS_RESPONSE,q),Ii.registerDefaultMessageBodyDeserializer(je.ADD_PERMISSIONS_RESPONSE),Ii.registerDefaultMessageBodyDeserializer(je.REMOVE_PERMISSIONS_RESPONSE),Ii.registerDefaultMessageBodyDeserializer(je.SET_PERMISSIONS_RESPONSE),Ii.registerMessageBodyDeserializer(je.GET_WORLD_PERMISSIONS_RESPONSE,Z),Ii.registerMessageBodyDeserializer(je.GET_ALL_USER_PERMISSIONS_RESPONSE,ie),Ii.registerMessageBodyDeserializer(je.GET_USER_PERMISSIONS_RESPONSE,ne),Ii.registerMessageBodyDeserializer(je.GET_ALL_GROUP_PERMISSIONS_RESPONSE,ie),Ii.registerMessageBodyDeserializer(je.GET_GROUP_PERMISSIONS_RESPONSE,ie);var mi=function(){function e(e,t,n){this.body=e,this.requestId=t,this.responseId=n,Object.freeze(this)}return e}(),Ci=function(e){function t(n,r,i){var o=e.call(this,n)||this;return o.ka=r,o.la=i,Object.setPrototypeOf(o,t.prototype),o}return r(t,e),Object.defineProperty(t.prototype,"code",{get:function(){return this.ka},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"details",{get:function(){return this.la},enumerable:!0,configurable:!0}),t}(Error),gi=function(e){function t(t,n){var r=e.call(this)||this;return r.ma=0,r.na=n,r.L=t,r.L.on(Ge.Events.MESSAGE,function(e){r.onSocketMessage(e)}),r.L.on(Ge.Events.ERROR,function(e){r.onSocketError(e)}),r.L.on(Ge.Events.CLOSE,function(e){r.onSocketClosed(e)}),r.oa={},r}return r(t,e),t.prototype.connect=function(){return this.L.open()},t.prototype.handshake=function(e,t){var n=this,r={type:je.HANDSHAKE_REQUEST,reconnect:e,reconnectToken:t};return this.request(r).then(function(e){var t={sendPing:function(){this.onPing()},onTimeout:function(){this.abort("pong timeout")}};return n.pa=new xe(t,n.na.heartbeatConfig.pingInterval,n.na.heartbeatConfig.pongTimeout),n.na.heartbeatConfig.enabled&&n.pa.start(),e})},t.prototype.send=function(e){var t=new mi(e);this.sendMessage(t)},t.prototype.request=function(e){var t=this,n=this.ma;this.ma++;var r=new Ve,i=this.na.defaultRequestTimeout,o=setTimeout(function(){var e=t.oa[n];e&&e.replyDeferred.reject(new Error("Response timeout"))},i);return this.oa[n]={reqId:n,replyDeferred:r,timeoutTask:o},this.sendMessage(new mi(e,n)),r.promise()},t.prototype.abort=function(e){this.pa&&this.pa.started&&this.pa.stop(),this.L.terminate(e),this.onSocketDropped()},t.prototype.close=function(){return this.removeAllListenersForAllEvents(),void 0!==this.pa&&this.pa.started&&this.pa.stop(),this.L.close()},t.prototype.sendMessage=function(e){(Be.PROTOCOL_MESSAGES&&e.body.type!==je.PING&&e.body.type!==je.PONG||Be.PROTOCOL_PINGS)&&console.log("S: "+JSON.stringify(e));var t=Ii.serialize(e);this.L.send(t)},t.prototype.onSocketMessage=function(e){var t=Ii.deserialize(e);this.na.heartbeatConfig.enabled&&this.pa&&this.pa.messageReceived();var n=t.body.type;(Be.PROTOCOL_MESSAGES&&n!==je.PING&&n!==je.PONG||Be.PROTOCOL_PINGS)&&console.log("R: "+JSON.stringify(t)),n===je.PING?this.onPing():n===je.PONG||(void 0!==t.requestId?this.onRequest(t):void 0!==t.responseId?this.onReply(t):this.onNormalMessage(t))},t.prototype.onSocketClosed=function(e){this.pa&&this.pa.started&&this.pa.stop(),this.emit(t.Events.CLOSED,e)},t.prototype.onSocketDropped=function(){this.pa&&this.pa.started&&this.pa.stop(),this.emit(t.Events.DROPPED)},t.prototype.onSocketError=function(e){this.emit(t.Events.ERROR,e)},t.prototype.onNormalMessage=function(e){var n=this;setTimeout(function(){n.emit(t.Events.MESSAGE,{request:!1,message:e.body})},0)},t.prototype.onRequest=function(e){this.emit(t.Events.MESSAGE,{request:!0,callback:new wi(e.requestId,this),message:e.body})},t.prototype.onReply=function(e){var t=e.responseId,n=this.oa[t];if(delete this.oa[t],n){clearTimeout(n.timeoutTask);var r=e.body.type;if(r===je.ERROR){var i=e.body;n.replyDeferred.reject(new Ci(i.message,i.code,i.details))}else n.replyDeferred.resolve(e.body)}},t.prototype.onPing=function(){this.sendMessage(new mi({type:je.PING}))},t}(ze);gi.Events={MESSAGE:"message",ERROR:"error",CLOSED:"close",DROPPED:"dropped"};var wi=function(){function e(e,t){this.qa=e,this.ra=t}return e.prototype.reply=function(e){var t=new mi(e,(void 0),this.qa);this.ra.sendMessage(t)},e.prototype.unknownError=function(){this.unexpectedError("An unknown error has occurred")},e.prototype.unexpectedError=function(e){this.expectedError("unknown",e)},e.prototype.expectedError=function(e,t,n){n=n||{};var r={type:je.ERROR,code:e,message:t,details:n},i=new mi(r,(void 0),this.qa);this.ra.sendMessage(i)},e}(),bi=function(){function e(e,t,n,r){this.sa=e,this._=n,this.$=r,this.ta=t,this.ua=!1}return e.prototype.domain=function(){return this.sa},e.prototype.va=function(e){this._=e},e.prototype.sessionId=function(){return this._},e.prototype.username=function(){return this.$},e.prototype.wa=function(e){this.$=e},e.prototype.isConnected=function(){return this.ta.isConnected()},e.prototype.setAuthenticated=function(e){this.ua=e},e.prototype.isAuthenticated=function(){return this.ua},e}(),Mi=function(e){function n(n,r,i,o,s,a){var u=e.call(this)||this;return u.J=n,u.xa=r,u.ya=i,u.za=o,u.Aa=s,u.Ba=0,u.Ca=Di.DISCONNECTED,u.na={defaultRequestTimeout:5e3,heartbeatConfig:{enabled:!0,pingInterval:5e3,pongTimeout:1e4}},u.Da=new ze,u.Ea=new t.Subject,u.Fa=new bi(a,u,null,null),u}return r(n,e),n.prototype.session=function(){return this.Fa},n.prototype.connect=function(){if(this.Ca!==Di.DISCONNECTED)throw new Error("Can only call connect on a disconnected connection.");return this.Ba=0,this.Ga=new Ve,this.Ca=Di.CONNECTING,this.Ha(!1),this.Ga.promise()},n.prototype.disconnect=function(){var e=this,t=new Ve;return null!=this.Ia&&(clearTimeout(this.Ia),this.Ia=null),null!=this.Ja&&(clearTimeout(this.Ja),this.Ja=null),null!=this.Ga&&(this.Ga.reject(new Error("Connection canceled by user")),this.Ga=null),this.Ca===Di.DISCONNECTED&&t.reject(new Error("Connection is already disconnected.")),this.Ca=Di.DISCONNECTING,this.ra.close().then(function(){e.Ca=Di.DISCONNECTED,t.resolve()}).catch(function(n){e.Ca=Di.INTERRUPTED,t.reject(n)}),t.promise()},n.prototype.isConnected=function(){return this.Ca===Di.CONNECTED},n.prototype.send=function(e){this.ra.send(e)},n.prototype.request=function(e){return this.ra.request(e)},n.prototype.authenticateWithPassword=function(e,t){var n={type:je.PASSWORD_AUTH_REQUEST,username:e,password:t};return this.Ka(n)},n.prototype.authenticateWithToken=function(e){var t={type:je.TOKEN_AUTH_REQUEST,token:e};return this.Ka(t)},n.prototype.authenticateAnonymously=function(e){var t={type:je.ANONYMOUS_AUTH_REQUEST,displayName:e};return this.Ka(t)},n.prototype.addMessageListener=function(e,t){this.Da.on(e,t)},n.prototype.addMultipleMessageListener=function(e,t){var n=this;e.forEach(function(e){n.Da.on(e,t)})},n.prototype.removeMessageListener=function(e,t){this.Da.off(e,t)},n.prototype.messages=function(e){if("undefined"==typeof e)return this.Ea.asObservable();var t=e.slice(0);return this.Ea.asObservable().filter(function(e){return t.some(function(t){return e.message.type===t})})},n.prototype.Ka=function(e){var t=this;return this.Fa.isAuthenticated()?Promise.reject(new Error("User already authenticated.")):this.isConnected()?this.La(e):null!=this.Ga?this.Ga.promise().then(function(){return t.La(e)}):Promise.reject(new Error("Must be connected or connecting to authenticate."))},n.prototype.La=function(e){var t=this;return this.request(e).then(function(e){if(e.success===!0){t.Fa.wa(e.username),t.Fa.va(e.sessionId),t.Fa.setAuthenticated(!0);var n={state:e.state};return n}throw new Error("Authentication failed")})},n.prototype.Ha=function(e){var t=this;this.Ba++,e?Be.CONNECTION&&console.log("Attempting reconnection %d of %d.",this.Ba,this.ya):Be.CONNECTION&&console.log("Attempting connection %d of %d.",this.Ba,this.ya);var r=function(){t.ra.abort("connection timeout exceeded")};this.Ia=setTimeout(r,1e3*this.xa);var i=new Ge(this.J);this.ra=new gi(i,this.na),this.ra.on(gi.Events.ERROR,function(e){return t.emit(n.Events.ERROR,e)}),this.ra.on(gi.Events.DROPPED,function(){return t.emit(n.Events.INTERRUPTED)}),this.ra.on(gi.Events.CLOSED,function(){return t.emit(n.Events.DISCONNECTED)}),this.ra.on(gi.Events.MESSAGE,function(e){t.Da.emit(e.message.type,e),t.Ea.next(e)}),this.ra.connect().then(function(){Be.CONNECTION&&console.log("Connection succeeded, handshaking."),t.ra.handshake(e).then(function(r){clearTimeout(t.Ia),r.success?(t.Ca=Di.CONNECTED,t.Ga.resolve(r),t.Ga=null,e?t.emit(n.Events.RECONNECTED):t.emit(n.Events.CONNECTED)):(t.ra.close(),(e||t.Aa)&&r.retryOk?t.Ma(t.za,e):(t.emit(n.Events.DISCONNECTED),t.Ga.reject(new Error("Server rejected handshake request.")),t.Ga=null))}).catch(function(r){console.error("Handshake failed: ",r),t.ra.close(),t.ra=null,t.Ga=null,clearTimeout(t.Ia),t.Ma(t.za,e),t.emit(n.Events.DISCONNECTED)})}).catch(function(r){console.error("Connection failed: ",r),clearTimeout(t.Ia),e||t.Aa?t.Ma(Math.max(t.za,0),e):(t.Ga.reject(r),t.Ga=null,t.emit(n.Events.DISCONNECTED))})},n.prototype.Ma=function(e,t){var n=this;if(this.Ba<this.ya||this.ya<0){var r=function(){n.Ha(t)};this.Ja=setTimeout(r,1e3*e)}else this.Ga.reject(new Error("Maximum connection attempts exceeded"))},n}(ze);Mi.Events={CONNECTED:"connected",INTERRUPTED:"interrupted",RECONNECTED:"reconnected",DISCONNECTED:"disconnected",ERROR:"error"};var Di;!function(e){e[e.DISCONNECTED=0]="DISCONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.INTERRUPTED=3]="INTERRUPTED",e[e.DISCONNECTING=4]="DISCONNECTING"}(Di||(Di={}));var Li,Pi=function(){function e(e,t){this.Na=e,this.Oa=t,Object.freeze(this)}return e}(),Ui=function(){function e(e){this.Pa=e}return e.prototype.Qa=function(e,t){return e instanceof wt?this.Ra(e,t):t instanceof wt?this.Sa(e,t):this.Ta(e,t)},e.prototype.Sa=function(e,t){var n=this,r=e,i=t.ops.map(function(e){var t=n.Qa(r,e);return r=t.Na,t.Oa});return new Pi(r,new wt(i))},e.prototype.Ra=function(e,t){var n=this,r=t,i=e.ops.map(function(e){var t=n.Qa(e,r);return r=t.Oa,t.Na});return new Pi(new wt(i),r)},e.prototype.Ta=function(e,t){return e.noOp||t.noOp?new Pi(e,t):e.id===t.id?this.Ua(e,t):new Pi(e,t)},e.prototype.Ua=function(e,t){var n=this.Pa.Va(e,t);if(n)return n(e,t);throw new Error("No function found for: ("+e.type+","+e.type+")")},e}(),xi=function(e,t){return e.index<=t.index?new Pi(e,t.copy({index:t.index+1})):new Pi(e.copy({index:e.index+1}),t)},Hi=function(e,t){return e.index<=t.index?new Pi(e,t.copy({index:t.index+1})):new Pi(e.copy({index:e.index-1}),t)},Bi=function(e,t){return e.index<=t.index?new Pi(e,t.copy({index:t.index+1})):new Pi(e,t)},zi=function(){function e(){}return e.getRangeIndexRelationship=function(e,t,n){return n<e?Li.Before:n>t?Li.After:n===e?Li.Start:n===t?Li.End:Li.Within},e.getRangeRangeRelationship=function(e,t,n,r){return e===n?t===r?Vi.EqualTo:r>t?Vi.Starts:Vi.StartedBy:e>n?e>r?Vi.PrecededBy:r===t?Vi.Finishes:t<r?Vi.ContainedBy:e===r?Vi.MetBy:Vi.OverlappedBy:t<n?Vi.Precedes:r===t?Vi.FinishedBy:t>r?Vi.Contains:t===n?Vi.Meets:Vi.Overlaps},e}();!function(e){e[e.Before=0]="Before",e[e.Start=1]="Start",e[e.Within=2]="Within",e[e.End=3]="End",e[e.After=4]="After"}(Li||(Li={}));var Vi;!function(e){e[e.Precedes=0]="Precedes",e[e.PrecededBy=1]="PrecededBy",e[e.Meets=2]="Meets",e[e.MetBy=3]="MetBy",e[e.Overlaps=4]="Overlaps",e[e.OverlappedBy=5]="OverlappedBy",e[e.Starts=6]="Starts",e[e.StartedBy=7]="StartedBy",e[e.Contains=8]="Contains",e[e.ContainedBy=9]="ContainedBy",e[e.Finishes=10]="Finishes",e[e.FinishedBy=11]="FinishedBy",e[e.EqualTo=12]="EqualTo"}(Vi||(Vi={}));var Gi,ji=function(){function e(){}return e.isForwardMove=function(e){return e.fromIndex<e.toIndex},e.isBackwardMoveMove=function(e){return e.fromIndex>e.toIndex},e.isIdentityMove=function(e){return e.fromIndex===e.toIndex},e.getMoveDirection=function(e){return this.isForwardMove(e)?Gi.Forward:this.isBackwardMoveMove(e)?Gi.Backward:Gi.Identity},e.indexBeforeRange=function(e,t){return t<this.getRangeMin(e)},e.indexAfterRange=function(e,t){return t>this.getRangeMax(e)},e.indexWithinRange=function(e,t){return t>this.getRangeMin(e)&&t<this.getRangeMax(e)},e.getRangeIndexRelationship=function(e,t){return zi.getRangeIndexRelationship(this.getRangeMin(e),this.getRangeMax(e),t)},e.getRangeRelationship=function(e,t){return zi.getRangeRangeRelationship(this.getRangeMin(e),this.getRangeMax(e),this.getRangeMin(t),this.getRangeMax(t))},e.getRangeMin=function(e){return Math.min(e.fromIndex,e.toIndex)},e.getRangeMax=function(e){return Math.max(e.fromIndex,e.toIndex)},e}();!function(e){e[e.Forward=0]="Forward",e[e.Backward=1]="Backward",e[e.Identity=2]="Identity"}(Gi||(Gi={}));var ki=function(e,t){switch(ji.getMoveDirection(t)){case Gi.Forward:return oe(e,t);case Gi.Backward:return se(e,t);case Gi.Identity:return ae(e,t);default:throw new Error("Invalid move direction")}},Yi=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Qi=function(e,t){return e.index<t.index?new Pi(e,t.copy({index:t.index-1})):new Pi(e.copy({index:e.index+1}),t)},Fi=function(e,t){return e.index===t.index?new Pi(e.copy({noOp:!0}),t.copy({noOp:!0})):e.index<t.index?new Pi(e,t.copy({index:t.index-1})):new Pi(e.copy({index:e.index-1}),t)},Ji=function(e,t){return e.index<t.index?new Pi(e,t.copy({index:t.index-1})):e.index===t.index?new Pi(e.copy({noOp:!0}),new gt(t.id,t.noOp,t.index,t.value)):new Pi(e,t)},qi=function(e,t){switch(ji.getMoveDirection(t)){case Gi.Forward:return ue(e,t);case Gi.Backward:return ce(e,t);case Gi.Identity:return Ee(e,t);default:throw new Error("Invalid move direction")}},Wi=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Ki=function(e,t){return e.index<t.index?new Pi(e,t):new Pi(e.copy({index:e.index+1}),t)},Xi=function(e,t){return e.index<t.index?new Pi(e,t):e.index===t.index?new Pi(new gt(e.id,e.noOp,e.index,e.value),t.copy({noOp:!0})):new Pi(e.copy({index:e.index-1}),t)},$i=function(e,t){return e.index!==t.index?new Pi(e,t):$e.deepEquals(e.value,t.value)?new Pi(e.copy({noOp:!0}),t.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},Zi=function(e,t){switch(ji.getMoveDirection(t)){case Gi.Forward:return he(e,t);case Gi.Backward:return fe(e,t);case Gi.Identity:return pe(e,t);default:throw new Error("Invalid move direction")}},eo=function(e,t){return new Pi(e.copy({noOp:!0}),t)},to=function(e,t){switch(ji.getMoveDirection(e)){case Gi.Forward:return de(e,t);case Gi.Backward:return le(e,t);case Gi.Identity:return ve(e,t);default:throw new Error("Invalid move direction")}},no=function(e,t){switch(ji.getMoveDirection(e)){case Gi.Forward:return Se(e,t);case Gi.Backward:return _e(e,t);case Gi.Identity:return Re(e,t);default:throw new Error("Invalid move direction")}},ro=function(e,t){switch(ji.getMoveDirection(e)){case Gi.Forward:return ye(e,t);case Gi.Backward:return Te(e,t);case Gi.Identity:return Oe(e,t);default:throw new Error("Invalid move direction")}},io=function(e,t){var n=ji.getMoveDirection(e),r=ji.getMoveDirection(t);return n===Gi.Forward?r===Gi.Forward?Ae(e,t):r===Gi.Backward?Ne(e,t):Ie(e,t):n===Gi.Backward?r===Gi.Forward?me(e,t):r===Gi.Backward?Ce(e,t):ge(e,t):r===Gi.Forward?we(e,t):r===Gi.Backward?be(e,t):Me(e,t)},oo=function(e,t){return new Pi(e.copy({noOp:!0}),t)},so=function(e,t){return new Pi(e,t.copy({noOp:!0}))},ao=function(e,t){return new Pi(e,t.copy({noOp:!0}))},uo=function(e,t){return new Pi(e,t.copy({noOp:!0}))},co=function(e,t){return new Pi(e,t.copy({noOp:!0}))},Eo=function(e,t){return $e.deepEquals(e.value,t.value)?new Pi(e.copy({noOp:!0}),t.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},ho=function(e,t){return e.index<=t.index?new Pi(e,t.copy({index:t.index+e.value.length})):new Pi(e.copy({index:e.index+t.value.length}),t)},fo=function(e,t){if(e.index<=t.index)return new Pi(e,t.copy({index:t.index+e.value.length}));if(e.index>=t.index+t.value.length)return new Pi(e.copy({index:e.index-t.value.length}),t);var n=e.index-t.index;return new Pi(e.copy({noOp:!0}),t.copy({value:t.value.substring(0,n)+e.value+t.value.substring(n,t.value.length)}))},po=function(e,t){return new Pi(e.copy({noOp:!0}),t)},lo=function(e,t){if(t.index<=e.index)return new Pi(e.copy({index:e.index+t.value.length}),t);if(t.index>=e.index+e.value.length)return new Pi(e,t.copy({index:t.index-e.value.length}));var n=t.index-e.index;return new Pi(e.copy({value:e.value.substring(0,n)+t.value+e.value.substring(n,e.value.length)}),t.copy({noOp:!0}))},vo=function(e,t){var n,r,i,o=t.index,s=t.index+t.value.length,a=e.index,u=e.index+e.value.length,c=zi.getRangeRangeRelationship(a,u,o,s);switch(c){case Vi.Precedes:return new Pi(e,t.copy({index:t.index-e.value.length}));case Vi.PrecededBy:return new Pi(e.copy({index:e.index-t.value.length}),t);case Vi.Meets:case Vi.Overlaps:return n=t.index-e.index,new Pi(e.copy({value:e.value.substring(0,n)}),t.copy({index:e.index,value:t.value.substring(e.value.length-n,t.value.length)}));case Vi.MetBy:case Vi.OverlappedBy:return n=e.index-t.index,new Pi(e.copy({index:t.index,value:e.value.substring(t.value.length-n,e.value.length)}),t.copy({value:t.value.substring(0,n)}));case Vi.Starts:return new Pi(e.copy({noOp:!0}),t.copy({value:t.value.substring(e.value.length,t.value.length)}));case Vi.StartedBy:return new Pi(e.copy({value:e.value.substring(t.value.length,e.value.length)}),t.copy({noOp:!0}));case Vi.Contains:return r=t.index-e.index,i=r+t.value.length,new Pi(e.copy({value:e.value.substring(0,r)+e.value.substring(i,e.value.length)}),t.copy({noOp:!0}));case Vi.ContainedBy:return r=e.index-t.index,i=r+e.value.length,new Pi(e.copy({noOp:!0}),t.copy({value:t.value.substring(0,r)+t.value.substring(i,t.value.length)}));case Vi.Finishes:return new Pi(e.copy({noOp:!0}),t.copy({value:t.value.substring(0,t.value.length-e.value.length)}));case Vi.FinishedBy:return new Pi(e.copy({value:e.value.substring(0,e.value.length-t.value.length)}),t.copy({noOp:!0}));case Vi.EqualTo:return new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}));default:throw new Error("invalid range range relationship")}},So=function(e,t){return new Pi(e.copy({noOp:!0}),t)},_o=function(e,t){return new Pi(e,t.copy({noOp:!0}))},Ro=function(e,t){return new Pi(e,t.copy({noOp:!0}))},yo=function(e,t){return e.value===t.value?new Pi(e.copy({noOp:!0}),e.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},To=function(e,t){return new Pi(e,t)},Oo=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Ao=function(e,t){return new Pi(e,t.copy({noOp:!0}))},No=function(e,t){return e.value===t.value?new Pi(e.copy({noOp:!0}),e.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},Io=function(e,t){return e.value===t.value?new Pi(e.copy({
noOp:!0}),e.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},mo=function(e,t){return e.prop!==t.prop?new Pi(e,t):e.value!==t.value?new Pi(new zt(e.id,e.noOp,e.prop,e.value),t.copy({noOp:!0})):new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}))},Co=function(e,t){if(e.prop!==t.prop)return new Pi(e,t);throw new Error("Add property and set property can not target the same property")},go=function(e,t){if(e.prop!==t.prop)return new Pi(e,t);throw new Error("Add property and Remove property can not target the same property")},wo=function(e,t){if(e.prop!==t.prop)return new Pi(e,t);throw new Error("Remove property and add property can not target the same property")},bo=function(e,t){return e.prop!==t.prop?new Pi(e,t):new Pi(e.copy({noOp:!0}),new Ht(t.id,t.noOp,t.prop,t.value))},Mo=function(e,t){return e.prop!==t.prop?new Pi(e,t):new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}))},Do=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Lo=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Po=function(e,t){if(e.prop!==t.prop)return new Pi(e,t);throw new Error("Set property and add property can not target the same property")},Uo=function(e,t){return e.prop!==t.prop?new Pi(e,t):e.value!==t.value?new Pi(e,t.copy({noOp:!0})):new Pi(e.copy({noOp:!0}),t.copy({noOp:!0}))},xo=function(e,t){return e.prop!==t.prop?new Pi(e,t):new Pi(new Ht(e.id,e.noOp,e.prop,e.value),t.copy({noOp:!0}))},Ho=function(e,t){return new Pi(e.copy({noOp:!0}),t)},Bo=function(e,t){return new Pi(e,t.copy({noOp:!0}))},zo=function(e,t){return new Pi(e,t.copy({noOp:!0}))},Vo=function(e,t){return new Pi(e,t.copy({noOp:!0}))},Go=function(e,t){return $e.deepEquals(e.value,t.value)?new Pi(e.copy({noOp:!0}),t.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},jo=function(){function e(){}return e.handleInsert=function(e,t,n){return e.map(function(e){return e>=t?e+n:e})},e.handleReorder=function(e,t,n){return e.map(function(e){return e>=n&&e<t?e+1:e>=t&&e<n?e-1:e})},e.handleRemove=function(e,t,n){return e.map(function(e){return e>t?e-Math.min(e-t,n):e})},e}(),ko=function(e,t){var n=jo.handleInsert(t.values,e.index,e.value.length);return At.copy(t,{values:n})},Yo=function(e,t){var n=jo.handleRemove(t.values,e.index,e.value.length);return At.copy(t,{values:n})},Qo=function(e,t){return null},Fo=function(){function e(){}return e.handleInsert=function(t,n,r){return t.map(function(t){var i=e.Wa(t),o=jo.handleInsert(i,n,r);return e.Xa(o)})},e.handleReorder=function(t,n,r){return t.map(function(t){var i=e.Wa(t),o=jo.handleReorder(i,n,r);return e.Xa(o)})},e.handleRemove=function(t,n,r){return t.map(function(t){var i=e.Wa(t),o=jo.handleRemove(i,n,r);return e.Xa(o)})},e.Wa=function(e){return[e.start,e.end]},e.Xa=function(e){return{start:e[0],end:e[1]}},e}(),Jo=function(e,t){var n=Fo.handleInsert(t.values,e.index,e.value.length);return At.copy(t,{values:n})},qo=function(e,t){var n=Fo.handleRemove(t.values,e.index,e.value.length);return At.copy(t,{values:n})},Wo=function(e,t){return null},Ko=function(e,t){return e.value.getTime()===t.value.getTime()?new Pi(e.copy({noOp:!0}),e.copy({noOp:!0})):new Pi(e,t.copy({noOp:!0}))},Xo=function(){function e(){this.Ya={},this.Za={},this.registerOtf(Ct.STRING_INSERT,Ct.STRING_INSERT,ho),this.registerOtf(Ct.STRING_INSERT,Ct.STRING_REMOVE,fo),this.registerOtf(Ct.STRING_INSERT,Ct.STRING_VALUE,po),this.registerOtf(Ct.STRING_REMOVE,Ct.STRING_INSERT,lo),this.registerOtf(Ct.STRING_REMOVE,Ct.STRING_REMOVE,vo),this.registerOtf(Ct.STRING_REMOVE,Ct.STRING_VALUE,So),this.registerOtf(Ct.STRING_VALUE,Ct.STRING_INSERT,_o),this.registerOtf(Ct.STRING_VALUE,Ct.STRING_REMOVE,Ro),this.registerOtf(Ct.STRING_VALUE,Ct.STRING_VALUE,yo),this.registerOtf(Ct.OBJECT_ADD,Ct.OBJECT_ADD,mo),this.registerOtf(Ct.OBJECT_ADD,Ct.OBJECT_SET,Co),this.registerOtf(Ct.OBJECT_ADD,Ct.OBJECT_REMOVE,go),this.registerOtf(Ct.OBJECT_ADD,Ct.OBJECT_VALUE,Do),this.registerOtf(Ct.OBJECT_REMOVE,Ct.OBJECT_ADD,wo),this.registerOtf(Ct.OBJECT_REMOVE,Ct.OBJECT_SET,bo),this.registerOtf(Ct.OBJECT_REMOVE,Ct.OBJECT_REMOVE,Mo),this.registerOtf(Ct.OBJECT_REMOVE,Ct.OBJECT_VALUE,Lo),this.registerOtf(Ct.OBJECT_SET,Ct.OBJECT_ADD,Po),this.registerOtf(Ct.OBJECT_SET,Ct.OBJECT_SET,Uo),this.registerOtf(Ct.OBJECT_SET,Ct.OBJECT_REMOVE,xo),this.registerOtf(Ct.OBJECT_SET,Ct.OBJECT_VALUE,Ho),this.registerOtf(Ct.OBJECT_VALUE,Ct.OBJECT_ADD,Bo),this.registerOtf(Ct.OBJECT_VALUE,Ct.OBJECT_SET,zo),this.registerOtf(Ct.OBJECT_VALUE,Ct.OBJECT_REMOVE,Vo),this.registerOtf(Ct.OBJECT_VALUE,Ct.OBJECT_VALUE,Go),this.registerOtf(Ct.ARRAY_INSERT,Ct.ARRAY_INSERT,xi),this.registerOtf(Ct.ARRAY_INSERT,Ct.ARRAY_REMOVE,Hi),this.registerOtf(Ct.ARRAY_INSERT,Ct.ARRAY_SET,Bi),this.registerOtf(Ct.ARRAY_INSERT,Ct.ARRAY_REORDER,ki),this.registerOtf(Ct.ARRAY_INSERT,Ct.ARRAY_VALUE,Yi),this.registerOtf(Ct.ARRAY_REMOVE,Ct.ARRAY_INSERT,Qi),this.registerOtf(Ct.ARRAY_REMOVE,Ct.ARRAY_REMOVE,Fi),this.registerOtf(Ct.ARRAY_REMOVE,Ct.ARRAY_SET,Ji),this.registerOtf(Ct.ARRAY_REMOVE,Ct.ARRAY_REORDER,qi),this.registerOtf(Ct.ARRAY_REMOVE,Ct.ARRAY_VALUE,Wi),this.registerOtf(Ct.ARRAY_SET,Ct.ARRAY_INSERT,Ki),this.registerOtf(Ct.ARRAY_SET,Ct.ARRAY_REMOVE,Xi),this.registerOtf(Ct.ARRAY_SET,Ct.ARRAY_SET,$i),this.registerOtf(Ct.ARRAY_SET,Ct.ARRAY_REORDER,Zi),this.registerOtf(Ct.ARRAY_SET,Ct.ARRAY_VALUE,eo),this.registerOtf(Ct.ARRAY_REORDER,Ct.ARRAY_INSERT,to),this.registerOtf(Ct.ARRAY_REORDER,Ct.ARRAY_REMOVE,no),this.registerOtf(Ct.ARRAY_REORDER,Ct.ARRAY_SET,ro),this.registerOtf(Ct.ARRAY_REORDER,Ct.ARRAY_REORDER,io),this.registerOtf(Ct.ARRAY_REORDER,Ct.ARRAY_VALUE,oo),this.registerOtf(Ct.ARRAY_VALUE,Ct.ARRAY_INSERT,so),this.registerOtf(Ct.ARRAY_VALUE,Ct.ARRAY_REMOVE,ao),this.registerOtf(Ct.ARRAY_VALUE,Ct.ARRAY_SET,uo),this.registerOtf(Ct.ARRAY_VALUE,Ct.ARRAY_REORDER,co),this.registerOtf(Ct.ARRAY_VALUE,Ct.ARRAY_VALUE,Eo),this.registerOtf(Ct.NUMBER_ADD,Ct.NUMBER_ADD,To),this.registerOtf(Ct.NUMBER_ADD,Ct.NUMBER_VALUE,Oo),this.registerOtf(Ct.NUMBER_VALUE,Ct.NUMBER_ADD,Ao),this.registerOtf(Ct.NUMBER_VALUE,Ct.NUMBER_VALUE,No),this.registerOtf(Ct.BOOLEAN_VALUE,Ct.BOOLEAN_VALUE,Io),this.registerOtf(Ct.DATE_VALUE,Ct.DATE_VALUE,Ko),this.registerRtf(rt.Types.INDEX,Ct.STRING_INSERT,ko),this.registerRtf(rt.Types.INDEX,Ct.STRING_REMOVE,Yo),this.registerRtf(rt.Types.INDEX,Ct.STRING_VALUE,Qo),this.registerRtf(rt.Types.RANGE,Ct.STRING_INSERT,Jo),this.registerRtf(rt.Types.RANGE,Ct.STRING_REMOVE,qo),this.registerRtf(rt.Types.RANGE,Ct.STRING_VALUE,Wo)}return e.prototype.registerOtf=function(e,t,n){var r=e+t;if(this.Ya[r])throw new Error("Function already registered for "+e+", "+t);this.Ya[r]=n},e.prototype.registerRtf=function(e,t,n){var r=t+e;if(this.Za[r])throw new Error("Function already registered for "+t+", "+e);this.Za[r]=n},e.prototype.Va=function(e,t){var n=e.type+t.type;return this.Ya[n]},e.prototype.getReferenceTransformationFunction=function(e,t){var n=e.type+t.type;return this.Za[n]},e}(),$o=function(){function e(e,t,n,r,i){this.clientId=e,this.seqNo=t,this.version=n,this.timestamp=r,this.operation=i,Object.freeze(this)}return e}(),Zo=function(){function e(e,t,n,r,i){this.clientId=e,this.seqNo=t,this.contextVersion=n,this.timestamp=r,this.operation=i,Object.freeze(this)}return e}(),es=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.$a=t,o._a=0,o.ab=n,o.bb=[],o.cb=[],o.db=r,o.eb=i,o.fb=!1,o.gb=[],o}return r(t,e),t.prototype.clientId=function(){return this.$a},t.prototype.contextVersion=function(){return this.ab},t.prototype.hb=function(){return 0!==this.bb.length},t.prototype.ib=function(){return 0===this.bb.length?null:this.bb.shift()},t.prototype.hasNextRemoteReference=function(){return 0!==this.bb.length},t.prototype.getNextRemoteReferenceSetEvent=function(){return 0===this.bb.length?null:this.bb.shift()},t.prototype.jb=function(){if(this.fb)throw new Error("Batch operation already in progress.");this.gb=[],this.fb=!0},t.prototype.kb=function(){if(!this.fb)throw new Error("Batch operation not in progress.");if(0!==this.gb.length)throw new Error("Can not cancel a batch operation if operation shave been issued.");this.fb=!1},t.prototype.lb=function(){if(!this.fb)throw new Error("Batch operation not in progress.");if(this.fb=!1,0===this.gb.length)throw new Error("A Batch operation must have at least one operation.");var e=new wt(this.gb);this.gb=[],this.cb.push(e);var t=new Zo(this.$a,(this._a++),this.ab,(new Date).getTime(),e);return t},t.prototype.batchSize=function(){return this.gb.length},t.prototype.mb=function(){return this.fb},t.prototype.nb=function(e){if(this.fb&&!(e instanceof It))throw new Error("Can't process a compound operation that is in progress");var n=this.ob(this.bb,e);return 0===this.cb.length&&0===this.gb.length&&this.emit(t.Events.COMMIT_STATE_CHANGED,!1),this.fb?(this.gb.push(n),null):(this.cb.push(n),new Zo(this.$a,(this._a++),this.ab,(new Date).getTime(),n))},t.prototype.processOutgoingSetReference=function(e){for(var t=0;t<this.bb.length&&e;t++)e=this.eb.Qa(this.bb[t].operation,e);return e},t.prototype.dispose=function(){},t.prototype.pb=function(e,n){if(0===this.cb.length)throw new Error("Received an operation from this site, but with no operations in flight.");if(this.ab!==n)throw new Error("Acknowledgement did not meet expected context version of "+this.ab+": "+n);this.ab++,this.cb.shift(),0===this.cb.length&&0===this.gb.length&&this.emit(t.Events.COMMIT_STATE_CHANGED,!0)},t.prototype.qb=function(e){if(e.contextVersion>this.ab)throw new Error("Invalid context version.");var t=e.operation;t=this.rb(t,this.cb),t=this.rb(t,this.gb),this.ab++,this.bb.push(new $o(e.clientId,e.seqNo,e.contextVersion,e.timestamp,t))},t.prototype.processRemoteReferenceSet=function(e){for(var t=0;t<this.cb.length&&e;t++)e=this.eb.Qa(this.cb[t],e);return e},t.prototype.rb=function(e,t){for(var n=e,r=0;r<t.length;r++){var i=this.db.Qa(n,t[r]);n=i.Na,t[r]=i.Oa}return n},t.prototype.ob=function(e,t){for(var n=t,r=0;r<e.length;r++){var i=this.db.Qa(e[r].operation,n);e[r]=new $o(e[r].clientId,e[r].seqNo,e[r].version,e[r].timestamp,i.Na),n=i.Oa}return n},t}(ze);es.Events={COMMIT_STATE_CHANGED:"commitStateChanged"};var ts=function(){function e(e){this.Pa=e}return e.prototype.Qa=function(e,t){return e instanceof wt?this.sb(e,t):this.tb(e,t)},e.prototype.sb=function(e,t){for(var n=t,r=0;r<e.ops.length&&n;r++)n=this.Qa(e.ops[r],n);return n},e.prototype.tb=function(e,t){return e.noOp?t:e.id===t.id?this.ub(e,t):t},e.prototype.ub=function(e,t){var n=this.Pa.getReferenceTransformationFunction(e,t);if(n)return n(e,t);throw new Error("No function found for: ("+e.type+","+t.type+")")},e}(),ns=function(){function e(e){this.idGenerator=e}return e.prototype.createDataValue=function(e){var t=this,n=this.idGenerator(),r=typeof e;if(null===e){var i={id:n,type:"null"};return i}if("string"===r){var o={id:n,type:r,value:e};return o}if(e instanceof Date){var s={id:n,type:"date",value:e};return s}if(Array.isArray(e)){var a=e.map(function(e){return t.createDataValue(e)}),u={id:n,type:"array",children:a};return u}if("object"===r){if(e.hasOwnProperty("$convergenceType")){var c=e.$convergenceType;if("date"===c){if(e.hasOwnProperty("value")){var s={id:n,type:"date",value:new Date(e.value)};return s}throw new Error("Invalid convergence data type: "+r+" value field missing.")}throw new Error("Invalid convergence data type: "+r+" supported types are [date].")}var E={};Object.getOwnPropertyNames(e).forEach(function(n){E[n]=t.createDataValue(e[n])});var h={id:n,type:r,children:E};return h}if("number"===r){var f={id:n,type:r,value:e};return f}if("boolean"===r){var p={id:n,type:r,value:e};return p}throw new Error("Invalid data type: "+r)},e}(),rs=function(){function e(){}return e.nonEmptyString=function(e){return"string"==typeof e&&e.length>0},e.assertNonEmptyString=function(t,n){if(void 0===n&&(n="value"),!e.nonEmptyString(t))throw new Error(n+" must be a non-empty string: "+typeof t)},e.assertString=function(e,t){if(void 0===t&&(t="value"),"string"!=typeof e)throw new Error(t+" must be a string: "+typeof e)},e}(),is=function(){function e(t,n,r){this.reference=t,this.element=n,this.model=r,this.name=e.NAME,Object.freeze(this)}return e}();is.NAME="reference";var os=function(){function e(t,n,r){this.model=t,this.permissions=n,this.changes=r,this.name=e.NAME,Object.freeze(this)}return e}();os.NAME="permissions_changed";var ss=function(){function e(t){this.src=t,this.name=e.NAME}return e}();ss.NAME="detached";var as=function(){function e(t,n,r,i,o,s){this.element=t,this.relativePath=n,this.childEvent=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();as.NAME="model_changed";var us=function(){function e(t,n,r,i,o,s){this.element=t,this.index=n,this.value=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();us.NAME="insert";var cs=function(){function e(t,n,r,i,o){this.element=t,this.index=n,this.sessionId=r,this.username=i,this.local=o,this.name=e.NAME,Object.freeze(this)}return e}();cs.NAME="remove";var Es=function(){function e(t,n,r,i,o,s){this.element=t,this.index=n,this.value=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();Es.NAME="set";var hs=function(){function e(t,n,r,i,o,s){this.element=t,this.fromIndex=n,this.toIndex=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();hs.NAME="reorder";var fs=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();fs.NAME="value";var ps=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();ps.NAME="value";var ds=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();ds.NAME="value";var ls=function(){function e(t,n,r,i,o){this.element=t,this.value=n,this.sessionId=r,this.username=i,this.local=o,this.name=e.NAME,Object.freeze(this)}return e}();ls.NAME="delta";var vs=function(){function e(t,n,r,i,o,s){this.element=t,this.key=n,this.value=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();vs.NAME="set";var Ss=function(){function e(t,n,r,i,o){this.element=t,this.key=n,this.sessionId=r,this.username=i,this.local=o,this.name=e.NAME,Object.freeze(this)}return e}();Ss.NAME="remove";var _s=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();_s.NAME="value";var Rs=function(){function e(t,n,r,i,o,s){this.element=t,this.index=n,this.value=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();Rs.NAME="insert";var ys=function(){function e(t,n,r,i,o,s){this.element=t,this.index=n,this.value=r,this.sessionId=i,this.username=o,this.local=s,this.name=e.NAME,Object.freeze(this)}return e}();ys.NAME="remove";var Ts=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();Ts.NAME="value";var Os=function(){function e(t,n,r,i){this.element=t,this.sessionId=n,this.username=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();Os.NAME="value";var As=function(){function e(t,n){this.src=t,this.local=n,this.name=e.NAME}return e}();As.NAME="detached";var Ns=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.relativePath=r,this.childEvent=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();Ns.NAME="node_changed";var Is=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.index=r,this.value=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();Is.NAME="insert";var ms=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.index=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();ms.NAME="remove";var Cs=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.index=r,this.value=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();Cs.NAME="set";var gs=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.fromIndex=r,this.toIndex=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();gs.NAME="reorder";var ws=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();ws.NAME="value";var bs=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();bs.NAME="value";var Ms=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();Ms.NAME="value";var Ds=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();Ds.NAME="delta";var Ls=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.key=r,this.value=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();Ls.NAME="set";var Ps=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.key=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();Ps.NAME="remove";var Us=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();Us.NAME="value";var xs=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.index=r,this.value=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();xs.NAME="insert";var Hs=function(){function e(t,n,r,i,o,s){this.src=t,this.local=n,this.index=r,this.value=i,this.sessionId=o,this.username=s,this.name=e.NAME,Object.freeze(this)}return e}();Hs.NAME="remove";var Bs=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();Bs.NAME="value";var zs=function(){function e(t,n,r,i,o){this.src=t,this.local=n,this.value=r,this.sessionId=i,this.username=o,this.name=e.NAME,Object.freeze(this)}return e}();zs.NAME="value";var Vs=function(){function e(){}return e.convertEvent=function(e,t){if(e instanceof As)return new ss(t.wrap(e.src));if(e instanceof Ns)return new as(t.wrap(e.src),e.relativePath,this.convertEvent(e.childEvent,t),e.sessionId,e.username,e.local);if(e instanceof Is)return new us(t.wrap(e.src),e.index,t.wrap(e.value),e.sessionId,e.username,e.local);if(e instanceof ms)return new cs(t.wrap(e.src),e.index,e.sessionId,e.username,e.local);if(e instanceof gs)return new hs(t.wrap(e.src),e.fromIndex,e.toIndex,e.sessionId,e.username,e.local);if(e instanceof Cs)return new Es(t.wrap(e.src),e.index,t.wrap(e.value),e.sessionId,e.username,e.local);if(e instanceof ws)return new fs(t.wrap(e.src),e.sessionId,e.username,e.local);if(e instanceof bs)return new ps(t.wrap(e.src),e.sessionId,e.username,e.local);if(e instanceof Ms)return new ds(t.wrap(e.src),e.sessionId,e.username,e.local);if(e instanceof Ds)return new ls(t.wrap(e.src),e.value,e.sessionId,e.username,e.local);if(e instanceof Us)return new _s(t.wrap(e.src),e.sessionId,e.username,e.local);if(e instanceof Ps)return new Ss(t.wrap(e.src),e.key,e.sessionId,e.username,e.local);if(e instanceof Ls)return new vs(t.wrap(e.src),e.key,t.wrap(e.value),e.sessionId,e.username,e.local);if(e instanceof xs)return new Rs(t.wrap(e.src),e.index,e.value,e.sessionId,e.username,e.local);if(e instanceof Hs)return new ys(t.wrap(e.src),e.index,e.value,e.sessionId,e.username,e.local);if(e instanceof Bs)return new Ts(t.wrap(e.src),e.sessionId,e.username,e.local);if(e instanceof zs)return new Os(t.wrap(e.src),e.sessionId,e.username,e.local);throw new Error("Unable to convert event: "+e.name)},e}(),Gs=function(){function e(){this.vb={}}return e.prototype.put=function(e){var t=e.sessionId(),n=e.key(),r=this.vb[t];if(void 0===r&&(r={},this.vb[t]=r),void 0!==r[n])throw new Error("Model reference already exists");r[n]=e},e.prototype.get=function(e,t){var n=this.vb[e];return void 0!==n?n[t]:void 0},e.prototype.getAll=function(e){var t=this;"undefined"==typeof e&&(e={});var n,r=[];return n=void 0!==e.sessionId&&null!==e.sessionId?[e.sessionId]:Object.getOwnPropertyNames(this.vb),n.forEach(function(n){var i=t.vb[n],o=void 0!==e.key?[e.key]:Object.getOwnPropertyNames(i);o.forEach(function(e){var t=i[e];void 0!==t&&r.push(t)})}),r},e.prototype.removeAll=function(){this.vb={}},e.prototype.remove=function(e,t){var n=this.vb[e];if(void 0!==n){var r=n[t];return delete n[t],r}},e.prototype.removeBySession=function(e){delete this.vb[e]},e.prototype.removeByKey=function(e){var t=this,n=Object.getOwnPropertyNames(this.vb);n.forEach(function(n){delete t.vb[n][e]})},e}(),js=function(e){function t(t,n,r,i,o,s){return e.call(this,t,rt.Types.INDEX,n,r,i,o,s)||this}return r(t,e),t.prototype.wb=function(e,t){this.fa(jo.handleInsert(this.W,e,t))},t.prototype.xb=function(e,t){this.fa(jo.handleRemove(this.W,e,t))},t.prototype.yb=function(e,t){this.fa(jo.handleReorder(this.W,e,t))},t}(rt),ks=function(e){function t(t,n,r,i,o,s){return e.call(this,t,rt.Types.RANGE,n,r,i,o,s)||this}return r(t,e),t.prototype.wb=function(e,t){this.fa(Fo.handleInsert(this.W,e,t))},t.prototype.xb=function(e,t){this.fa(Fo.handleRemove(this.W,e,t))},t.prototype.yb=function(e,t){this.fa(Fo.handleReorder(this.W,e,t))},t}(rt),Ys=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t,rt.Types.ELEMENT,n,r,i,o,s)||this;return a.zb=function(e){a.Ab(e.src)},a}return r(t,e),t.prototype.da=function(t){for(var n=0,r=this.values();n<r.length;n++){var i=r[n];i.removeListener(qs.Events.DETACHED,this.zb)}for(var o=0,s=t;o<s.length;o++){var a=s[o];a.addListener(qs.Events.DETACHED,this.zb)}e.prototype.da.call(this,t)},t.prototype.ea=function(){for(var t=0,n=this.values();t<n.length;t++){var r=n[t];r.removeListener(qs.Events.DETACHED,this.zb)}e.prototype.ea.call(this)},t.prototype.Ab=function(e){var t=this.W.indexOf(e,0);if(t>-1){var n=this.W.slice(0);n.splice(t,1),this.da(n)}},t}(rt),Qs=function(e){function t(t,n,r,i,o,s){return e.call(this,t,rt.Types.PROPERTY,n,r,i,o,s)||this}return r(t,e),t.prototype.Bb=function(e){var t=this.W.indexOf(e,0);if(t>-1){var n=this.W.slice(0);n.splice(t,1),this.da(n)}},t}(rt),Fs=function(){function e(e,t,n){this.Cb=new Gs,this.Db={},this.Eb=t,this.Z=e,this.Fb=n}return e.prototype.get=function(e,t){return this.Cb.get(e,t)},e.prototype.getAll=function(e){return this.Cb.getAll(e)},e.prototype.removeAll=function(){this.getAll().forEach(function(e){return e.ba()})},e.prototype.addLocalReference=function(e){var t=e.reference().key();if(void 0!==this.Db[t])throw new Error("Local reference already set for key: "+t);this.Db[t]=e,this.Cb.put(e.reference())},e.prototype.removeLocalReference=function(e){var t=this.Db[e];void 0!==t&&t.dispose()},e.prototype.removeAllLocalReferences=function(){var e=this,t=Object.getOwnPropertyNames(this.Db);t.forEach(function(t){e.removeLocalReference(t)})},e.prototype.getLocalReference=function(e){return this.Db[e]},e.prototype.localReferences=function(){return At.copy(this.Db)},e.prototype.handleRemoteReferenceEvent=function(e){switch(e.type){case je.REFERENCE_PUBLISHED:this.Gb(e);break;case je.REFERENCE_SET:this.Hb(e);break;case je.REFERENCE_CLEARED:this.Ib(e);break;case je.REFERENCE_UNPUBLISHED:this.Jb(e);break;default:throw new Error("Invalid reference event.")}},e.prototype.ca=function(e){this.Cb.remove(e.sessionId(),e.key()),e.isLocal()&&delete this.Db[e.key()]},e.prototype.Gb=function(e){if(this.Eb.indexOf(e.referenceType)<0)throw new Error("Invalid reference type: "+e.referenceType);var t,n=e.username;switch(e.referenceType){case rt.Types.INDEX:t=new js(this,e.key,this.Z,n,e.sessionId,(!1));break;case rt.Types.RANGE:t=new ks(this,e.key,this.Z,n,e.sessionId,(!1));break;case rt.Types.ELEMENT:t=new Ys(this,e.key,this.Z,n,e.sessionId,(!1));break;case rt.Types.PROPERTY:t=new Qs(this,e.key,this.Z,n,e.sessionId,(!1));break;default:throw new Error("Unknown reference type: "+e.referenceType)}void 0!==e.values&&this.Kb(t,e.values),this.Cb.put(t),this.Fb(t)},e.prototype.Jb=function(e){var t=this.Cb.remove(e.sessionId,e.key);t.ba()},e.prototype.Ib=function(e){var t=this.Cb.get(e.sessionId,e.key);t.ea()},e.prototype.Hb=function(e){var t=this.Cb.get(e.sessionId,e.key);this.Kb(t,e.values)},e.prototype.Kb=function(e,t){if(e.type()===rt.Types.ELEMENT){for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r],s=this.Z.Lb(o);void 0!==s&&n.push(s)}e.da(n)}else e.da(t)},e}(),Js={VALUE:"value",DETACHED:"detached",REFERENCE:"reference",MODEL_CHANGED:"model_changed"};Object.freeze(Js);var qs=function(e){function t(t,n,r,i,o){var s=e.call(this)||this;s.Mb=t,s.Nb=n,s.Ob=r,s.Pb=i;var a=function(e){s.Qb(e)};return s.U=new Fs(s,o,a),s.Mb.events().filter(function(e){return s.Pb.emitLocalEvents()||!e.local||e instanceof As}).subscribe(function(e){var t=Vs.convertEvent(e,s.Ob);s.T(t)}),s}return r(t,e),t.prototype.model=function(){return this.Pb},t.prototype.id=function(){return this.Mb.id()},t.prototype.type=function(){return this.Mb.type()},t.prototype.path=function(){return this.Mb.path()},t.prototype.parent=function(){var e=this.Mb.path().slice(0);e.pop();var t=this.Pb.elementAt(e);return t},t.prototype.relativePath=function(){var e=this.Mb.path().slice(0);return e.length>0?e.pop():null},t.prototype.removeFromParent=function(){this.Rb();var e=this.Mb.path().slice(0);if(0===e.length)throw new Error("Can not remove the root object from the model");var t=e.pop(),n=this.Pb.elementAt(e);n.Sb(t)},t.prototype.isDetached=function(){return this.Mb.isDetached()},t.prototype.isAttached=function(){return!this.Mb.isDetached()},t.prototype.value=function(e){return 0===arguments.length?this.Mb.data():(this.Rb(),void this.Mb.data(e))},t.prototype.toJSON=function(){return this.Mb.toJson()},t.prototype.reference=function(e,t){return this.U.get(e,t)},t.prototype.references=function(e){return this.U.getAll(e)},t.prototype.Tb=function(e){this.U.handleRemoteReferenceEvent(e)},t.prototype.Ub=function(e){this.Nb.Vb(e)},t.prototype.Rb=function(){if(!this.Pb.permissions().write)throw new Error("The user does not have write permissions for the model.");this.Wb()},t.prototype.Wb=function(){if(this.isDetached())throw Error("Can not perform actions on a detached RealTimeElement.")},t.prototype.Qb=function(e){this.T(new is(e,this))},t}(Ze);qs.Events=Js,Object.freeze(qs.Events);var Ws=function(){function e(){}return e}();Ws.OBJECT="object",Ws.ARRAY="array",Ws.STRING="string",Ws.NUMBER="number",Ws.BOOLEAN="boolean",Ws.NULL="null",Ws.UNDEFINED="undefined",Ws.DATE="date";var Ks=function(e){function t(t,n,r,i,o,s){var a=e.call(this)||this;return a.sessionId=o,a.username=s,a.Xb=n,a.Yb=t,a.Pb=i,a.Zb=r,a.Pb&&a.Pb.$b(a),a}return r(t,e),t.prototype.id=function(){return this.Xb},t.prototype.type=function(){return this.Yb},t.prototype.path=function(){return this.Zb()},t.prototype.model=function(){return this.Pb},t.prototype.isDetached=function(){return null===this.Pb},t.prototype._b=function(e){this.Pb.ac(this),this.Pb=null;var t=new As(this,e);this.T(t)},t.prototype.data=function(e){return 0===arguments.length?this.bc():void this.cc(e)},t.prototype.dc=function(e){this.T(e),this.T(new Ns(this,e.local,[],e,this.sessionId,this.username))},t.prototype.ec=function(){if(this.isDetached())throw Error("Can not perform actions on a detached ModelNode.")},t}(Ze);Ks.Events={DETACHED:"detached",NODE_CHANGED:"node_changed",OPERATION:"operation"};var Xs=function(e){function t(t,n,r,i){return e.call(this,Ws.UNDEFINED,t,n,void 0,r,i)||this}return r(t,e),t.prototype.dataValue=function(){},t.prototype.toJson=function(){},t.prototype.fc=function(e){throw new Error("Undefined values do not process operations")},t.prototype.bc=function(){},t.prototype.cc=function(e){throw new Error("Can not set the value on a Undefined type.")},t}(Ks);Xs.Events={DETACHED:Ks.Events.DETACHED};var $s=function(e){function t(t,n,r,i,o){return e.call(this,Ws.NULL,t,n,r,i,o)||this}return r(t,e),t.prototype.dataValue=function(){return{id:this.id(),type:vt.NULL,value:this.data()}},t.prototype.toJson=function(){return null},t.prototype.fc=function(e){throw new Error("Null values do not process operations")},t.prototype.bc=function(){return null},t.prototype.cc=function(e){throw new Error("Can not set the value on a Null type.")},t}(Ks);$s.Events={DETACHED:Ks.Events.DETACHED};var Zs=function(e){function t(t,n,r,i,o){var s=e.call(this,Ws.STRING,t.id,n,r,i,o)||this;return s.gc=t.value,s}return r(t,e),t.prototype.dataValue=function(){return{id:this.id(),type:vt.STRING,value:this.data()}},t.prototype.toJson=function(){return this.gc},t.prototype.insert=function(e,t){this.hc(e,t,!0,this.sessionId,this.username)},t.prototype.remove=function(e,t){this.ic(e,t,!0,this.sessionId,this.username)},t.prototype.length=function(){return this.gc.length},t.prototype.fc=function(e){var t=e.operation.type;if(t===Ct.STRING_INSERT)this.jc(e);else if(t===Ct.STRING_REMOVE)this.kc(e);else{if(t!==Ct.STRING_VALUE)throw new Error("Invalid operation!");this.lc(e)}},t.prototype.cc=function(e){this.mc(e,!0,this.sessionId,this.username)},t.prototype.bc=function(){return this.gc},t.prototype.hc=function(e,t,n,r,i){this.nc(e,t),this.gc=this.gc.slice(0,e)+t+this.gc.slice(e,this.gc.length);var o=new xs(this,n,e,t,r,i);this.dc(o)},t.prototype.ic=function(e,t,n,r,i){this.oc(e,t);var o=this.gc.slice(e,e+t);this.gc=this.gc.slice(0,e)+this.gc.slice(e+t,this.gc.length);var s=new Hs(this,n,e,o,r,i);this.dc(s)},t.prototype.mc=function(e,t,n,r){this.pc(e),this.gc=e;var i=new Bs(this,t,e,n,r);this.dc(i)},t.prototype.jc=function(e){var t=e.operation;this.hc(t.index,t.value,!1,e.sessionId,e.username)},t.prototype.kc=function(e){var t=e.operation;this.ic(t.index,t.value.length,!1,e.sessionId,e.username)},t.prototype.lc=function(e){var t=e.operation;this.mc(t.value,!1,e.sessionId,e.username)},t.prototype.nc=function(e,t){if(this.gc.length<e||e<0)throw new Error("Index out of bounds: "+e);if("string"!=typeof t)throw new Error("Value must be a string")},t.prototype.oc=function(e,t){if(this.gc.length<e+t||e<0)throw new Error("Index out of bounds!")},t.prototype.pc=function(e){if("string"!=typeof e)throw new Error("Value must be a string")},t}(Ks);Zs.Events={INSERT:"insert",REMOVE:"remove",VALUE:"value",DETACHED:Ks.Events.DETACHED,MODEL_CHANGED:Ks.Events.MODEL_CHANGED};var ea=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t,n,r,i,o,s)||this;return a.qc=function(e){var t=e.relativePath.slice(0);t.unshift(a.rc.get(e.src.id()));var n=new Ns(a,e.local,t,e.childEvent,a.sessionId,a.username);a.T(n)},a.rc=new Map,a}return r(t,e),t.prototype.valueAt=function(e){var t=Array.isArray(e)?e:arguments;return 0===t.length?this:this.sc(t)},t.prototype._b=function(t){this.tc(t),e.prototype._b.call(this,t)},t.prototype.uc=function(){return oa.create(void 0,function(){return null},void 0,this.sessionId,this.username)},t}(Ks);ea.Events={NODE_CHANGED:Ks.Events.NODE_CHANGED};var ta=function(e){function t(n,r,i,o,s,a){var u=e.call(this,Ws.ARRAY,n.id,r,i,o,s)||this;u.vc=[],u.wc=a;for(var c=0;c<n.children.length;c++){var E=n.children[c];u.rc.set(E.id,c),u.vc.push(oa.create(E,u.xc(E.id),i,o,s,a))}return u.vc.forEach(function(e){e.on(t.Events.NODE_CHANGED,u.qc)}),u}return r(t,e),t.prototype.dataValue=function(){var e=this.vc.map(function(e){return e.dataValue()});return{id:this.id(),type:vt.ARRAY,children:e}},t.prototype.toJson=function(){var e=[];return this.forEach(function(t){e.push(t.toJson())}),e},t.prototype.get=function(e){return this.yc(e,!1),this.vc[e]},t.prototype.set=function(e,t){this.yc(e,!1);var n=this.wc.createDataValue(t);return this.zc(e,n,!0,this.sessionId,this.username),this.get(e)},t.prototype.insert=function(e,t){this.yc(e,!0);var n=this.wc.createDataValue(t);return this.hc(e,n,!0,this.sessionId,this.username),this.get(e)},t.prototype.remove=function(e){this.yc(e,!1);
var t=this.get(e);return this.ic(e,!0,this.sessionId,this.username),t},t.prototype.reorder=function(e,t){this.yc(e,!1,"fromIndex"),this.yc(t,!1,"toIndex"),this.Ac(e,t,!0,this.sessionId,this.username)},t.prototype.push=function(e){return this.insert(this.vc.length,e)},t.prototype.pop=function(){return this.remove(this.vc.length-1)},t.prototype.unshift=function(e){return this.insert(0,e)},t.prototype.shift=function(){return this.remove(0)},t.prototype.length=function(){return this.vc.length},t.prototype.some=function(e){return this.vc.some(e)},t.prototype.every=function(e){return this.vc.every(e)},t.prototype.find=function(e){return this.vc.find(e)},t.prototype.findIndex=function(e){return this.vc.findIndex(e)},t.prototype.forEach=function(e){this.vc.forEach(e)},t.prototype.fc=function(e){var t=e.operation.type;if(t===Ct.ARRAY_INSERT)this.jc(e);else if(t===Ct.ARRAY_REORDER)this.Bc(e);else if(t===Ct.ARRAY_REMOVE)this.kc(e);else if(t===Ct.ARRAY_SET)this.lc(e);else{if(t!==Ct.ARRAY_VALUE)throw new Error("Invalid operation!");this.Cc(e)}},t.prototype.bc=function(){var e=[];return this.forEach(function(t){e.push(t.data())}),e},t.prototype.cc=function(e){var t=this,n=e.map(function(e){return t.wc.createDataValue(e)});this.mc(n,!0,this.sessionId,this.username)},t.prototype.tc=function(e){var n=this;this.rc.clear(),this.forEach(function(r){r._b(e),r.removeListener(t.Events.NODE_CHANGED,n.qc)})},t.prototype.sc=function(e){if(0===e.length)return this;var t=e[0],n=this.vc[t];return void 0===n?this.uc():e.length>1?n.type()===Ws.OBJECT||n.type()===Ws.ARRAY?n.valueAt(e.slice(1,e.length)):this.uc():n},t.prototype.yc=function(e,t,n){if(e<0){var r=n?n:"index";throw new Error(r+" must be >= 0: "+e)}if(!t&&e>=this.vc.length||t&&e>this.vc.length){var r=n?n:"index",i=t?"<=":"<";throw new Error(r+" must be "+i+" the length of the array: "+e)}},t.prototype.hc=function(e,n,r,i,o){this.nc(e,n),this.rc.set(n.id,e);var s=oa.create(n,this.xc(n.id),this.Pb,this.sessionId,this.username,this.wc);s.on(t.Events.NODE_CHANGED,this.qc),this.vc.splice(e,0,s),this.Dc(e);var a=new Is(this,r,e,s,i,o);this.dc(a)},t.prototype.zc=function(e,n,r,i,o){this.Ec(e,n);var s=this.vc[e];s.removeListener(t.Events.NODE_CHANGED,this.qc),this.rc.set(n.id,e);var a=oa.create(n,this.xc(n.id),this.model(),this.sessionId,this.username,this.wc);a.on(t.Events.NODE_CHANGED,this.qc),this.vc[e]=a,this.Dc(e),s._b(r);var u=new Cs(this,r,e,a,i,o);this.dc(u)},t.prototype.ic=function(e,n,r,i){this.oc(e);var o=this.vc[e];o.removeListener(t.Events.NODE_CHANGED,this.qc),this.vc.splice(e,1),this.Dc(e),o._b(n);var s=new ms(this,n,e,r,i);this.dc(s)},t.prototype.mc=function(e,n,r,i){var o=this;this.pc(e),this.tc(n),this.vc=e.map(function(e,t){return o.rc.set(e.id,t),oa.create(e,o.xc(e.id),o.model(),o.sessionId,o.username,o.wc)}),this.vc.forEach(function(e){e.on(t.Events.NODE_CHANGED,o.qc)});var s=new ws(this,n,this.data(),r,i);this.dc(s)},t.prototype.Ac=function(e,t,n,r,i){this.Fc(e,t);var o=this.vc[e];this.vc.splice(e,1),this.vc.splice(t,0,o),this.Dc(Math.min(e,t));var s=new gs(this,n,e,t,r,i);this.dc(s)},t.prototype.jc=function(e){var t=e.operation;this.hc(t.index,t.value,!1,e.sessionId,e.username)},t.prototype.Bc=function(e){var t=e.operation;this.Ac(t.fromIndex,t.toIndex,!1,e.sessionId,e.username)},t.prototype.kc=function(e){var t=e.operation;this.ic(t.index,!1,e.sessionId,e.username)},t.prototype.lc=function(e){var t=e.operation;this.zc(t.index,t.value,!1,e.sessionId,e.username)},t.prototype.Cc=function(e){var t=e.operation;this.mc(t.value,!1,e.sessionId,e.username)},t.prototype.xc=function(e){var t=this;return function(){var n=t.path();return n.push(t.rc.get(e)),n}},t.prototype.nc=function(e,t){if(this.vc.length<e||e<0)throw new Error("Index out of bounds!");if("undefined"==typeof t||"function"==typeof t)throw new Error("Invalid value for insert!")},t.prototype.Fc=function(e,t){if(this.vc.length<=e||e<0||this.vc.length<=t||t<0)throw new Error("Index out of bounds!")},t.prototype.oc=function(e){if(this.vc.length<=e||e<0)throw new Error("Index out of bounds!")},t.prototype.Ec=function(e,t){if(this.vc.length<=e||e<0)throw new Error("Index out of bounds!");if("undefined"==typeof t||"function"==typeof t)throw new Error("Illegal argument!")},t.prototype.pc=function(e){if(!Array.isArray(e))throw new Error("Illegal argument!")},t.prototype.Dc=function(e){for(var t=e;t<this.vc.length;t++){var n=this.vc[t];this.rc.set(n.id(),t)}},t}(ea);ta.Events={INSERT:"insert",REMOVE:"remove",SET:"set",REORDER:"reorder",VALUE:"value",DETACHED:Ks.Events.DETACHED,NODE_CHANGED:ea.Events.NODE_CHANGED};var na=function(e){function t(t,n,r,i,o){var s=e.call(this,Ws.NUMBER,t.id,n,r,i,o)||this;return s.gc=t.value,s}return r(t,e),t.prototype.dataValue=function(){return{id:this.id(),type:vt.NUMBER,value:this.data()}},t.prototype.toJson=function(){return this.gc},t.prototype.add=function(e){this.Gc(e,!0)},t.prototype.subtract=function(e){this.add(-e)},t.prototype.increment=function(){this.add(1)},t.prototype.decrement=function(){this.add(-1)},t.prototype.fc=function(e){var t=e.operation.type;if(t===Ct.NUMBER_ADD)this.Hc(e);else{if(t!==Ct.NUMBER_VALUE)throw new Error("Invalid operation!");this.lc(e)}},t.prototype.cc=function(e){this.zc(e,!0,this.sessionId,this.username)},t.prototype.bc=function(){return this.gc},t.prototype.Gc=function(e,t){if(this.Ic(e),0!==e){this.gc+=e;var n=new Ds(this,t,e,this.sessionId,this.username);this.dc(n)}},t.prototype.zc=function(e,t,n,r){if(isNaN(e))throw new Error("Value is NaN");this.gc=e;var i=new Ms(this,t,e,this.sessionId,this.username);this.dc(i)},t.prototype.Hc=function(e){var t=e.operation;this.Gc(t.value,!1)},t.prototype.lc=function(e){var t=e.operation;this.zc(t.value,!1,e.sessionId,e.username)},t.prototype.Ic=function(e){if(isNaN(e))throw new Error("Value is NaN")},t}(Ks);na.Events={DELTA:"delta",VALUE:"value",DETACHED:Ks.Events.DETACHED,MODEL_CHANGED:Ks.Events.MODEL_CHANGED};var ra=function(e){function t(t,n,r,i,o){var s=e.call(this,Ws.BOOLEAN,t.id,n,r,i,o)||this;return s.gc=t.value,s}return r(t,e),t.prototype.dataValue=function(){return{id:this.id(),type:vt.BOOLEAN,value:this.data()}},t.prototype.toJson=function(){return this.gc},t.prototype.fc=function(e){var t=e.operation.type;if(t!==Ct.BOOLEAN_VALUE)throw new Error("Invalid operation!");this.lc(e)},t.prototype.cc=function(e){this.mc(e,!0,this.sessionId,this.username)},t.prototype.bc=function(){return this.gc},t.prototype.mc=function(e,t,n,r){this.pc(e),this.gc=e;var i=new bs(this,t,e,n,r);this.dc(i)},t.prototype.lc=function(e){var t=e.operation;this.mc(t.value,!1,e.sessionId,e.username)},t.prototype.pc=function(e){if("boolean"!=typeof e)throw new Error("Value must be a boolean")},t}(Ks);ra.Events={VALUE:"value",DETACHED:Ks.Events.DETACHED,MODEL_CHANGED:Ks.Events.MODEL_CHANGED};var ia=function(e){function t(t,n,r,i,o){var s=e.call(this,Ws.DATE,t.id,n,r,i,o)||this;return s.gc=t.value,s}return r(t,e),t.prototype.dataValue=function(){return{id:this.id(),type:vt.DATE,value:this.data()}},t.prototype.toJson=function(){return{$convergenceType:"date",value:this.gc.toISOString()}},t.prototype.fc=function(e){var t=e.operation.type;if(t!==Ct.DATE_VALUE)throw new Error("Invalid operation!");this.lc(e)},t.prototype.cc=function(e){this.mc(e,!0,this.sessionId,this.username)},t.prototype.bc=function(){return this.gc},t.prototype.mc=function(e,t,n,r){this.pc(e),this.gc=e;var i=new zs(this,t,e,n,r);this.dc(i)},t.prototype.lc=function(e){var t=e.operation;this.mc(t.value,!1,e.sessionId,e.username)},t.prototype.pc=function(e){if(!(e instanceof Date))throw new Error("Value must be a Date")},t}(Ks);ia.Events={VALUE:"value",DETACHED:Ks.Events.DETACHED,MODEL_CHANGED:Ks.Events.MODEL_CHANGED};var oa=function(){function e(){}return e.create=function(e,t,n,r,i,o){if(void 0===e)return new Xs((void 0),t,r,i);var s=e.type;if("null"===s)return new $s(e.id,t,n,r,i);if("string"===s)return new Zs(e,t,n,r,i);if("array"===s)return new ta(e,t,n,r,i,o);if("object"===s)return new sa(e,t,n,r,i,o);if("number"===s)return new na(e,t,n,r,i);if("boolean"===s)return new ra(e,t,n,r,i);if("date"===s)return new ia(e,t,n,r,i);throw new Error("Invalid data type: "+s)},e}(),sa=function(e){function t(n,r,i,o,s,a){var u=e.call(this,Ws.OBJECT,n.id,r,i,o,s)||this;return u.dataValueFactory=a,u.vc=new Map,Object.getOwnPropertyNames(n.children).forEach(function(e){var t=n.children[e];u.rc.set(t.id,e),u.vc.set(e,oa.create(t,u.xc(t.id),i,u.sessionId,u.username,u.dataValueFactory))}),u.vc.forEach(function(e){e.on(t.Events.NODE_CHANGED,u.qc)}),u}return r(t,e),t.prototype.dataValue=function(){var e={};return this.vc.forEach(function(t,n){e[n]=t.dataValue()}),{id:this.id(),type:vt.OBJECT,children:e}},t.prototype.toJson=function(){var e={};return this.forEach(function(t,n){e[n]=t.toJson()}),e},t.prototype.get=function(e){return rs.assertString(e,"key"),this.sc([e])},t.prototype.set=function(e,t){var n=this.dataValueFactory.createDataValue(t);return this.zc(e,n,!0,this.sessionId,this.username),this.get(e)},t.prototype.remove=function(e){var t=this.get(e);return this.ic(e,!0,this.sessionId,this.username),t},t.prototype.keys=function(){var e=[];return this.vc.forEach(function(t,n){e.push(n)}),e},t.prototype.hasKey=function(e){return this.vc.has(e)},t.prototype.forEach=function(e){this.vc.forEach(function(t,n){e(t,n)})},t.prototype.fc=function(e){switch(e.operation.type){case Ct.OBJECT_ADD:this.Jc(e);break;case Ct.OBJECT_SET:this.Kc(e);break;case Ct.OBJECT_REMOVE:this.Lc(e);break;case Ct.OBJECT_VALUE:this.lc(e);break;default:throw new Error("Invalid operation for RealTimeObject")}},t.prototype.bc=function(){var e={};return this.forEach(function(t,n){e[n]=t.data()}),e},t.prototype.cc=function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=this.dataValueFactory.createDataValue(e[n]);t[n]=r}this.mc(t,!0,this.sessionId,this.username)},t.prototype.sc=function(e){if(0===e.length)return this;var t=e[0],n=this.vc.get(t);return void 0===n?this.uc():e.length>1?n.type()===Ws.OBJECT||n.type()===Ws.ARRAY?n.valueAt(e.slice(1,e.length)):this.uc():n},t.prototype.tc=function(e){this.forEach(function(t){t._b(e)})},t.prototype.xc=function(e){var t=this;return function(){var n=t.path();return n.push(t.rc.get(e)),n}},t.prototype.zc=function(e,n,r,i,o){rs.assertString(e,"key"),this.vc.has(e)&&(this.vc.get(e).removeListener(t.Events.NODE_CHANGED,this.qc),this.vc.get(e)._b(r));var s=oa.create(n,this.xc(n.id),this.Pb,this.sessionId,this.username,this.dataValueFactory);s.on(t.Events.NODE_CHANGED,this.qc),this.vc.set(e,s),this.rc.set(s.id(),e);var a=new Ls(this,r,e,s,this.sessionId,this.username);this.dc(a)},t.prototype.ic=function(e,n,r,i){if(rs.assertString(e,"key"),this.vc.has(e)){this.rc.delete(e),this.vc.get(e).removeListener(t.Events.NODE_CHANGED,this.qc),this.vc.get(e)._b(n),this.vc.delete(e);var o=new Ps(this,n,e,this.sessionId,this.username);this.dc(o)}},t.prototype.mc=function(e,n,r,i){var o=this,s=this.vc;this.vc=new Map;for(var a in e)if(e.hasOwnProperty(a)){var u=e[a];this.rc.set(u.id,a),this.vc.set(a,oa.create(u,this.xc(u.id),this.model(),this.sessionId,this.username,this.dataValueFactory))}this.vc.forEach(function(e){e.on(t.Events.NODE_CHANGED,o.qc)});var c=new Us(this,n,this.data(),this.sessionId,this.username);this.dc(c),s.forEach(function(e){e._b(n),e.removeListener(t.Events.NODE_CHANGED,o.qc)})},t.prototype.Jc=function(e){var t=e.operation;this.zc(t.prop,t.value,!1,e.sessionId,e.username)},t.prototype.Kc=function(e){var t=e.operation;this.zc(t.prop,t.value,!1,e.sessionId,e.username)},t.prototype.Lc=function(e){var t=e.operation;this.ic(t.prop,!1,e.sessionId,e.username)},t.prototype.lc=function(e){var t=e.operation;this.mc(t.value,!1,e.sessionId,e.username)},t}(ea);sa.Events={SET:"set",REMOVE:"remove",VALUE:"value",DETACHED:Ks.Events.DETACHED,NODE_CHANGED:Ks.Events.NODE_CHANGED,OPERATION:Ks.Events.OPERATION};var aa=function(e){function t(t,n,r,i){var o=e.call(this)||this;o.sessionId=t,o.username=n,o.valueIdPrefix=r,o.Mc=new Map,o.Nc=0;var s=new ns(function(){return o.valueIdPrefix+o.Nc++});return o.gc=new sa(i,function(){return[]},o,t,n,s),o}return r(t,e),t.prototype.root=function(){return this.gc},t.prototype.valueAt=function(e){var t=Array.isArray(e)?e:arguments;return this.gc.valueAt(t)},t.prototype.Lb=function(e){return this.Mc.get(e)},t.prototype.$b=function(e){this.Mc.set(e.id(),e)},t.prototype.ac=function(e){this.Mc.delete(e.id())},t.prototype.Oc=function(e){var t=this.Mc.get(e.operation.id);t&&t.fc(e)},t}(Ze);aa.Events={DELETED:"deleted",MODIFIED:"modified"},Object.freeze(aa.Events);var ua=function(){function e(){this.Pc=new Map}return e.prototype.wrap=function(e){var t=this,n=this.Pc.get(e.id());return void 0===n&&(n=this.Qc(e),this.Pc.set(e.id(),n),e.on(Ks.Events.DETACHED,function(){t.Pc.delete(e.id())})),n},e}(),ca=Object.assign({INSERT:"insert",REMOVE:"remove",SET:"set",REORDER:"reorder"},Js);Object.freeze(ca);var Ea=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[])||this;return o.Mb=t,o.Nb=n,o.Mb.events().subscribe(function(e){if(e.local)if(e instanceof Is)o.Ub(new gt(o.id(),(!1),e.index,e.src.get(e.index).dataValue()));else if(e instanceof ms)o.Ub(new Mt(o.id(),(!1),e.index));else if(e instanceof gs)o.Ub(new bt(o.id(),(!1),e.fromIndex,e.toIndex));else if(e instanceof Cs){var t=e.index;o.Ub(new Dt(o.id(),(!1),t,e.src.get(t).dataValue()))}else e instanceof ws&&o.Ub(new Lt(o.id(),(!1),e.src.dataValue().children))}),o}return r(t,e),t.prototype.get=function(e){return this.Ob.wrap(this.Mb.get(e))},t.prototype.set=function(e,t){return this.Rb(),this.Ob.wrap(this.Mb.set(e,t))},t.prototype.insert=function(e,t){return this.Rb(),this.Ob.wrap(this.Mb.insert(e,t))},t.prototype.remove=function(e){return this.Rb(),this.Ob.wrap(this.Mb.remove(e))},t.prototype.reorder=function(e,t){this.Rb(),this.Mb.reorder(e,t)},t.prototype.push=function(e){return this.Rb(),this.Ob.wrap(this.Mb.push(e))},t.prototype.pop=function(){return this.Rb(),this.Mb.pop()},t.prototype.unshift=function(e){return this.Rb(),this.Ob.wrap(this.Mb.unshift(e))},t.prototype.shift=function(){return this.Rb(),this.Mb.shift()},t.prototype.length=function(){return this.Mb.length()},t.prototype.some=function(e){var t=this;return this.Mb.some(function(n,r){return e(t.Ob.wrap(n),r)})},t.prototype.every=function(e){var t=this;return this.Mb.every(function(n,r){return e(t.Ob.wrap(n),r)})},t.prototype.find=function(e){var t=this,n=this.Mb.find(function(n,r){return e(t.Ob.wrap(n),r)});return void 0===n?void 0:this.Ob.wrap(n)},t.prototype.findIndex=function(e){var t=this;return this.Mb.findIndex(function(n,r){return e(t.Ob.wrap(n),r)})},t.prototype.forEach=function(e){var t=this;this.Mb.forEach(function(n,r){e(t.Ob.wrap(n),r)})},t.prototype.elementAt=function(e){return this.Ob.wrap(this.Mb.valueAt(e))},t.prototype.Sb=function(e){if("number"!=typeof e)throw new Error("The relative path of a child must be a number: "+typeof e);this.remove(e)},t.prototype.Tb=function(e){throw new Error("Arrays to do have references yet.")},t}(qs);Ea.Events=ca;var ha=function(e){function t(t,n){var r=e.call(this)||this;return r.S(t.events()),r.Rc=t,r.Sc=!1,r.Nb=n,r}return r(t,e),t.prototype.type=function(){return this.Rc.type()},t.prototype.key=function(){return this.Rc.key()},t.prototype.source=function(){return this.Rc.source()},t.prototype.isLocal=function(){return!0},t.prototype.username=function(){return this.Rc.username()},t.prototype.sessionId=function(){return this.Rc.sessionId()},t.prototype.isDisposed=function(){return this.Rc.isDisposed()},t.prototype.value=function(){return this.Rc.value()},t.prototype.values=function(){return this.Rc.values()},t.prototype.reference=function(){return this.Rc},t.prototype.share=function(){this.Tc(),this.Sc=!0,this.Nb.onShare(this)},t.prototype.unshare=function(){this.Tc(),this.Sc=!1,this.Nb.onUnshare(this)},t.prototype.isShared=function(){return this.Sc},t.prototype.set=function(e){this.Tc(),e instanceof Array?this.Rc.da(e):this.Rc.da([e]),this.isShared()&&this.Nb.onSet(this)},t.prototype.clear=function(){this.Tc(),this.Rc.ea(),this.Nb.onClear(this)},t.prototype.isSet=function(){return this.Rc.isSet()},t.prototype.dispose=function(){this.Tc(),this.unshare(),this.Rc.ba(),this.Nb=null},t.prototype.Tc=function(){if(this.type()!==rt.Types.ELEMENT&&this.reference().source().isDetached())throw new Error("The source model is detached")},t}(Ze);ha.Events=rt.Events;var fa=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(ha),pa=Object.assign({SET:"set",REMOVE:"remove"},Js);Object.freeze(pa);var da=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[rt.Types.PROPERTY])||this;return o.Mb=t,o.Nb=n,o.Ob=r,o.Mb.events().subscribe(function(e){return o.Uc(e)}),o}return r(t,e),t.prototype.get=function(e){return this.Ob.wrap(this.Mb.get(e))},t.prototype.set=function(e,t){this.Rb();var n,r=this.Mb.hasKey(e),i=this.Mb.set(e,t);return n=r?new zt(this.id(),(!1),e,i.dataValue()):new Ht(this.id(),(!1),e,i.dataValue()),this.Ub(n),this.Ob.wrap(i)},t.prototype.remove=function(e){return this.Rb(),this.Ob.wrap(this.Mb.remove(e))},t.prototype.keys=function(){return this.Mb.keys()},t.prototype.hasKey=function(e){return this.Mb.hasKey(e)},t.prototype.forEach=function(e){var t=this;this.Mb.forEach(function(n,r){e(t.Ob.wrap(n),r)})},t.prototype.elementAt=function(e){return this.Ob.wrap(this.Mb.valueAt(e))},t.prototype.Sb=function(e){if("string"!=typeof e)throw new Error("The relative path of a child must be a string: "+typeof e);this.remove(e)},t.prototype.propertyReference=function(e){var t=this.U.getLocalReference(e);if(void 0!==t){if(t.reference().type()!==rt.Types.PROPERTY)throw new Error("A reference with this key already exists, but is not an index reference");return t}var n=new Qs(this.U,e,this,this.Mb.username,this.Mb.sessionId,(!0)),r=new fa(n,this.Nb.referenceEventCallbacks);return this.U.addLocalReference(r),r},t.prototype.Uc=function(e){e instanceof Us?(e.local&&this.Ub(new Vt(this.id(),(!1),this.Mb.dataValue().children)),this.U.getAll().forEach(function(e){e.ba()}),this.U.removeAll(),this.U.removeAllLocalReferences()):e instanceof Ps?(e.local&&this.Ub(new Bt(this.id(),(!1),e.key)),this.U.getAll().forEach(function(t){t instanceof Qs&&t.Bb(e.key)})):e instanceof Ls&&(e.local,this.U.getAll().forEach(function(t){t instanceof Qs&&t.Bb(e.key)}))},t}(qs);da.Events=pa;var la=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[])||this;return o.Mb.events().subscribe(function(e){e.local&&e instanceof bs&&o.Ub(new Pt(o.id(),(!1),e.value))}),o}return r(t,e),t.prototype.Tb=function(e){throw new Error("Boolean values do not process references")},t}(qs);la.Events=Js;var va=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,[])||this}return r(t,e),t.prototype.Tb=function(e){throw new Error("Null values do not process references")},t}(qs);va.Events=Js;var Sa=Object.assign({DELTA:"delta"},Js);Object.freeze(Sa);var _a=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[])||this;return o.Mb=t,o.Nb=n,o.Mb.events().subscribe(function(e){e.local&&(e instanceof Ms?o.Ub(new xt(o.id(),(!1),e.value)):e instanceof Ds&&o.Ub(new Ut(o.id(),(!1),e.value)))}),o}return r(t,e),t.prototype.add=function(e){this.Rb(),this.Mb.add(e)},t.prototype.subtract=function(e){this.Rb(),this.Mb.subtract(e)},t.prototype.increment=function(){this.Rb(),this.Mb.increment()},t.prototype.decrement=function(){this.Rb(),this.Mb.decrement()},t.prototype.Tb=function(e){throw new Error("Number values do not process references")},t}(qs);_a.Events=Sa;var Ra=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(ha),ya=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(ha),Ta=Object.assign({INSERT:"insert",REMOVE:"remove"},Js);Object.freeze(Ta);var Oa=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[rt.Types.INDEX,rt.Types.RANGE])||this;return o.Mb=t,o.Nb=n,o.Mb.events().subscribe(function(e){return o.Vc(e)}),o}return r(t,e),t.prototype.insert=function(e,t){this.Rb(),this.Mb.insert(e,t)},t.prototype.remove=function(e,t){this.Rb(),this.Mb.remove(e,t)},t.prototype.length=function(){return this.Mb.length()},t.prototype.indexReference=function(e){var t=this.U.getLocalReference(e);if(void 0!==t){if(t.reference().type()!==rt.Types.INDEX)throw new Error("A reference with this key already exists, but is not an index reference");return t}var n=new js(this.U,e,this,this.Mb.username,this.Mb.sessionId,(!0)),r=new Ra(n,this.Nb.referenceEventCallbacks);return this.U.addLocalReference(r),r},t.prototype.rangeReference=function(e){var t=this.U.getLocalReference(e);if(void 0!==t){if(t.reference().type()!==rt.Types.RANGE)throw new Error("A reference with this key already exists, but is not a range reference");return t}var n=new ks(this.U,e,this,this.Mb.username,this.Mb.sessionId,(!0)),r=new ya(n,this.Nb.referenceEventCallbacks);return this.U.addLocalReference(r),r},t.prototype.Vc=function(e){e instanceof xs?(e.local&&this.Ub(new Gt(this.id(),(!1),e.index,e.value)),this.U.getAll().forEach(function(t){t instanceof js?t.wb(e.index,e.value.length):t instanceof ks&&t.wb(e.index,e.value.length)})):e instanceof Hs?(e.local&&this.Ub(new jt(this.id(),(!1),e.index,e.value)),this.U.getAll().forEach(function(t){t instanceof js?t.xb(e.index,e.value.length):t instanceof ks&&t.xb(e.index,e.value.length)})):e instanceof Bs&&(e.local&&this.Ub(new kt(this.id(),(!1),e.value)),this.U.getAll().forEach(function(e){e.ba()}),this.U.removeAll())},t}(qs);Oa.Events=Ta,Object.freeze(Oa.Events);var Aa=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,[])||this}return r(t,e),t.prototype.path=function(){return null},t.prototype.relativePath=function(){return null},t.prototype.parent=function(){return null},t.prototype.removeFromParent=function(){},t.prototype.Tb=function(e){throw new Error("Undefined values do not process references")},t.prototype.cc=function(e){throw new Error("Can not set the value on a Undefined type.")},t}(qs);Aa.Events=Js;var Na=function(e){function t(t,n,r,i){var o=e.call(this,t,n,r,i,[])||this;return o.Mb.events().subscribe(function(e){e.local&&e instanceof zs&&o.Ub(new Yt(o.id(),(!1),e.value))}),o}return r(t,e),t.prototype.Tb=function(e){throw new Error("Date values do not process references")},t}(qs);Na.Events=Js;var Ia=function(e){function t(t,n){var r=e.call(this)||this;return r.Nb=t,r.Pb=n,r}return r(t,e),t.prototype.Qc=function(e){switch(e.type()){case Ws.ARRAY:return new Ea(e,this.Nb,this,this.Pb);case Ws.OBJECT:return new da(e,this.Nb,this,this.Pb);case Ws.BOOLEAN:return new la(e,this.Nb,this,this.Pb);case Ws.NULL:return new va(e,this.Nb,this,this.Pb);case Ws.NUMBER:return new _a(e,this.Nb,this,this.Pb);case Ws.STRING:return new Oa(e,this.Nb,this,this.Pb);case Ws.UNDEFINED:return new Aa(e,this.Nb,this,this.Pb);case Ws.DATE:return new Na(e,this.Nb,this,this.Pb);default:return null}},t}(ua),ma=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(ha),Ca=function(){function e(e,t,n,r,i){this.sessionId=e,this.username=t,this.version=n,this.timestamp=r,this.operation=i,Object.freeze(this)}return e}(),ga=function(){function e(e,t){this.username=e,this.sessionId=t,Object.freeze(this)}return e}(),wa={CLOSED:"closed",DELETED:"deleted",VERSION_CHANGED:"version_changed"};Object.freeze(wa);var ba=function(){function e(t,n){this.src=t,this.collaborator=n,this.name=e.NAME,Object.freeze(this)}return e}();ba.NAME="collaborator_opened";var Ma=function(){function e(t,n){this.src=t,this.collaborator=n,this.name=e.NAME,Object.freeze(this)}return e}();Ma.NAME="collaborator_closed";var Da=function(){function e(e,t){this.Wc=e,this.ta=t}return Object.defineProperty(e.prototype,"modelId",{get:function(){return this.Wc},enumerable:!0,configurable:!0}),e.prototype.getPermissions=function(){var e=this,t={type:je.GET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc};return this.ta.request(t).then(function(t){return t.users.get(e.ta.session().username())})},e.prototype.setOverridesCollection=function(e){var t={type:je.SET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc,overridesCollection:e,allUsers:!1,users:new Map};return this.ta.request(t).then(function(){})},e.prototype.getOverridesCollection=function(){var e={type:je.GET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc};return this.ta.request(e).then(function(e){return e.overridesCollection})},e.prototype.getWorldPermissions=function(){var e={type:je.GET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc};return this.ta.request(e).then(function(e){return e.world})},e.prototype.setWorldPermissions=function(e){var t={type:je.SET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc,world:e,allUsers:!1,users:new Map};return this.ta.request(t).then(function(){})},e.prototype.getAllUserPermissions=function(){var e={type:je.GET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc};return this.ta.request(e).then(function(e){return e.users})},e.prototype.setAllUserPermissions=function(e){if(!(e instanceof Map)){var t=e,n=new Map;Object.keys(t).forEach(function(e){n.set(e,t[e])}),e=n}var r={type:je.SET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc,users:e,allUsers:!0};return this.ta.request(r).then(function(){})},e.prototype.getUserPermissions=function(e){var t={type:je.GET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc};return this.ta.request(t).then(function(t){return t.users.get(e)})},e.prototype.setUserPermissions=function(e,t){var n=new Map;n.set(e,t);var r={type:je.SET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc,users:n,allUsers:!1};return this.ta.request(r).then(function(){})},e.prototype.removeUserPermissions=function(e){var t=new Map;t.set(e,null);var n={type:je.SET_MODEL_PERMISSIONS_REQUEST,modelId:this.Wc,users:t,allUsers:!1};return this.ta.request(n).then(function(){})},e}(),La=Object.assign({MODIFIED:"modified",COMMITTED:"committed",COLLABORATOR_OPENED:ba.NAME,COLLABORATOR_CLOSED:Ma.NAME,REFERENCE:is.NAME,PERMISSIONS_CHANGED:os.NAME},wa),Pa=function(e){function t(r,i,o,s,a,u,c,E,h,f,p,d,l,v){var S=e.call(this)||this;S.Xc=!1,S.Yc=r,S.Zc=c,S.$c=E,S._c=h,S.Wc=f,S.ad=p,S.bd=d,S.ta=l,S.cd=v,S.dd=u,S.Pb=new aa(S.session().sessionId(),S.session().username(),i,o),S.ed={},S.fd=s.slice(0),S.fd.forEach(function(e){S.ed[e]=[]}),S.gd=new n.BehaviorSubject(S.collaborators());var _=function(e){return S.hd(e)};S.U=new Fs(S,[rt.Types.ELEMENT],_),S.bd.on(es.Events.COMMIT_STATE_CHANGED,function(e){S.jd=e;var n=S.jd?t.Events.COMMITTED:t.Events.MODIFIED,r={src:S,name:n};S.T(r)});var R={onShare:S.kd.bind(S),onUnshare:S.ld.bind(S),onSet:S.md.bind(S),onClear:S.nd.bind(S)};return S.Nb={Vb:function(e){var t=S.bd.nb(e);S.bd.mb()||S.Ub(t)},referenceEventCallbacks:R},S.Ob=new Ia(S.Nb,S),S.od=!0,S.jd=!0,S.pd(a),S}return r(t,e),t.prototype.permissions=function(){return this.dd},t.prototype.permissionsManager=function(){return new Da(this.Wc,this.ta)},t.prototype.session=function(){return this.ta.session()},t.prototype.emitLocalEvents=function(e){return 0===arguments.length?this.Xc:void(this.Xc=e)},t.prototype.collaborators=function(){return this.fd.map(function(e){return new ga(it.parseUsername(e),e)})},t.prototype.collaboratorsAsObservable=function(){return this.gd.asObservable()},t.prototype.collectionId=function(){return this.ad},t.prototype.modelId=function(){return this.Wc},t.prototype.time=function(){return this._c},t.prototype.minTime=function(){return this.$c},t.prototype.maxTime=function(){return this.time()},t.prototype.createdTime=function(){return this.$c},t.prototype.version=function(){return this.Zc},t.prototype.minVersion=function(){return 0},t.prototype.maxVersion=function(){return this.version()},t.prototype.root=function(){return this.Ob.wrap(this.Pb.root())},t.prototype.elementAt=function(e){return this.root().elementAt(e)},t.prototype.isOpen=function(){return this.od},t.prototype.close=function(){var e=this;return this.cd.qd(this.Yc).then(function(){var n={src:e,name:t.Events.CLOSED,local:!0};e.qd(n)})},t.prototype.startBatch=function(){this.bd.jb()},t.prototype.endBatch=function(){this.completeBatch()},t.prototype.completeBatch=function(){var e=this.bd.lb();this.Ub(e)},t.prototype.batchSize=function(){return this.bd.batchSize()},t.prototype.cancelBatch=function(){return this.bd.kb()},t.prototype.isBatchStarted=function(){return this.bd.mb()},t.prototype.elementReference=function(e){var t=this.U.getLocalReference(e);if(void 0!==t){if(t.reference().type()!==rt.Types.ELEMENT)throw new Error("A reference with this key already exists, but is not an observable reference");return t}var n=this.session(),r=new Ys(this.U,e,this,n.username(),n.sessionId(),(!0)),i=new ma(r,this.Nb.referenceEventCallbacks);return this.U.addLocalReference(i),i},t.prototype.reference=function(e,t){return this.U.get(e,t)},t.prototype.references=function(e){return this.U.getAll(e)},t.prototype.Lb=function(e){return this.Ob.wrap(this.Pb.Lb(e))},t.prototype.rd=function(e){switch(e.message.type){case je.FORCE_CLOSE_REAL_TIME_MODEL:this.sd(e.message);break;case je.REMOTE_OPERATION:this.td(e.message),this.ud();break;case je.REFERENCE_PUBLISHED:case je.REFERENCE_UNPUBLISHED:case je.REFERENCE_SET:case je.REFERENCE_CLEARED:this.Tb(e.message);break;case je.OPERATION_ACKNOWLEDGEMENT:this.vd(e.message),this.ud();break;case je.REMOTE_CLIENT_OPENED:this.wd(e.message);break;case je.REMOTE_CLIENT_CLOSED:this.xd(e.message);break;case je.MODEL_PERMISSIONS_CHANGED:this.yd(e.message);break;default:throw new Error("Unexpected message")}},t.prototype.yd=function(e){var t=this.dd;this.dd=e.permissions;var n=[];this.dd.read!==t.read&&n.push("read"),this.dd.write!==t.write&&n.push("write"),this.dd.remove!==t.remove&&n.push("remove"),this.dd.manage!==t.manage&&n.push("manage");var r=new os(this,this.dd,n);this.T(r)},t.prototype.wd=function(e){this.fd.push(e.sessionId),this.ed[e.sessionId]=[];var t=new ba(this,new ga(it.parseUsername(e.sessionId),e.sessionId));this.T(t),this.gd.next(this.collaborators())},t.prototype.xd=function(e){this.fd=this.fd.filter(function(t){return t!==e.sessionId});var t=this.ed[e.sessionId];delete this.ed[e.sessionId],t.forEach(function(e){e.ba()});var n=new Ma(this,new ga(it.parseUsername(e.sessionId),e.sessionId));this.T(n),this.gd.next(this.collaborators())},t.prototype.Tb=function(e){var t;if(void 0===e.id)this.zd(e);else{var n=this.Lb(e.id);if(!n)return;switch(e.type){case je.REFERENCE_PUBLISHED:t=At.copy(e,{path:n.path()});var r=e;if(void 0!==r.values){var i={type:r.referenceType,id:r.id,values:r.values};i=this.bd.processRemoteReferenceSet(i),t=At.copy(t,{values:i.values})}break;case je.REFERENCE_UNPUBLISHED:case je.REFERENCE_CLEARED:t=At.copy(e,{path:n.path()});break;case je.REFERENCE_SET:var o=e,s={type:o.referenceType,id:o.id,values:o.values};s=this.bd.processRemoteReferenceSet(s),t=At.copy(e,{path:n.path(),values:s.values})}var a=void 0;if(t.type===je.REFERENCE_UNPUBLISHED){a=n.reference(t.sessionId,t.key);var u=this.ed[t.sessionId].indexOf(a);this.ed[t.sessionId].splice(u,1)}n.Tb(t),t.type===je.REFERENCE_PUBLISHED&&(a=n.reference(t.sessionId,t.key),this.ed[t.sessionId].push(a))}},t.prototype.sd=function(e){console.error("The model with id '"+this.Wc+"' was forcefully closed by the server: "+e.reason);var n={src:this,name:t.Events.CLOSED,local:!1,reason:e.reason};this.qd(n)},t.prototype.qd=function(e){this.Pb.root()._b(!1),this.od=!1,this.ta=null,this.T(e)},t.prototype.vd=function(e){this.bd.pb(e.seqNo,e.version),this.Zc=e.version+1,this._c=new Date(e.timestamp)},t.prototype.td=function(e){var t=this,n=new Zo(e.sessionId,(-1),e.version,e.timestamp,e.operation);this.bd.qb(n);var r=this.bd.ib(),i=r.operation,o=r.clientId,s=r.version,a=r.timestamp,u=it.parseUsername(e.sessionId);if(this.Zc=s+1,this._c=new Date(a),i.type===Ct.COMPOUND){var c=i;c.ops.forEach(function(e){if(!e.noOp){var n=new Ca(o,u,s,a,e);t.Ad(n)}})}else{var E=i;if(!E.noOp){var h=new Ca(o,u,s,a,E);this.Ad(h)}}},t.prototype.Ad=function(e){this.Pb.Oc(e)},t.prototype.Ub=function(e){var t={resourceId:this.Yc,seqNo:e.seqNo,version:e.contextVersion,operation:e.operation,type:je.OPERATION_SUBMISSION};this.ta.send(t)},t.prototype.ud=function(){var e={
name:t.Events.VERSION_CHANGED,src:this,version:this.Zc};this.T(e)},t.prototype.zd=function(e){this.U.handleRemoteReferenceEvent(e)},t.prototype.hd=function(e){this.ed[e.sessionId()].push(e),this.T(new is(e,(void 0),this))},t.prototype.Bd=function(e){switch(e.type){case rt.Types.INDEX:case rt.Types.PROPERTY:case rt.Types.RANGE:return e.values;case rt.Types.ELEMENT:for(var t=[],n=0,r=e.values;n<r.length;n++){var i=r[n];t.push(i.id())}return t;default:throw new Error("Invalid reference type")}},t.prototype.pd=function(e){var t=this;e.forEach(function(e){var n;void 0!==e.id&&(n=t.Ob.wrap(t.Pb.Lb(e.id)));var r={type:je.REFERENCE_PUBLISHED,sessionId:e.sessionId,username:it.deserialize(e.sessionId).username,resourceId:t.Yc,key:e.key,id:e.id,referenceType:e.referenceType,values:e.values};if(void 0!==n){n.Tb(r);var i=n.reference(e.sessionId,e.key);t.ed[e.sessionId].push(i)}else t.zd(r);if(e.values){var o={type:je.REFERENCE_SET,sessionId:e.sessionId,username:it.deserialize(e.sessionId).username,resourceId:t.Yc,key:e.key,id:e.id,referenceType:e.referenceType,values:e.values};void 0!==n?n.Tb(o):t.zd(o)}})},t.prototype.kd=function(e){var t=e.reference().source(),n=t instanceof qs?t.id():null,r={type:je.PUBLISH_REFERENCE,resourceId:this.Yc,key:e.reference().key(),id:n,referenceType:e.reference().type(),values:e.values(),version:this.bd.contextVersion()};this.ta.send(r)},t.prototype.ld=function(e){var t=e.reference().source(),n=t instanceof qs?t.id():null,r={type:je.UNPUBLISH_REFERENCE,resourceId:this.Yc,key:e.reference().key(),id:n};this.ta.send(r)},t.prototype.md=function(e){var t=e.reference().source(),n=t instanceof qs?t.id():null,r={type:e.reference().type(),id:n,values:e.reference().values()};if(void 0!==n&&(r=this.bd.processOutgoingSetReference(r)),r){var i={type:je.SET_REFERENCE,resourceId:this.Yc,key:e.reference().key(),id:r.id,referenceType:e.reference().type(),values:this.Bd(r),version:this.bd.contextVersion()};this.ta.send(i)}},t.prototype.nd=function(e){var t=e.reference().source(),n=t instanceof qs?t.id():null,r={type:je.CLEAR_REFERENCE,resourceId:this.Yc,key:e.reference().key(),id:n};this.ta.send(r)},t}(Ze);Pa.Events=La,Object.freeze(Pa.Events);var Ua=function(e){function t(t,n,r){var i=e.call(this)||this;return i.Mb=t,i.Ob=n,i.Pb=r,i.Mb.events().subscribe(function(e){var t=Vs.convertEvent(e,i.Ob);i.T(t)}),i}return r(t,e),t.prototype.id=function(){return this.Mb.id()},t.prototype.type=function(){return this.Mb.type()},t.prototype.path=function(){return this.Mb.path()},t.prototype.relativePath=function(){var e=this.Mb.path().slice(0);return e.length>0?e.pop():null},t.prototype.parent=function(){var e=this.Mb.path().slice(0);e.pop();var t=this.Pb.elementAt(e);return t},t.prototype.isAttached=function(){return!this.Mb.isDetached()},t.prototype.isDetached=function(){return this.Mb.isDetached()},t.prototype.value=function(){return this.Mb.data()},t.prototype.toJSON=function(){return this.Mb.toJson()},t.prototype.model=function(){return this.Pb},t}(Ze);Ua.Events=Js;var xa=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.Mb=t,i}return r(t,e),t.prototype.get=function(e){return this.Ob.wrap(this.Mb.get(e))},t.prototype.length=function(){return this.Mb.length()},t.prototype.forEach=function(e){var t=this;this.Mb.forEach(function(n,r){e(t.Ob.wrap(n),r)})},t.prototype.elementAt=function(e){return this.Ob.wrap(this.Mb.valueAt(e))},t}(Ua);xa.Events=ca;var Ha=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.Mb=t,i}return r(t,e),t.prototype.get=function(e){return this.Ob.wrap(this.Mb.get(e))},t.prototype.keys=function(){return this.Mb.keys()},t.prototype.hasKey=function(e){return this.Mb.hasKey(e)},t.prototype.forEach=function(e){var t=this;this.Mb.forEach(function(n,r){e(t.Ob.wrap(n),r)})},t.prototype.elementAt=function(e){return this.Ob.wrap(this.Mb.valueAt(e))},t}(Ua);Ha.Events=pa;var Ba=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(Ua);Ba.Events=Js;var za=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(Ua);za.Events=Js;var Va=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(Ua);Va.Events=Sa;var Ga=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.Mb=t,i}return r(t,e),t.prototype.length=function(){return this.Mb.length()},t}(Ua);Ga.Events=Ta;var ja=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(Ua);ja.Events=Js;var ka=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(Ua);ka.Events=Js;var Ya=function(e){function t(t){var n=e.call(this)||this;return n.Pb=t,n}return r(t,e),t.prototype.Qc=function(e){switch(e.type()){case Ws.ARRAY:return new xa(e,this,this.Pb);case Ws.OBJECT:return new Ha(e,this,this.Pb);case Ws.BOOLEAN:return new Ba(e,this,this.Pb);case Ws.NULL:return new za(e,this,this.Pb);case Ws.NUMBER:return new Va(e,this,this.Pb);case Ws.STRING:return new Ga(e,this,this.Pb);case Ws.UNDEFINED:return new ja(e,this,this.Pb);case Ws.DATE:return new ka(e,this,this.Pb);default:return null}},t}(ua),Qa=Object.assign({TARGET_VERSION_CHANGED:"target_changed",TRANSITION_START:"transition_start",TRANSITION_END:"transition_end"},wa);Object.freeze(Qa);var Fa=function(){function e(e,t,n,r,i,o,s,a){this.Fa=a,this.ta=s,this.Wc=i,this.ad=o,this.Pb=new aa(this.session().sessionId(),this.session().username(),null,e),this.Ob=new Ya(this),this.Zc=t,this.Cd=t,this.Dd=t,this.Ed=n,this.Fd=n,this.$c=r,this.Gd=[]}return e.prototype.session=function(){return this.Fa},e.prototype.collectionId=function(){return this.ad},e.prototype.modelId=function(){return this.Wc},e.prototype.time=function(){return this.Ed},e.prototype.minTime=function(){return this.createdTime()},e.prototype.maxTime=function(){return this.Fd},e.prototype.createdTime=function(){return this.$c},e.prototype.version=function(){return this.Zc},e.prototype.minVersion=function(){return 0},e.prototype.maxVersion=function(){return this.Dd},e.prototype.targetVersion=function(){return this.Cd},e.prototype.isTransitioning=function(){return this.Cd===this.Zc},e.prototype.root=function(){return this.Ob.wrap(this.Pb.root())},e.prototype.elementAt=function(e){return this.Ob.wrap(this.Pb.valueAt(e))},e.prototype.playTo=function(e){var t=this;if(e<0)throw new Error("Version must be >= 0: "+e);if(e>this.Dd)throw new Error("Version must be <= maxVersion: "+e);var n,r,i=null;if(e===this.Cd)return Promise.resolve();e>this.Cd?(n=this.Cd+1,r=e,i=!0):(n=e+1,r=this.Cd,i=!1),this.Cd=e;var o={type:je.HISTORICAL_OPERATIONS_REQUEST,modelId:this.Wc,first:n,last:r},s={forward:i,completed:!1,operations:null};return this.Gd.push(s),this.ta.request(o).then(function(e){s.completed=!0,s.operations=e.operations,t.Hd()})},e.prototype.forward=function(e){if(void 0===e&&(e=1),e<1)throw new Error("delta must be > 0");if(this.Cd+e>this.Dd)throw new Error("Cannot move forward by "+e+", because that would exceed the model's maxVersion.");var t=this.Cd+e;return this.playTo(t)},e.prototype.backward=function(e){if(void 0===e&&(e=1),e<1)throw new Error("delta must be > 0");if(this.Cd-e<0)throw new Error("Cannot move backawrd by "+e+", because that would move beyond version 0.");var t=this.Cd-e;return this.playTo(t)},e.prototype.Hd=function(){if(0===this.Gd.length)throw new Error("There are no operation requests to process");for(;this.Gd.length>0&&this.Gd[0].completed;)this.Id(this.Gd[0].operations,this.Gd[0].forward),this.Gd.shift()},e.prototype.Id=function(e,t){var n=this;t?e.forEach(function(e){if(e.operation.type===Ct.COMPOUND){var t=e.operation;t.ops.forEach(function(t){n.Jd(e,t,!1)})}else n.Jd(e,e.operation,!1)}):e.reverse().forEach(function(e){if(e.operation.type===Ct.COMPOUND){var t=e.operation;t.ops.reverse().forEach(function(t){n.Jd(e,t,!0)})}else n.Jd(e,e.operation,!0)})},e.prototype.Jd=function(e,t,n){if(!t.noOp){var r=null;r=n?t.inverse():t,this.Pb.Oc(new Ca(e.sessionId,e.username,e.version,e.timestamp,r))}n?this.Zc=e.version-1:this.Zc=e.version,this.Ed=new Date(e.timestamp)},e}();Fa.Events=Qa;var Ja=function(e){function t(t){var n=e.call(this)||this;return n.ta=t,n.Kd={},n.Ld={},n.Md={},n.Nd={},n.ta.addMultipleMessageListener([je.FORCE_CLOSE_REAL_TIME_MODEL,je.REMOTE_OPERATION,je.OPERATION_ACKNOWLEDGEMENT,je.MODEL_AUTO_CREATE_CONFIG_REQUEST,je.REMOTE_CLIENT_OPENED,je.REMOTE_CLIENT_CLOSED,je.REFERENCE_PUBLISHED,je.REFERENCE_UNPUBLISHED,je.REFERENCE_SET,je.REFERENCE_CLEARED],function(e){return n.rd(e)}),n.Od=0,n}return r(t,e),t.prototype.session=function(){return this.ta.session()},t.prototype.query=function(e){var t={type:je.MODELS_QUERY_REQUEST,query:e};return this.ta.request(t).then(function(e){return e.result})},t.prototype.isOpen=function(e){return void 0!==this.Ld[e]},t.prototype.isOpening=function(e){return void 0!==this.Kd[e]},t.prototype.open=function(e){return rs.nonEmptyString(e)?this.od(e):Promise.reject(new Error("modelId must be a non-null, non empty string."))},t.prototype.openAutoCreate=function(e){return rs.nonEmptyString(e.collection)?this.od(void 0,e):Promise.reject(new Error("options.collection must be a non-null, non empty string."))},t.prototype.create=function(e){var t=e.collection;if(!rs.nonEmptyString(e.collection))return Promise.reject(new Error("options.collection must be a non-null, non empty string."));var n=e.data||{},r=new qa,i=new ns(function(){return r.id()}),o=i.createDataValue(n),s={type:je.CREATE_REAL_TIME_MODEL_REQUEST,collectionId:t,modelId:e.id,data:o,overrideWorld:e.overrideWorld,worldPermissions:e.worldPermissions,userPermissions:e.userPermissions};return this.ta.request(s).then(function(e){return e.modelId})},t.prototype.remove=function(e){var t={type:je.DELETE_REAL_TIME_MODEL_REQUEST,modelId:e};return this.ta.request(t).then(function(){})},t.prototype.history=function(e){var t=this,n={type:je.HISTORICAL_DATA_REQUEST,modelId:e};return this.ta.request(n).then(function(n){return new Fa(n.data,n.version,n.modifiedTime,n.createdTime,e,n.collectionId,t.ta,t.session())})},t.prototype.permissions=function(e){return new Da(e,this.ta)},t.prototype.qd=function(e){var t={type:je.CLOSES_REAL_TIME_MODEL_REQUEST,resourceId:e},n=this.Md[e];return delete this.Md[e],delete this.Ld[n.modelId()],this.ta.request(t).then(function(){})},t.prototype.ba=function(){var e=this;Object.getOwnPropertyNames(this.Ld).forEach(function(t){e.Ld[t].close()})},t.prototype.od=function(e,t){var n=this;if(void 0===e&&void 0===t)throw new Error("Internal error, id or options must be defined.");if(void 0===e&&(e=t.id),e&&void 0!==this.Ld[e])return Promise.resolve(this.Ld[e]);if(e&&void 0!==this.Kd[e])return this.Kd[e].promise();var r=t?this.Od++:void 0,i={type:je.OPEN_REAL_TIME_MODEL_REQUEST,id:e,autoCreateId:r};void 0!==t&&(this.Nd[r]=t);var o=new Ve;return void 0!==e&&(this.Kd[e]=o),this.ta.request(i).then(function(i){var s=new Ui(new Xo),a=new ts(new Xo),u=new es(n.ta.session().sessionId(),i.version,s,a),c=new Pa(i.resourceId,i.valueIdPrefix,i.data,i.connectedClients,i.references,i.permissions,i.version,new Date(i.createdTime),new Date(i.modifiedTime),i.id,i.collection,u,n.ta,n);n.Ld[e]=c,n.Md[i.resourceId]=c,void 0!==n.Kd[e]&&delete n.Kd[e],void 0!==t&&delete n.Nd[r],o.resolve(c)}).catch(function(e){o.reject(e)}),o.promise()},t.prototype.rd=function(e){switch(e.message.type){case je.MODEL_AUTO_CREATE_CONFIG_REQUEST:this.Pd(e.message,e.callback);break;default:var t=this.Md[e.message.resourceId];void 0!==t&&t.rd(e)}},t.prototype.Pd=function(e,t){var n=this.Nd[e.autoCreateId];if(void 0===n){var r="Received a request for an auto create id that was not expected: "+e.autoCreateId;console.error(r),t.expectedError("unknown_model",r)}else{var i=n.data;"function"==typeof i&&(i=i());var o=void 0;if(void 0!==i){var s=new qa,a=new ns(function(){return s.id()});o=a.createDataValue(i)}var u={type:je.MODEL_AUTO_CREATE_CONFIG_RESPONSE,data:o,collection:n.collection,overrideWorld:n.overrideWorld,worldPermissions:n.worldPermissions,userPermissions:n.userPermissions};t.reply(u)}},t}(Ze),qa=function(){function e(){this.Qd="0",this.Xb=0}return e.prototype.id=function(){return this.Qd+":"+this.Xb++},e}(),Wa=function(){function e(e,t,n,r){this.sessionId=e,this.username=t,this.local=r,this.Rd=p(n),Object.freeze(this)}return Object.defineProperty(e.prototype,"state",{get:function(){return p(this.Rd)},enumerable:!0,configurable:!0}),e}(),Ka=function(){function e(t,n,r,i,o){this.activity=t,this.username=n,this.sessionId=r,this.local=i,this.participant=o,this.name=e.NAME,Object.freeze(this)}return e}();Ka.NAME="session_joined";var Xa=function(){function e(t,n,r,i){this.activity=t,this.username=n,this.sessionId=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();Xa.NAME="session_left";var $a=function(){function e(t,n,r,i,o,s){this.activity=t,this.username=n,this.sessionId=r,this.local=i,this.key=o,this.value=s,this.name=e.NAME,Object.freeze(this)}return e}();$a.NAME="state_set";var Za=function(){function e(t,n,r,i,o){this.activity=t,this.username=n,this.sessionId=r,this.local=i,this.key=o,this.name=e.NAME,Object.freeze(this)}return e}();Za.NAME="state_removed";var eu=function(){function e(t,n,r,i){this.activity=t,this.username=n,this.sessionId=r,this.local=i,this.name=e.NAME,Object.freeze(this)}return e}();eu.NAME="state_cleared";var tu=function(e){function n(r,i,o,s,a){var u=e.call(this)||this;return u.S(s),u.Xb=r,u.Sd=new t.BehaviorSubject(i),u.Td=o,u.Ud=!0,u.ta=a,u.events().subscribe(function(e){var t=u.Sd.getValue();switch(e.name){case n.Events.SESSION_JOINED:var r=e;t.set(r.sessionId,r.participant),u.Sd.next(t);break;case n.Events.SESSION_LEFT:var i=e;t.delete(i.sessionId),u.Sd.next(t);break;case n.Events.STATE_SET:var o=e,s=t.get(o.sessionId).state;s.set(o.key,o.value),t.set(o.sessionId,new Wa(o.sessionId,o.username,s,(!1))),u.Sd.next(t);break;case n.Events.STATE_REMOVED:var a=e,c=t.get(a.sessionId).state;c.delete(a.key),t.set(a.sessionId,new Wa(a.sessionId,a.username,c,(!1))),u.Sd.next(t);break;case n.Events.STATE_CLEARED:var E=e;t.set(E.sessionId,new Wa(E.sessionId,E.username,new Map,(!1))),u.Sd.next(t);break;default:throw new Error("Invalid activity event")}}),u}return r(n,e),n.prototype.session=function(){return this.ta.session()},n.prototype.id=function(){return this.Xb},n.prototype.leave=function(){this.isJoined()&&(this.Ud=!1,this.ta.send({type:je.ACTIVITY_LEAVE_REQUEST,activityId:this.Xb}),this.Td())},n.prototype.isJoined=function(){return this.Ud},n.prototype.state=function(){var e=this.Sd.getValue().get(this.ta.session().sessionId());return e.state},n.prototype.setState=function(){var e=this;if(this.isJoined()){var t;1===arguments.length?t=Jn.toStringMap(arguments[0]):2===arguments.length&&(t={},t[arguments[0]]=arguments[1]);var n={type:je.ACTIVITY_LOCAL_STATE_SET,activityId:this.Xb,state:t};this.ta.send(n),Object.keys(t).forEach(function(n){e.T(new $a(e,e.ta.session().username(),e.ta.session().sessionId(),(!0),n,t[n]))})}},n.prototype.removeState=function(e){var t=this;if(this.isJoined()){"string"==typeof e&&(e=[e]);var n={type:je.ACTIVITY_LOCAL_STATE_REMOVED,activityId:this.Xb,keys:e};this.ta.send(n),e.forEach(function(e){t.T(new Za(t,t.ta.session().username(),t.ta.session().sessionId(),(!0),e))})}},n.prototype.clearState=function(){if(this.isJoined()){var e={type:je.ACTIVITY_LOCAL_STATE_CLEARED,activityId:this.Xb};this.ta.send(e),this.T(new eu(this,this.ta.session().username(),this.ta.session().sessionId(),(!0)))}},n.prototype.participant=function(e){return this.Sd.getValue().get(e)},n.prototype.participants=function(){return Array.from(this.Sd.getValue().values())},n.prototype.participantsAsObservable=function(){return this.Sd.asObservable().map(function(e){return Array.from(e.values())})},n}(Ze);tu.Events={SESSION_JOINED:Ka.NAME,SESSION_LEFT:Xa.NAME,STATE_SET:$a.NAME,STATE_REMOVED:Za.NAME,STATE_CLEARED:eu.NAME},Object.freeze(tu.Events);var nu=function(e){function n(n){var r=e.call(this)||this;r.ta=n,r.Vd=new Map,r.Wd=new Map;var i=t.Observable.create(function(e){r.ta.addMultipleMessageListener([je.ACTIVITY_SESSION_JOINED,je.ACTIVITY_SESSION_LEFT,je.ACTIVITY_REMOTE_STATE_SET,je.ACTIVITY_REMOTE_STATE_REMOVED,je.ACTIVITY_REMOTE_STATE_CLEARED],function(t){e.next(t)})}),o=i.pluck("message").concatMap(function(e){var t=r.Wd.get(e.activityId);if(void 0===t)return[];switch(e.type){case je.ACTIVITY_SESSION_JOINED:var n=e,i=it.parseUsername(n.sessionId),o=new Wa(n.sessionId,i,n.state,(!1));return[new Ka(t,i,n.sessionId,(!1),o)];case je.ACTIVITY_SESSION_LEFT:var s=e;return[new Xa(t,it.parseUsername(s.sessionId),s.sessionId,(!1))];case je.ACTIVITY_REMOTE_STATE_SET:var a=e;return Object.keys(a.state).map(function(e){return new $a(t,it.parseUsername(a.sessionId),a.sessionId,(!1),e,a.state[e])});case je.ACTIVITY_REMOTE_STATE_CLEARED:var u=e;return[new eu(t,it.parseUsername(u.sessionId),u.sessionId,(!1))];case je.ACTIVITY_REMOTE_STATE_REMOVED:var c=e;return c.keys.map(function(e){return new Za(t,it.parseUsername(c.sessionId),c.sessionId,(!1),e)});default:throw new Error("Invalid activity event")}});return r.S(o),r}return r(n,e),n.prototype.session=function(){return this.ta.session()},n.prototype.join=function(e,t){var n=this;if(!this.isJoined(e)){t=t||{};var r=new Map;t.state&&(r=t.state.constructor!==Map?Jn.objectToMap(t.state):p(t.state));var i=new Ve;this.Vd.set(e,i),this.ta.request({type:je.ACTIVITY_JOIN_REQUEST,activityId:e,state:r}).then(function(t){var r=new Map;Object.keys(t.participants).forEach(function(e){var i=it.parseUsername(e),o=e===n.ta.session().sessionId(),s=t.participants[e],a=Jn.objectToMap(s),u=new Wa(e,i,a,o);r.set(e,u)});var o=n.events().filter(function(t){return t.activity.id()===e}),s=new tu(e,r,function(){return n.Xd(e)},o,n.ta);i.resolve(s),n.Wd.set(e,s)})}return this.Vd.get(e).promise()},n.prototype.joined=function(){return p(this.Wd)},n.prototype.isJoined=function(e){return this.Vd.has(e)},n.prototype.Xd=function(e){this.Vd.delete(e),this.Wd.delete(e)},n}(Ze),ru={USERNAME:"username",EMAIL:"email",FIRST_NAME:"firstName",LAST_NAME:"lastName",DISPLAY_NAME:"displayName"};Object.freeze(ru);var iu=[ru.USERNAME,ru.EMAIL],ou=[ru.USERNAME,ru.EMAIL,ru.FIRST_NAME,ru.LAST_NAME,ru.DISPLAY_NAME],su=function(){function e(e){this.ta=e}return e.prototype.session=function(){return this.ta.session()},e.prototype.profile=function(){return this.user(this.ta.session().username())},e.prototype.user=function(e){return"string"!=typeof e?Promise.reject("Must specify a username."):this.users([e]).then(function(t){var n=Object.keys(t);return 0===n.length||1===n.length?Promise.resolve(t[e]):Promise.reject(new Error("Error getting user."))})},e.prototype.userByEmail=function(e){return this.usersByEmail([e]).then(function(t){var n=Object.keys(t);return 0===n.length||1===n.length?Promise.resolve(t[e]):Promise.reject(new Error("Error getting user."))})},e.prototype.users=function(e){var t=Array.from(new Set(e));return this.Yd(t,ru.USERNAME).then(function(e){var t={};return e.forEach(function(e){t[e.username]=e}),t})},e.prototype.usersByEmail=function(e){var t=Array.from(new Set(e));return this.Yd(t,ru.EMAIL).then(function(e){var t={};return e.forEach(function(e){t[e.email]=e}),t})},e.prototype.search=function(e){if(void 0===e.fields||null===e.fields||Array.isArray(e.fields)&&0===e.fields.length)return Promise.reject(new Error("Must specify at least one field to search"));if(void 0===e.term||null===e.term)return Promise.reject(new Error("Must specify a search value"));var t=e.fields;Array.isArray(e.fields)||(t=[e.fields]);var n=e.orderBy||{},r=this.Zd(t),i={type:je.USER_SEARCH_REQUEST,fields:r,value:e.term,offset:e.offset,limit:e.limit,orderBy:n.field,ascending:n.ascending};return this.ta.request(i).then(function(e){return e.users})},e.prototype.groups=function(e){var t={type:je.USER_GROUPS_REQUEST,ids:e};return this.ta.request(t).then(function(e){return e.groups})},e.prototype.group=function(e){return this.groups([e]).then(function(e){return e[0]})},e.prototype.groupsForUser=function(e){return this.groupsForUsers([e]).then(function(t){return t[e]})},e.prototype.groupsForUsers=function(e){var t={type:je.USER_GROUPS_FOR_USERS_REQUEST,usernames:e};return this.ta.request(t).then(function(e){return e.groupsByUser})},e.prototype.Yd=function(e,t){if(void 0===t&&(t=ru.USERNAME),void 0===t||null===t)return Promise.reject(new Error("Must specify a lookup field"));if(iu.indexOf(t)<0)return Promise.reject(new Error("invalid lookup field"));if(void 0===e||null===e||Array.isArray(e)&&0===e.length)return Promise.reject(new Error("Must specify at least one value"));Array.isArray(e)||(e=[e]);var n={type:je.USER_LOOKUP_REQUEST,field:t,values:e};return this.ta.request(n).then(function(e){return e.users})},e.prototype.Zd=function(e){var t=[];return e.forEach(function(e){if(ou.indexOf(e)<0)throw new Error("Invalid user search field: "+e);t.indexOf(e)<0&&t.push(e)}),t},e}(),au=function(){function e(e,t,n){this.username=e,this.available=t,this.Rd=p(n),Object.freeze(this)}return Object.defineProperty(e.prototype,"state",{get:function(){return p(this.Rd)},enumerable:!0,configurable:!0}),e}(),uu=function(){function e(t,n){this.username=t,this.state=n,this.name=e.NAME,Object.freeze(this)}return e}();uu.NAME="state_set";var cu=function(){function e(t,n){this.username=t,this.keys=n,this.name=e.NAME,Object.freeze(this)}return e}();cu.NAME="state_removed";var Eu=function(){function e(t){this.username=t,this.name=e.NAME,Object.freeze(this)}return e}();Eu.NAME="state_cleared";var hu=function(){function e(t,n){this.username=t,this.available=n,this.name=e.NAME,Object.freeze(this)}return e}();hu.NAME="availability_changed";var fu=function(e){function t(t){var n=e.call(this)||this;return n.$d=t,n.S(t.events()),n}return r(t,e),Object.defineProperty(t.prototype,"username",{get:function(){return this.$d.username()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"available",{get:function(){return this.$d.isAvailable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this.$d.state()},enumerable:!0,configurable:!0}),t.prototype.asObservable=function(){return this.$d.asObservable()},t.prototype.unsubscribe=function(){null!==this.$d&&this.$d.unsubscribe(this),this.$d=null},t}(Ze);fu.Events={STATE_SET:uu.NAME,STATE_REMOVED:cu.NAME,STATE_CLEARED:Eu.NAME,AVAILABILITY_CHANGED:hu.NAME};var pu=function(e){function n(n,r,i){var o=e.call(this)||this;return o._d=new au(n.username,n.available,n.state),o.ae=[],o.be=i,o.ce=r.subscribe(function(e){return o.rd(e)}),o.de=new t.BehaviorSubject(o._d),o}return r(n,e),n.prototype.username=function(){return this._d.username},n.prototype.isAvailable=function(){return this._d.available},n.prototype.state=function(){return this._d.state},n.prototype.asObservable=function(){return this.de.asObservable()},n.prototype.subscribe=function(){var e=new fu(this);return this.ae.push(e),e},n.prototype.unsubscribe=function(e){this.ae=this.ae.filter(function(t){return t!==e}),0===this.ae.length&&(this.ce.unsubscribe(),this.de.complete(),this.be(this.username()))},n.prototype.availability=function(e){this._d=new au(this._d.username,e,this._d.state);var t=new hu(this._d.username,e);this.T(t),this.de.next(this._d)},n.prototype.set=function(e){var t=this._d.state;e.forEach(function(e,n){return t.set(n,p(e))}),this._d=new au(this._d.username,this._d.available,t);var n=new uu(this._d.username,t);this.T(n),this.de.next(this._d)},n.prototype.remove=function(e){var t=this._d.state;e.forEach(function(e){return t.delete(e)}),this._d=new au(this._d.username,this._d.available,t);var n=new cu(this._d.username,e);this.T(n),this.de.next(this._d)},n.prototype.clear=function(){this._d=new au(this._d.username,this._d.available,new Map);var e=new Eu(this._d.username);this.T(e),this.de.next(this._d)},n.prototype.rd=function(e){var t=e.message;switch(t.type){case je.PRESENCE_AVAILABILITY_CHANGED:this.availability(t.available);break;case je.PRESENCE_STATE_SET:this.set(t.state);break;case je.PRESENCE_STATE_CLEARED:this.clear();break;case je.PRESENCE_STATE_REMOVED:this.remove(t.keys)}},n}(Ze),du=function(e){function t(t,n){var r=e.call(this)||this;r.ta=t,r.ee=new Map,r.fe=new Map,r.ge=r.ta.messages([je.PRESENCE_AVAILABILITY_CHANGED,je.PRESENCE_STATE_SET,je.PRESENCE_STATE_CLEARED]);var i=r.session().username(),o=r.he(i);return r.fe.set(i,o),r.ie=new pu(n,o,function(){}),r.ee.set(i,r.ie),r.je=r.ie.subscribe(),r}return r(t,e),t.prototype.session=function(){return this.ta.session()},t.prototype.isAvailable=function(){return this.je.available},t.prototype.setState=function(){var e;1===arguments.length?e=Jn.objectToMap(arguments[0]):2===arguments.length&&(e=new Map,e.set(arguments[0],arguments[1])),this.ie.set(e);var t={type:je.PRESENCE_SET_STATE,state:Jn.mapToObject(e),all:!1};this.ta.send(t)},t.prototype.removeState=function(e){var t=null;t="string"==typeof e?[e]:e,this.ie.remove(t);var n={type:je.PRESENCE_REMOVE_STATE,keys:t};this.ta.send(n)},t.prototype.clearState=function(){this.ie.clear();var e={type:je.PRESENCE_CLEAR_STATE};this.ta.send(e)},t.prototype.state=function(){return this.je.state},t.prototype.presence=function(e){return"string"==typeof e?this.ke([e]).then(function(e){return e[0]}):this.ke(e)},t.prototype.subscribe=function(e){var t,n=this;return t="string"==typeof e?[e]:e,this.le(t).then(function(){var r=t.map(function(e){return n.ee.get(e).subscribe()});return"string"==typeof e?r[0]:r})},t.prototype.ke=function(e){var t={type:je.PRESENCE_REQUEST,usernames:e};return this.ta.request(t).then(function(e){return e.userPresences.map(function(e){return new au(e.username,e.available,Jn.objectToMap(e.state))})})},t.prototype.he=function(e){return this.ge.filter(function(t){return t.message.username===e})},t.prototype.le=function(e){var t=this,n=e.filter(function(e){return void 0===t.fe.get(e)});if(n.length>0){n.forEach(function(e){var n=t.he(e);t.fe.set(e,n)});var r={type:je.PRESENCE_SUBSCRIBE_REQUEST,usernames:n};return this.ta.request(r).then(function(e){e.userPresences.forEach(function(e){var n=new pu(new au(e.username,e.available,Jn.objectToMap(e.state)),t.fe.get(e.username),function(e){return t.me(e)});t.ee.set(e.username,n)})})}return Promise.resolve()},t.prototype.me=function(e){var t={type:je.PRESENCE_UNSUBSCRIBE,username:e};this.ta.send(t),this.ee.delete(e),this.fe.delete(e)},t}(Ze);du.Events={STATE_SET:uu.NAME,STATE_REMOVED:cu.NAME,STATE_CLEARED:Eu.NAME,AVAILABILITY_CHANGED:hu.NAME};var lu=function(){function e(e,t,n){this.channelId=e,this.eventNumber=t,this.timestamp=n}return e}(),vu=function(e){function t(n,r,i,o,s,a){var u=e.call(this,n,r,i)||this;return u.username=o,u.sessionId=s,u.message=a,u.name=t.NAME,Object.freeze(u),u}return r(t,e),t}(lu);vu.NAME="message";var Su=function(e){function t(n,r,i,o){var s=e.call(this,n,r,i)||this;return s.username=o,s.name=t.NAME,Object.freeze(s),s}return r(t,e),t}(lu);Su.NAME="user_joined";var _u=function(e){function t(n,r,i,o){var s=e.call(this,n,r,i)||this;return s.username=o,s.name=t.NAME,Object.freeze(s),s}return r(t,e),t}(lu);_u.NAME="user_left";var Ru=function(e){function t(n,r,i,o,s){var a=e.call(this,n,r,i)||this;return a.username=o,a.addedBy=s,a.name=t.NAME,Object.freeze(a),a}return r(t,e),t}(lu);Ru.NAME="user_added";var yu=function(e){function t(n,r,i,o,s){var a=e.call(this,n,r,i)||this;return a.username=o,a.removedBy=s,a.name=t.NAME,Object.freeze(a),a}return r(t,e),t}(lu);yu.NAME="user_removed";var Tu=function(e){function t(n,r,i,o,s){var a=e.call(this,n,r,i)||this;return a.channelName=o,a.changedBy=s,a.name=t.NAME,Object.freeze(a),a}return r(t,e),t}(lu);Tu.NAME="name_changed";var Ou=function(e){function t(n,r,i,o,s){var a=e.call(this,n,r,i)||this;return a.topic=o,a.changedBy=s,a.name=t.NAME,Object.freeze(a),a}return r(t,e),t}(lu);Ou.NAME="topic_changed";var Au=function(){function e(t){this.channelId=t,this.name=e.NAME,Object.freeze(this)}return e}();Au.NAME="joined";var Nu=function(){function e(t){this.channelId=t,this.name=e.NAME,Object.freeze(this)}return e}();Nu.NAME="left";var Iu=function(){function e(t){this.channelId=t,this.name=e.NAME,Object.freeze(this)}return e}();Iu.NAME="removed";var mu={MESSAGE:vu.NAME,USER_JOINED:Su.NAME,USER_LEFT:_u.NAME,USER_ADDED:Ru.NAME,USER_REMOVED:yu.NAME};Object.freeze(mu);var Cu=function(e){function t(t,n,r){var i=e.call(this)||this;return i.ta=t,i.ne=r,i.Ud=r.members.includes(i.session().username()),n.subscribe(function(e){i.oe(e),i.T(e)}),i}return r(t,e),t.prototype.session=function(){return this.ta.session()},t.prototype.dispose=function(){this._subscription.unsubscribe()},t.prototype.info=function(){return Object.assign({},this.ne)},t.prototype.isJoined=function(){return this.Ud},t.prototype.send=function(e){return this.pe(),this.ta.request({type:je.PUBLISH_CHAT_MESSAGE_REQUEST,channelId:this.ne.channelId,message:e}).then(function(){})},t.prototype.setName=function(e){return this.pe(),this.ta.request({type:je.SET_CHAT_CHANNEL_NAME_REQUEST,channelId:this.ne.channelId,name:e}).then(function(){})},t.prototype.setTopic=function(e){return this.pe(),this.ta.request({type:je.SET_CHAT_CHANNEL_TOPIC_REQUEST,channelId:this.ne.channelId,topic:e}).then(function(){})},t.prototype.markSeen=function(e){return this.pe(),this.ta.request({type:je.MARK_CHAT_CHANNEL_EVENTS_SEEN_REQUEST,channelId:this.ne.channelId,eventNumber:e}).then(function(){})},t.prototype.getHistory=function(e){return this.pe(),this.ta.request({type:je.GET_CHAT_CHANNEL_HISTORY_REQUEST,channelId:this.ne.channelId,startEvent:e.startEvent,limit:e.limit,forward:e.forward,eventFilter:e.eventFilter}).then(function(e){return e.entries})},t.prototype.pe=function(){if(!this.isJoined())throw new Error("Chat channel not joined: "+this.ne.channelId)},t.prototype.oe=function(e){if(e instanceof lu){var t=e.timestamp,n=e.eventNumber;this.ne=Object.assign({},this.ne,{eventCount:n,lastEventTime:t})}if(e instanceof Su||e instanceof Ru){var r=this.ne.members.slice(0);r.push(e.username),e.username===this.session().username()&&(this.Ud=!0),this.ne=Object.assign({},this.ne,{members:r})}else if(e instanceof _u||e instanceof yu){var i=e.username;i===this.session().username()&&(this.Ud=!1);var r=this.ne.members.filter(function(e){return e!==i});this.ne=Object.assign({},this.ne,{members:r})}else if(e instanceof Tu){var o=e.channelName;this.ne=Object.assign({},this.ne,{name:o})}else if(e instanceof Ou){var s=e.topic;this.ne=Object.assign({},this.ne,{topic:s})}Object.freeze(this.ne)},t}(Ze);Cu.Events=mu;var gu,wu=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t.prototype.info=function(){var t=this,n=e.prototype.info.call(this),r=n.members.filter(function(e){return e!==t.session().username()});return Object.assign({},n,{otherUsers:r})},t}(Cu),bu=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t.prototype.info=function(){return e.prototype.info.call(this)},t.prototype.leave=function(){return this.pe(),this.ta.request({type:je.LEAVE_CHAT_CHANNEL_REQUEST,channelId:this.ne.channelId}).then(function(){})},t.prototype.remove=function(e){return this.pe(),this.ta.request({type:je.REMOVE_USER_FROM_CHAT_CHANNEL_REQUEST,channelId:this.ne.channelId,username:e}).then(function(){})},t}(Cu),Mu=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t.prototype.add=function(e){return this.pe(),this.ta.request({type:je.ADD_USER_TO_CHAT_CHANNEL_REQUEST,channelId:this.ne.channelId,username:e}).then(function(){})},t}(bu),Du=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(bu);!function(e){e[e.CHAT=0]="CHAT"}(gu||(gu={}));var Lu=function(){function e(e,t){this.qe=e,this.ta=t}return Object.defineProperty(e.prototype,"channelId",{get:function(){return this.qe},enumerable:!0,configurable:!0}),e.prototype.getPermissions=function(){var e={type:je.GET_CLIENT_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe};return this.ta.request(e).then(function(e){return e.permissions})},e.prototype.addWorldPermissions=function(e){var t={type:je.ADD_PERMISSIONS_REQUEST,idType:gu.CHAT,
id:this.qe,world:e};return this.ta.request(t).then(function(){})},e.prototype.removeWorldPermissions=function(e){var t={type:je.REMOVE_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,world:e};return this.ta.request(t).then(function(){})},e.prototype.setWorldPermissions=function(e){var t={type:je.SET_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,world:e};return this.ta.request(t).then(function(){})},e.prototype.getWorldPermissions=function(){var e={type:je.GET_WORLD_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe};return this.ta.request(e).then(function(e){return e.permissions})},e.prototype.addUserPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.ADD_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,users:t};return console.log(JSON.stringify(t)),this.ta.request(r).then(function(){})},e.prototype.removeUserPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.REMOVE_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,users:t};return this.ta.request(r).then(function(){})},e.prototype.setUserPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.SET_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,users:t};return this.ta.request(r).then(function(){})},e.prototype.getAllUserPermissions=function(){var e={type:je.GET_ALL_USER_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe};return this.ta.request(e).then(function(e){return e.users})},e.prototype.getUserPermissions=function(e){var t={type:je.GET_USER_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,username:e};return this.ta.request(t).then(function(e){return e.permissions})},e.prototype.addGroupPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.ADD_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,groups:t};return this.ta.request(r).then(function(){})},e.prototype.removeGroupPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.REMOVE_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,groups:t};return this.ta.request(r).then(function(){})},e.prototype.setGroupPermissions=function(e){var t=new Map;if(e instanceof Map)t=e;else{var n=e;Object.keys(n).forEach(function(e){t.set(e,n[e])})}var r={type:je.SET_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,groups:t};return this.ta.request(r).then(function(){})},e.prototype.getAllGroupPermissions=function(){var e={type:je.GET_ALL_GROUP_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe};return this.ta.request(e).then(function(e){return e.groups})},e.prototype.getGroupPermissions=function(e){var t={type:je.GET_GROUP_PERMISSIONS_REQUEST,idType:gu.CHAT,id:this.qe,groupId:e};return this.ta.request(t).then(function(e){return e.permissions})},e}(),Pu={MESSAGE:vu.NAME,USER_JOINED:Su.NAME,USER_LEFT:_u.NAME,USER_ADDED:Ru.NAME,USER_REMOVED:yu.NAME,CHANNEL_JOINED:Au.NAME,CHANNEL_LEFT:Nu.NAME};Object.freeze(Pu);var Uu={DIRECT:"direct",GROUP:"group",ROOM:"room"},xu=function(e){function t(t){var n=e.call(this)||this;n.ta=t;var r=[je.USER_JOINED_CHAT_CHANNEL,je.USER_LEFT_CHAT_CHANNEL,je.USER_ADDED_TO_CHAT_CHANNEL,je.USER_REMOVED_FROM_CHAT_CHANNEL,je.CHAT_CHANNEL_REMOVED,je.CHAT_CHANNEL_NAME_CHANGED,je.CHAT_CHANNEL_TOPIC_CHANGED,je.REMOTE_CHAT_MESSAGE];return n.ge=n.ta.messages(r).pluck("message").map(function(e){return De(e)}).do(function(e){if(e instanceof Su&&e.username===n.session().username()){var t=new Au(e.channelId);n.T(t)}else if(e instanceof _u&&e.username===n.session().username()){var r=new Nu(e.channelId);n.T(r)}}).share(),n.S(n.ge),n}return r(t,e),t.prototype.session=function(){return this.ta.session()},t.prototype.search=function(e){var t=this;return this.ta.request({type:je.SEARCH_CHAT_CHANNELS_REQUEST}).then(function(e){return e.channels.map(function(e){return t.re(e)})})},t.prototype.exists=function(e){return rs.assertNonEmptyString(e,"channelId"),this.ta.request({type:je.CHAT_CHANNEL_EXISTS_REQUEST,channelIds:[e]}).then(function(e){var t=e.exists[0];return t})},t.prototype.get=function(e){var t=this;return rs.assertNonEmptyString(e,"channelId"),this.ta.request({type:je.GET_CHAT_CHANNELS_REQUEST,channelIds:[e]}).then(function(e){var n=e.channels[0],r=t.re(n);return t.se(r)})},t.prototype.joined=function(){var e=this;return this.ta.request({type:je.CREATE_CHAT_CHANNEL_REQUEST}).then(function(t){return t.channels.map(function(t){return e.re(t)})})},t.prototype.create=function(e){if(!e)throw new Error("create options must be supplied");if("group"!==e.type&&"room"!==e.type)throw new Error("type must be 'group' or 'room': "+e.type);if("public"!==e.membership&&"private"!==e.membership)throw new Error("membership must be 'public' or 'private': "+e.membership);if("room"===e.type&&"private"===e.membership)throw new Error("membership must be 'public' for a 'room': "+e.membership);void 0!==e.id&&rs.assertNonEmptyString(e.id,"id");var t=e.id,n=e.type,r=e.name,i=e.topic,o=e.membership,s=e.members;return this.ta.request({type:je.CREATE_CHAT_CHANNEL_REQUEST,id:t,channelType:n,name:r,topic:i,membership:o,members:s}).then(function(e){return e.channelId}).catch(function(n){return n instanceof Ci&&"channel_already_exists"===n.code&&e.ignoreExistsError?Promise.resolve(t):Promise.reject(n)})},t.prototype.remove=function(e){return rs.assertNonEmptyString(e,"channelId"),this.ta.request({type:je.REMOVE_CHAT_CHANNEL_REQUEST,channelId:e}).then(function(){})},t.prototype.join=function(e){var t=this;return rs.assertNonEmptyString(e,"channelId"),this.ta.request({type:je.JOIN_CHAT_CHANNEL_REQUEST,channelId:e}).then(function(e){var n=t.re(e.channel);return t.se(n)})},t.prototype.leave=function(e){return rs.assertNonEmptyString(e,"channelId"),this.ta.request({type:je.LEAVE_CHAT_CHANNEL_REQUEST,channelId:e}).then(function(){})},t.prototype.direct=function(e){var t=this;return"string"==typeof e&&(e=[e]),this.ta.request({type:je.GET_DIRECT_CHAT_CHANNELS_REQUEST,channelUsernames:[e]}).then(function(e){var n=e.channels[0],r=t.re(n),i=t.se(r);return i})},t.prototype.permissions=function(e){return new Lu(e,this.ta)},t.prototype.re=function(e){return"direct"===e.channelType?{channelId:e.channelId,channelType:e.channelType,channelMembership:e.channelMembership,name:e.name,topic:e.topic,createdTime:e.createdTime,lastEventTime:e.lastEventTime,lastEventNumber:e.lastEventNumber,maxSeenEvent:e.maxSeenEvent,members:e.members}:{channelId:e.channelId,channelType:e.channelType,channelMembership:e.channelMembership,name:e.name,topic:e.topic,createdTime:e.createdTime,lastEventTime:e.lastEventTime,lastEventNumber:e.maxSeenEvent,maxSeenEvent:e.maxSeenEvent,members:e.members}},t.prototype.se=function(e){var t=this.ge.filter(function(t){return t.channelId===e.channelId});switch(e.channelType){case Uu.DIRECT:return new wu(this.ta,t,e);case Uu.GROUP:var n=e;return new Mu(this.ta,t,n);case Uu.ROOM:var r=e;return new Du(this.ta,t,r);default:throw new Error("Invalid chat channel type: "+e.channelType)}},t}(Ze);xu.Events=Pu;var Hu=function(){function e(t){this.domain=t,this.name=e.NAME,Object.freeze(this)}return e}();Hu.NAME="connected";var Bu=function(){function e(t){this.domain=t,this.name=e.NAME,Object.freeze(this)}return e}();Bu.NAME="interrupted";var zu=function(){function e(t){this.domain=t,this.name=e.NAME,Object.freeze(this)}return e}();zu.NAME="reconnected";var Vu=function(){function e(t){this.domain=t,this.name=e.NAME,Object.freeze(this)}return e}();Vu.NAME="disconnected";var Gu=function(){function e(t,n){this.domain=t,this.error=n,this.name=e.NAME,Object.freeze(this)}return e}();Gu.NAME="error";var ju=function(e){function t(t,n){var r=e.call(this)||this;return r.te=r.ue(n),r.V=!1,r.ta=new Mi(t,r.te.connectionTimeout,r.te.maxReconnectAttempts,r.te.reconnectInterval,r.te.retryOnOpen,r),r.ta.on(Mi.Events.CONNECTED,function(){return r.T(new Hu(r))}),r.ta.on(Mi.Events.INTERRUPTED,function(){return r.T(new Bu(r))}),r.ta.on(Mi.Events.DISCONNECTED,function(){return r.T(new Vu(r))}),r.ta.on(Mi.Events.RECONNECTED,function(){return r.T(new zu(r))}),r.ta.on(Mi.Events.ERROR,function(e){return r.T(new Gu(r,e))}),r}return r(t,e),t.prototype.ve=function(e,t){var n=this;return this.ta.authenticateWithPassword(e,t).then(function(e){return n.we(e)})},t.prototype.xe=function(e){var t=this;return this.ta.authenticateWithToken(e).then(function(e){return t.we(e)})},t.prototype.ye=function(e){var t=this;return this.ta.authenticateAnonymously(e).then(function(e){return t.we(e)})},t.prototype.ze=function(){return this.ta.connect()},t.prototype.session=function(){return this.ta.session()},t.prototype.models=function(){return this.cd},t.prototype.identity=function(){return this.Ae},t.prototype.activities=function(){return this.Be},t.prototype.presence=function(){return this.Ce},t.prototype.chat=function(){return this.De},t.prototype.dispose=function(){return this.V=!0,this.cd.ba(),this.ta.disconnect()},t.prototype.isDisposed=function(){return this.V},t.prototype.ue=function(e){return void 0===e?e=t.DefaultOptions:(void 0===e.connectionTimeout&&(e.connectionTimeout=t.DefaultOptions.connectionTimeout),void 0===e.maxReconnectAttempts&&(e.maxReconnectAttempts=t.DefaultOptions.maxReconnectAttempts),void 0===e.reconnectInterval&&(e.reconnectInterval=t.DefaultOptions.reconnectInterval),void 0===e.retryOnOpen&&(e.retryOnOpen=t.DefaultOptions.retryOnOpen)),e},t.prototype.we=function(e){var t=this.ta.session(),n=Jn.objectToMap(e.state),r=new au(t.username(),(!0),n);this.cd=new Ja(this.ta),this.Ae=new su(this.ta),this.Be=new nu(this.ta),this.Ce=new du(this.ta,r),this.De=new xu(this.ta)},t}(Ze);ju.Events={CONNECTED:Hu.NAME,INTERRUPTED:Bu.NAME,RECONNECTED:zu.NAME,DISCONNECTED:Vu.NAME,ERROR:Gu.NAME},ju.DefaultOptions={connectionTimeout:5,maxReconnectAttempts:-1,reconnectInterval:5,retryOnOpen:!0},Object.freeze(ju.Events);var ku=function(){function e(){}return e.connect=function(e,t,n,r){var i=new ju(e,r);return i.ze().then(function(e){return i.ve(t,n)}).then(function(){return i})},e.connectAnonymously=function(e,t,n){var r=new ju(e,n);return r.ze().then(function(e){return r.ye(t)}).then(function(){return r})},e.connectWithJwt=function(e,t,n){var r=new ju(e,n);return r.ze().then(function(e){return r.xe(t)}).then(function(){return r})},e}();e.connect=Le,e.connectAnonymously=Pe,e.connectWithJwt=Ue,e.Convergence=ku,e.ConvergenceDomain=ju,e.ConnectedEvent=Hu,e.InterruptedEvent=Bu,e.ReconnectedEvent=zu,e.DisconnectedEvent=Vu,e.ConnectionErrorEvent=Gu,e.Activity=tu,e.ActivityParticipant=Wa,e.ActivityService=nu,e.SessionJoinedEvent=Ka,e.SessionLeftEvent=Xa,e.StateSetEvent=$a,e.StateRemovedEvent=Za,e.StateClearedEvent=eu,e.ChatChannelTypes=Uu,e.ChatService=xu,e.ChatChannel=Cu,e.GroupChatChannel=Mu,e.DirectChatChannel=wu,e.ChatRoomChannel=Du,e.ChatHistoryEntry=di,e.ChannelCreatedHistoryEntry=li,e.MessageChatHistoryEntry=vi,e.UserJoinedChatHistoryEntry=Si,e.UserLeftChatHistoryEntry=_i,e.UserAddedChatHistoryEntry=Ri,e.UserRemovedChatHistoryEntry=yi,e.NameChangedChatHistoryEntry=Ti,e.TopicChangedChatHistoryEntry=Oi,e.ChatChannelEvent=lu,e.ChatMessageEvent=vu,e.UserJoinedEvent=Su,e.UserLeftEvent=_u,e.UserAddedEvent=Ru,e.UserRemovedEvent=yu,e.ChatChannelNameChanged=Tu,e.ChatChannelTopicChanged=Ou,e.ChannelJoinedEvent=Au,e.ChannelLeftEvent=Nu,e.ChannelRemovedEvent=Iu,e.DomainUser=zn,e.UserFields=ru,e.IdentityService=su,e.ModelService=Ja,e.ModelElementType=Ws,e.RemoteReferenceCreatedEvent=is,e.ModelPermissionsChangedEvent=os,e.ElementDetachedEvent=ss,e.ModelChangedEvent=as,e.ArrayInsertEvent=us,e.ArrayRemoveEvent=cs,e.ArraySetEvent=Es,e.ArrayReorderEvent=hs,e.ArraySetValueEvent=fs,e.BooleanSetValueEvent=ps,e.NumberSetValueEvent=ds,e.NumberDeltaEvent=ls,e.ObjectSetEvent=vs,e.ObjectRemoveEvent=Ss,e.ObjectSetValueEvent=_s,e.StringInsertEvent=Rs,e.StringRemoveEvent=ys,e.StringSetValueEvent=Ts,e.DateSetValueEvent=Os,e.HistoricalArray=xa,e.HistoricalBoolean=Ba,e.HistoricalElement=Ua,e.HistoricalModel=Fa,e.HistoricalNull=za,e.HistoricalNumber=Va,e.HistoricalObject=Ha,e.HistoricalString=Ga,e.HistoricalUndefined=ja,e.HistoricalDate=ka,e.RealTimeArray=Ea,e.RealTimeBoolean=la,e.RealTimeElement=qs,e.RealTimeModel=Pa,e.RealTimeNull=va,e.RealTimeNumber=_a,e.RealTimeObject=da,e.RealTimeString=Oa,e.RealTimeDate=Na,e.RealTimeUndefined=Aa,e.ModelCollaborator=ga,e.CollaboratorOpenedEvent=ba,e.CollaboratorClosedEvent=Ma,e.ModelResult=_r,e.ElementReference=Ys,e.IndexReference=js,e.LocalElementReference=ma,e.LocalModelReference=ha,e.LocalPropertyReference=fa,e.LocalRangeReference=ya,e.ModelReference=rt,e.PropertyReference=Qs,e.RangeReference=ks,e.ModelPermissionManager=Da,e.PresenceStateSetEvent=uu,e.PresenceStateRemovedEvent=cu,e.PresenceStateClearedEvent=Eu,e.PresenceAvailabilityChangedEvent=hu,e.PresenceService=du,e.UserPresence=au,e.UserPresenceSubscription=fu,e.ConvergenceEventEmitter=Ze,e.StringMap=Jn,e.ConvergenceServerError=Ci,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=convergence.min.js.map
